import{registerVersion,_registerComponent,_getProvider,getApp}from"https://www.gstatic.com/firebasejs/9.6.7/firebase-app.js";function isIndexedDBAvailable(){return"object"==typeof indexedDB}function validateIndexedDBOpenable(){return new Promise((t,n)=>{try{let e=!0;const r="validate-browser-context-for-indexeddb-analytics-module",o=self.indexedDB.open(r);o.onsuccess=()=>{o.result.close(),e||self.indexedDB.deleteDatabase(r),t(!0)},o.onupgradeneeded=()=>{e=!1},o.onerror=()=>{var e;n((null===(e=o.error)||void 0===e?void 0:e.message)||"")}}catch(e){n(e)}})}const ERROR_NAME="FirebaseError";class FirebaseError extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name=ERROR_NAME,Object.setPrototypeOf(this,FirebaseError.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ErrorFactory.prototype.create)}}class ErrorFactory{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var n=t[0]||{},t=`${this.service}/${e}`,e=this.errors[e],e=e?replaceTemplate(e,n):"Error",e=`${this.serviceName}: ${e} (${t}).`;return new FirebaseError(t,e,n)}}function replaceTemplate(e,r){return e.replace(PATTERN,(e,t)=>{var n=r[t];return null!=n?String(n):`<${t}?>`})}const PATTERN=/\{\$([^}]+)}/g;function getModularInstance(e){return e&&e._delegate?e._delegate:e}class Component{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}function toArray(e){return Array.prototype.slice.call(e)}function promisifyRequest(n){return new Promise(function(e,t){n.onsuccess=function(){e(n.result)},n.onerror=function(){t(n.error)}})}function promisifyRequestCall(n,r,o){var a,e=new Promise(function(e,t){promisifyRequest(a=n[r].apply(n,o)).then(e,t)});return e.request=a,e}function promisifyCursorRequestCall(e,t,n){var r=promisifyRequestCall(e,t,n);return r.then(function(e){if(e)return new Cursor(e,r.request)})}function proxyProperties(e,n,t){t.forEach(function(t){Object.defineProperty(e.prototype,t,{get:function(){return this[n][t]},set:function(e){this[n][t]=e}})})}function proxyRequestMethods(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return promisifyRequestCall(this[n],e,arguments)})})}function proxyMethods(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return this[n][e].apply(this[n],arguments)})})}function proxyCursorRequestMethods(t,n,r,e){e.forEach(function(e){e in r.prototype&&(t.prototype[e]=function(){return promisifyCursorRequestCall(this[n],e,arguments)})})}function Index(e){this._index=e}function Cursor(e,t){this._cursor=e,this._request=t}function ObjectStore(e){this._store=e}function Transaction(n){this._tx=n,this.complete=new Promise(function(e,t){n.oncomplete=function(){e()},n.onerror=function(){t(n.error)},n.onabort=function(){t(n.error)}})}function UpgradeDB(e,t,n){this._db=e,this.oldVersion=t,this.transaction=new Transaction(n)}function DB(e){this._db=e}function openDb(e,t,n){var t=promisifyRequestCall(indexedDB,"open",[e,t]),r=t.request;return r&&(r.onupgradeneeded=function(e){n&&n(new UpgradeDB(r.result,e.oldVersion,r.transaction))}),t.then(function(e){return new DB(e)})}function deleteDb(e){return promisifyRequestCall(indexedDB,"deleteDatabase",[e])}proxyProperties(Index,"_index",["name","keyPath","multiEntry","unique"]),proxyRequestMethods(Index,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),proxyCursorRequestMethods(Index,"_index",IDBIndex,["openCursor","openKeyCursor"]),proxyProperties(Cursor,"_cursor",["direction","key","primaryKey","value"]),proxyRequestMethods(Cursor,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach(function(n){n in IDBCursor.prototype&&(Cursor.prototype[n]=function(){var t=this,e=arguments;return Promise.resolve().then(function(){return t._cursor[n].apply(t._cursor,e),promisifyRequest(t._request).then(function(e){if(e)return new Cursor(e,t._request)})})})}),ObjectStore.prototype.createIndex=function(){return new Index(this._store.createIndex.apply(this._store,arguments))},ObjectStore.prototype.index=function(){return new Index(this._store.index.apply(this._store,arguments))},proxyProperties(ObjectStore,"_store",["name","keyPath","indexNames","autoIncrement"]),proxyRequestMethods(ObjectStore,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),proxyCursorRequestMethods(ObjectStore,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),proxyMethods(ObjectStore,"_store",IDBObjectStore,["deleteIndex"]),Transaction.prototype.objectStore=function(){return new ObjectStore(this._tx.objectStore.apply(this._tx,arguments))},proxyProperties(Transaction,"_tx",["objectStoreNames","mode"]),proxyMethods(Transaction,"_tx",IDBTransaction,["abort"]),UpgradeDB.prototype.createObjectStore=function(){return new ObjectStore(this._db.createObjectStore.apply(this._db,arguments))},proxyProperties(UpgradeDB,"_db",["name","version","objectStoreNames"]),proxyMethods(UpgradeDB,"_db",IDBDatabase,["deleteObjectStore","close"]),DB.prototype.transaction=function(){return new Transaction(this._db.transaction.apply(this._db,arguments))},proxyProperties(DB,"_db",["name","version","objectStoreNames"]),proxyMethods(DB,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach(function(o){[ObjectStore,Index].forEach(function(e){o in e.prototype&&(e.prototype[o.replace("open","iterate")]=function(){var e=toArray(arguments),t=e[e.length-1],n=this._store||this._index,r=n[o].apply(n,e.slice(0,-1));r.onsuccess=function(){t(r.result)}})})}),[Index,ObjectStore].forEach(function(e){e.prototype.getAll||(e.prototype.getAll=function(e,n){var r=this,o=[];return new Promise(function(t){r.iterateCursor(e,function(e){e?(o.push(e.value),void 0===n||o.length!=n?e.continue():t(o)):t(o)})})})});const name="@firebase/installations",version="0.5.5",PENDING_TIMEOUT_MS=1e4,PACKAGE_VERSION=`w:${version}`,INTERNAL_AUTH_VERSION="FIS_v2",INSTALLATIONS_API_URL="https://firebaseinstallations.googleapis.com/v1",TOKEN_EXPIRATION_BUFFER=36e5,SERVICE="installations",SERVICE_NAME="Installations",ERROR_DESCRIPTION_MAP={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},ERROR_FACTORY$1=new ErrorFactory(SERVICE,SERVICE_NAME,ERROR_DESCRIPTION_MAP);function isServerError(e){return e instanceof FirebaseError&&e.code.includes("request-failed")}function getInstallationsEndpoint({projectId:e}){return`${INSTALLATIONS_API_URL}/projects/${e}/installations`}function extractAuthTokenInfoFromResponse(e){return{token:e.token,requestStatus:2,expiresIn:getExpiresInFromResponseExpiresIn(e.expiresIn),creationTime:Date.now()}}async function getErrorFromResponse(e,t){t=(await t.json()).error;return ERROR_FACTORY$1.create("request-failed",{requestName:e,serverCode:t.code,serverMessage:t.message,serverStatus:t.status})}function getHeaders$1({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function getHeadersWithAuth(e,{refreshToken:t}){const n=getHeaders$1(e);return n.append("Authorization",getAuthorizationHeader(t)),n}async function retryIfServerError(e){var t=await e();return 500<=t.status&&t.status<600?e():t}function getExpiresInFromResponseExpiresIn(e){return Number(e.replace("s","000"))}function getAuthorizationHeader(e){return`${INTERNAL_AUTH_VERSION} ${e}`}async function createInstallationRequest(e,{fid:t}){const n=getInstallationsEndpoint(e);var r=getHeaders$1(e),e={fid:t,authVersion:INTERNAL_AUTH_VERSION,appId:e.appId,sdkVersion:PACKAGE_VERSION};const o={method:"POST",headers:r,body:JSON.stringify(e)},a=await retryIfServerError(()=>fetch(n,o));if(a.ok){e=await a.json();return{fid:e.fid||t,registrationStatus:2,refreshToken:e.refreshToken,authToken:extractAuthTokenInfoFromResponse(e.authToken)}}throw await getErrorFromResponse("Create Installation",a)}function sleep$1(t){return new Promise(e=>{setTimeout(e,t)})}function bufferToBase64UrlSafe(e){const t=btoa(String.fromCharCode(...e));return t.replace(/\+/g,"-").replace(/\//g,"_")}const VALID_FID_PATTERN=/^[cdef][\w-]{21}$/,INVALID_FID="";function generateFid(){try{const t=new Uint8Array(17),n=self.crypto||self.msCrypto;n.getRandomValues(t),t[0]=112+t[0]%16;var e=encode(t);return VALID_FID_PATTERN.test(e)?e:INVALID_FID}catch(e){return INVALID_FID}}function encode(e){const t=bufferToBase64UrlSafe(e);return t.substr(0,22)}function getKey$1(e){return`${e.appName}!${e.appId}`}const fidChangeCallbacks=new Map;function fidChanged(e,t){e=getKey$1(e);callFidChangeCallbacks(e,t),broadcastFidChange(e,t)}function callFidChangeCallbacks(e,t){e=fidChangeCallbacks.get(e);if(e)for(const n of e)n(t)}function broadcastFidChange(e,t){const n=getBroadcastChannel();n&&n.postMessage({key:e,fid:t}),closeBroadcastChannel()}let broadcastChannel=null;function getBroadcastChannel(){return!broadcastChannel&&"BroadcastChannel"in self&&(broadcastChannel=new BroadcastChannel("[Firebase] FID Change"),broadcastChannel.onmessage=e=>{callFidChangeCallbacks(e.data.key,e.data.fid)}),broadcastChannel}function closeBroadcastChannel(){0===fidChangeCallbacks.size&&broadcastChannel&&(broadcastChannel.close(),broadcastChannel=null)}const DATABASE_NAME$1="firebase-installations-database",DATABASE_VERSION$1=1,OBJECT_STORE_NAME$1="firebase-installations-store";let dbPromise$1=null;function getDbPromise$1(){return dbPromise$1=dbPromise$1||openDb(DATABASE_NAME$1,DATABASE_VERSION$1,e=>{0===e.oldVersion&&e.createObjectStore(OBJECT_STORE_NAME$1)}),dbPromise$1}async function set(e,t){var n=getKey$1(e);const r=await getDbPromise$1(),o=r.transaction(OBJECT_STORE_NAME$1,"readwrite"),a=o.objectStore(OBJECT_STORE_NAME$1);var i=await a.get(n);return await a.put(t,n),await o.complete,i&&i.fid===t.fid||fidChanged(e,t.fid),t}async function remove(e){e=getKey$1(e);const t=await getDbPromise$1(),n=t.transaction(OBJECT_STORE_NAME$1,"readwrite");await n.objectStore(OBJECT_STORE_NAME$1).delete(e),await n.complete}async function update(e,t){var n=getKey$1(e);const r=await getDbPromise$1(),o=r.transaction(OBJECT_STORE_NAME$1,"readwrite"),a=o.objectStore(OBJECT_STORE_NAME$1);var i=await a.get(n),t=t(i);return void 0===t?await a.delete(n):await a.put(t,n),await o.complete,!t||i&&i.fid===t.fid||fidChanged(e,t.fid),t}async function getInstallationEntry(t){let n;var e=await update(t,e=>{e=updateOrCreateInstallationEntry(e),e=triggerRegistrationIfNecessary(t,e);return n=e.registrationPromise,e.installationEntry});return e.fid===INVALID_FID?{installationEntry:await n}:{installationEntry:e,registrationPromise:n}}function updateOrCreateInstallationEntry(e){return clearTimedOutRequest(e||{fid:generateFid(),registrationStatus:0})}function triggerRegistrationIfNecessary(e,t){if(0!==t.registrationStatus)return 1===t.registrationStatus?{installationEntry:t,registrationPromise:waitUntilFidRegistration(e)}:{installationEntry:t};if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(ERROR_FACTORY$1.create("app-offline"))};t={fid:t.fid,registrationStatus:1,registrationTime:Date.now()};return{installationEntry:t,registrationPromise:registerInstallation(e,t)}}async function registerInstallation(t,n){try{return set(t,await createInstallationRequest(t,n))}catch(e){throw isServerError(e)&&409===e.customData.serverCode?await remove(t):await set(t,{fid:n.fid,registrationStatus:0}),e}}async function waitUntilFidRegistration(e){let t=await updateInstallationRequest(e);for(;1===t.registrationStatus;)await sleep$1(100),t=await updateInstallationRequest(e);if(0!==t.registrationStatus)return t;var{installationEntry:n,registrationPromise:r}=await getInstallationEntry(e);return r||n}function updateInstallationRequest(e){return update(e,e=>{if(!e)throw ERROR_FACTORY$1.create("installation-not-found");return clearTimedOutRequest(e)})}function clearTimedOutRequest(e){return hasInstallationRequestTimedOut(e)?{fid:e.fid,registrationStatus:0}:e}function hasInstallationRequestTimedOut(e){return 1===e.registrationStatus&&e.registrationTime+PENDING_TIMEOUT_MS<Date.now()}async function generateAuthTokenRequest({appConfig:e,platformLoggerProvider:t},n){const r=getGenerateAuthTokenEndpoint(e,n),o=getHeadersWithAuth(e,n),a=t.getImmediate({optional:!0});a&&o.append("x-firebase-client",a.getPlatformInfoString());t={installation:{sdkVersion:PACKAGE_VERSION}};const i={method:"POST",headers:o,body:JSON.stringify(t)},s=await retryIfServerError(()=>fetch(r,i));if(s.ok)return extractAuthTokenInfoFromResponse(await s.json());throw await getErrorFromResponse("Generate Auth Token",s)}function getGenerateAuthTokenEndpoint(e,{fid:t}){return`${getInstallationsEndpoint(e)}/${t}/authTokens:generate`}async function refreshAuthToken(n,r=!1){let o;var e=await update(n.appConfig,e=>{if(!isEntryRegistered(e))throw ERROR_FACTORY$1.create("not-registered");var t=e.authToken;if(!r&&isAuthTokenValid(t))return e;if(1===t.requestStatus)return o=waitUntilAuthTokenRequest(n,r),e;if(!navigator.onLine)throw ERROR_FACTORY$1.create("app-offline");e=makeAuthTokenRequestInProgressEntry(e);return o=fetchAuthTokenFromServer(n,e),e});return o?await o:e.authToken}async function waitUntilAuthTokenRequest(e,t){let n=await updateAuthTokenRequest(e.appConfig);for(;1===n.authToken.requestStatus;)await sleep$1(100),n=await updateAuthTokenRequest(e.appConfig);var r=n.authToken;return 0===r.requestStatus?refreshAuthToken(e,t):r}function updateAuthTokenRequest(e){return update(e,e=>{if(!isEntryRegistered(e))throw ERROR_FACTORY$1.create("not-registered");return hasAuthTokenRequestTimedOut(e.authToken)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function fetchAuthTokenFromServer(t,n){try{var e=await generateAuthTokenRequest(t,n),r=Object.assign(Object.assign({},n),{authToken:e});return await set(t.appConfig,r),e}catch(e){throw!isServerError(e)||401!==e.customData.serverCode&&404!==e.customData.serverCode?(n=Object.assign(Object.assign({},n),{authToken:{requestStatus:0}}),await set(t.appConfig,n)):await remove(t.appConfig),e}}function isEntryRegistered(e){return void 0!==e&&2===e.registrationStatus}function isAuthTokenValid(e){return 2===e.requestStatus&&!isAuthTokenExpired(e)}function isAuthTokenExpired(e){var t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+TOKEN_EXPIRATION_BUFFER}function makeAuthTokenRequestInProgressEntry(e){var t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}function hasAuthTokenRequestTimedOut(e){return 1===e.requestStatus&&e.requestTime+PENDING_TIMEOUT_MS<Date.now()}async function getId(e){const{installationEntry:t,registrationPromise:n}=await getInstallationEntry(e.appConfig);return(n||refreshAuthToken(e)).catch(console.error),t.fid}async function getToken(e,t=!1){return await completeInstallationRegistration(e.appConfig),(await refreshAuthToken(e,t)).token}async function completeInstallationRegistration(e){var e=(await getInstallationEntry(e))["registrationPromise"];e&&await e}function extractAppConfig$1(e){if(!e||!e.options)throw getMissingValueError$1("App Configuration");if(!e.name)throw getMissingValueError$1("App Name");for(const t of["projectId","apiKey","appId"])if(!e.options[t])throw getMissingValueError$1(t);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}function getMissingValueError$1(e){return ERROR_FACTORY$1.create("missing-app-config-values",{valueName:e})}const INSTALLATIONS_NAME="installations",INSTALLATIONS_NAME_INTERNAL="installations-internal",publicFactory=e=>{e=e.getProvider("app").getImmediate();return{app:e,appConfig:extractAppConfig$1(e),platformLoggerProvider:_getProvider(e,"platform-logger"),_delete:()=>Promise.resolve()}},internalFactory=e=>{e=e.getProvider("app").getImmediate();const t=_getProvider(e,INSTALLATIONS_NAME).getImmediate();return{getId:()=>getId(t),getToken:e=>getToken(t,e)}};function registerInstallations(){_registerComponent(new Component(INSTALLATIONS_NAME,publicFactory,"PUBLIC")),_registerComponent(new Component(INSTALLATIONS_NAME_INTERNAL,internalFactory,"PRIVATE"))}registerInstallations(),registerVersion(name,version),registerVersion(name,version,"esm2017");const DEFAULT_VAPID_KEY="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",ENDPOINT="https://fcmregistrations.googleapis.com/v1",FCM_MSG="FCM_MSG",CONSOLE_CAMPAIGN_ID="google.c.a.c_id",SDK_PLATFORM_WEB=3,EVENT_MESSAGE_DELIVERED=1;var MessageType$1,MessageType;function arrayToBase64(e){e=new Uint8Array(e);const t=btoa(String.fromCharCode(...e));return t.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function base64ToArray(e){e=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/");const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;++e)n[e]=t.charCodeAt(e);return n}!function(e){e[e.DATA_MESSAGE=1]="DATA_MESSAGE",e[e.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"}(MessageType$1=MessageType$1||{}),function(e){e.PUSH_RECEIVED="push-received",e.NOTIFICATION_CLICKED="notification-clicked"}(MessageType=MessageType||{});const OLD_DB_NAME="fcm_token_details_db",OLD_DB_VERSION=5,OLD_OBJECT_STORE_NAME="fcm_token_object_Store";async function migrateOldDatabase(a){if("databases"in indexedDB){const t=await indexedDB.databases(),n=t.map(e=>e.name);if(!n.includes(OLD_DB_NAME))return null}let i=null;const e=await openDb(OLD_DB_NAME,OLD_DB_VERSION,async e=>{var t;if(!(e.oldVersion<2)&&e.objectStoreNames.contains(OLD_OBJECT_STORE_NAME)){const o=e.transaction.objectStore(OLD_OBJECT_STORE_NAME);var n,r=await o.index("fcmSenderId").get(a);await o.clear(),r&&(2===e.oldVersion?(n=r).auth&&n.p256dh&&n.endpoint&&(i={token:n.fcmToken,createTime:null!==(t=n.createTime)&&void 0!==t?t:Date.now(),subscriptionOptions:{auth:n.auth,p256dh:n.p256dh,endpoint:n.endpoint,swScope:n.swScope,vapidKey:"string"==typeof n.vapidKey?n.vapidKey:arrayToBase64(n.vapidKey)}}):3===e.oldVersion?(n=r,i={token:n.fcmToken,createTime:n.createTime,subscriptionOptions:{auth:arrayToBase64(n.auth),p256dh:arrayToBase64(n.p256dh),endpoint:n.endpoint,swScope:n.swScope,vapidKey:arrayToBase64(n.vapidKey)}}):4===e.oldVersion&&(r=r,i={token:r.fcmToken,createTime:r.createTime,subscriptionOptions:{auth:arrayToBase64(r.auth),p256dh:arrayToBase64(r.p256dh),endpoint:r.endpoint,swScope:r.swScope,vapidKey:arrayToBase64(r.vapidKey)}}))}});return e.close(),await deleteDb(OLD_DB_NAME),await deleteDb("fcm_vapid_details_db"),await deleteDb("undefined"),checkTokenDetails(i)?i:null}function checkTokenDetails(e){if(!e||!e.subscriptionOptions)return!1;var t=e["subscriptionOptions"];return"number"==typeof e.createTime&&0<e.createTime&&"string"==typeof e.token&&0<e.token.length&&"string"==typeof t.auth&&0<t.auth.length&&"string"==typeof t.p256dh&&0<t.p256dh.length&&"string"==typeof t.endpoint&&0<t.endpoint.length&&"string"==typeof t.swScope&&0<t.swScope.length&&"string"==typeof t.vapidKey&&0<t.vapidKey.length}const DATABASE_NAME="firebase-messaging-database",DATABASE_VERSION=1,OBJECT_STORE_NAME="firebase-messaging-store";let dbPromise=null;function getDbPromise(){return dbPromise=dbPromise||openDb(DATABASE_NAME,DATABASE_VERSION,e=>{0===e.oldVersion&&e.createObjectStore(OBJECT_STORE_NAME)}),dbPromise}async function dbGet(e){var t=getKey(e);const n=await getDbPromise();t=await n.transaction(OBJECT_STORE_NAME).objectStore(OBJECT_STORE_NAME).get(t);if(t)return t;t=await migrateOldDatabase(e.appConfig.senderId);return t?(await dbSet(e,t),t):void 0}async function dbSet(e,t){e=getKey(e);const n=await getDbPromise(),r=n.transaction(OBJECT_STORE_NAME,"readwrite");return await r.objectStore(OBJECT_STORE_NAME).put(t,e),await r.complete,t}async function dbRemove(e){e=getKey(e);const t=await getDbPromise(),n=t.transaction(OBJECT_STORE_NAME,"readwrite");await n.objectStore(OBJECT_STORE_NAME).delete(e),await n.complete}function getKey({appConfig:e}){return e.appId}const ERROR_MAP={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"only-available-in-window":"This method is available in a Window context.","only-available-in-sw":"This method is available in a service worker context.","permission-default":"The notification permission was not granted and dismissed instead.","permission-blocked":"The notification permission was not granted and blocked instead.","unsupported-browser":"This browser doesn't support the API's required to use the Firebase SDK.","indexed-db-unsupported":"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)","failed-service-worker-registration":"We are unable to register the default service worker. {$browserErrorMessage}","token-subscribe-failed":"A problem occurred while subscribing the user to FCM: {$errorInfo}","token-subscribe-no-token":"FCM returned no token when subscribing the user to push.","token-unsubscribe-failed":"A problem occurred while unsubscribing the user from FCM: {$errorInfo}","token-update-failed":"A problem occurred while updating the user from FCM: {$errorInfo}","token-update-no-token":"FCM returned no token when updating the user to push.","use-sw-after-get-token":"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.","invalid-sw-registration":"The input to useServiceWorker() must be a ServiceWorkerRegistration.","invalid-bg-handler":"The input to setBackgroundMessageHandler() must be a function.","invalid-vapid-key":"The public VAPID key must be a string.","use-vapid-key-after-get-token":"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},ERROR_FACTORY=new ErrorFactory("messaging","Messaging",ERROR_MAP);async function requestGetToken(e,t){var n=await getHeaders(e),t=getBody(t),t={method:"POST",headers:n,body:JSON.stringify(t)};let r;try{const o=await fetch(getEndpoint(e.appConfig),t);r=await o.json()}catch(e){throw ERROR_FACTORY.create("token-subscribe-failed",{errorInfo:e})}if(r.error){t=r.error.message;throw ERROR_FACTORY.create("token-subscribe-failed",{errorInfo:t})}if(!r.token)throw ERROR_FACTORY.create("token-subscribe-no-token");return r.token}async function requestUpdateToken(e,t){var n=await getHeaders(e),r=getBody(t.subscriptionOptions),r={method:"PATCH",headers:n,body:JSON.stringify(r)};let o;try{const a=await fetch(`${getEndpoint(e.appConfig)}/${t.token}`,r);o=await a.json()}catch(e){throw ERROR_FACTORY.create("token-update-failed",{errorInfo:e})}if(o.error){r=o.error.message;throw ERROR_FACTORY.create("token-update-failed",{errorInfo:r})}if(!o.token)throw ERROR_FACTORY.create("token-update-no-token");return o.token}async function requestDeleteToken(e,t){var n={method:"DELETE",headers:await getHeaders(e)};try{const a=await fetch(`${getEndpoint(e.appConfig)}/${t}`,n);var r=await a.json();if(r.error){var o=r.error.message;throw ERROR_FACTORY.create("token-unsubscribe-failed",{errorInfo:o})}}catch(e){throw ERROR_FACTORY.create("token-unsubscribe-failed",{errorInfo:e})}}function getEndpoint({projectId:e}){return`${ENDPOINT}/projects/${e}/registrations`}async function getHeaders({appConfig:e,installations:t}){t=await t.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e.apiKey,"x-goog-firebase-installations-auth":`FIS ${t}`})}function getBody({p256dh:e,auth:t,endpoint:n,vapidKey:r}){const o={web:{endpoint:n,auth:t,p256dh:e}};return r!==DEFAULT_VAPID_KEY&&(o.web.applicationPubKey=r),o}const TOKEN_EXPIRATION_MS=6048e5;async function getTokenInternal(e){const t=await getPushSubscription(e.swRegistration,e.vapidKey);var n={vapidKey:e.vapidKey,swScope:e.swRegistration.scope,endpoint:t.endpoint,auth:arrayToBase64(t.getKey("auth")),p256dh:arrayToBase64(t.getKey("p256dh"))},r=await dbGet(e.firebaseDependencies);if(r){if(isTokenValid(r.subscriptionOptions,n))return Date.now()>=r.createTime+TOKEN_EXPIRATION_MS?updateToken(e,{token:r.token,createTime:Date.now(),subscriptionOptions:n}):r.token;try{await requestDeleteToken(e.firebaseDependencies,r.token)}catch(e){console.warn(e)}return getNewToken(e.firebaseDependencies,n)}return getNewToken(e.firebaseDependencies,n)}async function deleteTokenInternal(e){var t=await dbGet(e.firebaseDependencies);t&&(await requestDeleteToken(e.firebaseDependencies,t.token),await dbRemove(e.firebaseDependencies));const n=await e.swRegistration.pushManager.getSubscription();return!n||n.unsubscribe()}async function updateToken(t,e){try{var n=await requestUpdateToken(t.firebaseDependencies,e),r=Object.assign(Object.assign({},e),{token:n,createTime:Date.now()});return await dbSet(t.firebaseDependencies,r),n}catch(e){throw await deleteTokenInternal(t),e}}async function getNewToken(e,t){t={token:await requestGetToken(e,t),createTime:Date.now(),subscriptionOptions:t};return await dbSet(e,t),t.token}async function getPushSubscription(e,t){var n=await e.pushManager.getSubscription();return n||e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:base64ToArray(t)})}function isTokenValid(e,t){var n=t.vapidKey===e.vapidKey,r=t.endpoint===e.endpoint,o=t.auth===e.auth,e=t.p256dh===e.p256dh;return n&&r&&o&&e}function externalizePayload(e){var t={from:e.from,collapseKey:e.collapse_key,messageId:e.fcmMessageId};return propagateNotificationPayload(t,e),propagateDataPayload(t,e),propagateFcmOptions(t,e),t}function propagateNotificationPayload(e,t){var n;t.notification&&(e.notification={},(n=t.notification.title)&&(e.notification.title=n),(n=t.notification.body)&&(e.notification.body=n),(t=t.notification.image)&&(e.notification.image=t))}function propagateDataPayload(e,t){t.data&&(e.data=t.data)}function propagateFcmOptions(e,t){var n;t.fcmOptions&&(e.fcmOptions={},(n=t.fcmOptions.link)&&(e.fcmOptions.link=n),(t=t.fcmOptions.analytics_label)&&(e.fcmOptions.analyticsLabel=t))}function isConsoleMessage(e){return"object"==typeof e&&!!e&&CONSOLE_CAMPAIGN_ID in e}function sleep(t){return new Promise(e=>{setTimeout(e,t)})}async function stageLog(e,t){t=createFcmEvent(t,await e.firebaseDependencies.installations.getId());createAndEnqueueLogEvent(e,t)}function createFcmEvent(e,t){const n={};return e.from&&(n.project_number=e.from),e.fcmMessageId&&(n.message_id=e.fcmMessageId),n.instance_id=t,e.notification?n.message_type=MessageType$1.DISPLAY_NOTIFICATION.toString():n.message_type=MessageType$1.DATA_MESSAGE.toString(),n.sdk_platform=SDK_PLATFORM_WEB.toString(),n.package_name=self.origin.replace(/(^\w+:|^)\/\//,""),e.collapse_key&&(n.collapse_key=e.collapse_key),n.event=EVENT_MESSAGE_DELIVERED.toString(),null!==(t=e.fcmOptions)&&void 0!==t&&t.analytics_label&&(n.analytics_label=null===(e=e.fcmOptions)||void 0===e?void 0:e.analytics_label),n}function createAndEnqueueLogEvent(e,t){const n={};n.event_time_ms=Math.floor(Date.now()).toString(),n.source_extension_json_proto3=JSON.stringify(t),e.logEvents.push(n)}function _mergeStrings(t,n){const r=[];for(let e=0;e<t.length;e++)r.push(t.charAt(e)),e<n.length&&r.push(n.charAt(e));return r.join("")}async function onSubChange(e,t){var e=e["newSubscription"];e?(e=await dbGet(t.firebaseDependencies),await deleteTokenInternal(t),t.vapidKey=null!==(e=null===(e=null==e?void 0:e.subscriptionOptions)||void 0===e?void 0:e.vapidKey)&&void 0!==e?e:DEFAULT_VAPID_KEY,await getTokenInternal(t)):await deleteTokenInternal(t)}async function onPush(e,t){var n=getMessagePayloadInternal(e);if(n){t.deliveryMetricsExportedToBigQueryEnabled&&await stageLog(t,n);e=await getClientList();if(hasVisibleClients(e))return sendMessagePayloadInternalToWindows(e,n);n.notification&&await showNotification(wrapInternalPayload(n)),t&&t.onBackgroundMessageHandler&&(n=externalizePayload(n),"function"==typeof t.onBackgroundMessageHandler?t.onBackgroundMessageHandler(n):t.onBackgroundMessageHandler.next(n))}}async function onNotificationClick(e){const t=null===(r=null===(n=e.notification)||void 0===n?void 0:n.data)||void 0===r?void 0:r[FCM_MSG];if(t&&!e.action){e.stopImmediatePropagation(),e.notification.close();var n=getLink(t);if(n){var r=new URL(n,self.location.href),e=new URL(self.location.origin);if(r.host===e.host){let e=await getWindowClient(r);if(e?e=await e.focus():(e=await self.clients.openWindow(n),await sleep(3e3)),e)return t.messageType=MessageType.NOTIFICATION_CLICKED,t.isFirebaseMessaging=!0,e.postMessage(t)}}}}function wrapInternalPayload(e){const t=Object.assign({},e.notification);return t.data={[FCM_MSG]:e},t}function getMessagePayloadInternal({data:e}){if(!e)return null;try{return e.json()}catch(e){return null}}async function getWindowClient(e){for(const n of await getClientList()){var t=new URL(n.url,self.location.href);if(e.host===t.host)return n}return null}function hasVisibleClients(e){return e.some(e=>"visible"===e.visibilityState&&!e.url.startsWith("chrome-extension://"))}function sendMessagePayloadInternalToWindows(e,t){t.isFirebaseMessaging=!0,t.messageType=MessageType.PUSH_RECEIVED;for(const n of e)n.postMessage(t)}function getClientList(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function showNotification(e){var t=e["actions"],n=Notification["maxActions"];return t&&n&&t.length>n&&console.warn(`This browser only supports ${n} actions. The remaining actions will not be displayed.`),self.registration.showNotification(null!==(n=e.title)&&void 0!==n?n:"",e)}function getLink(e){var t,n=null!==(t=null===(t=e.fcmOptions)||void 0===t?void 0:t.link)&&void 0!==t?t:null===(n=e.notification)||void 0===n?void 0:n.click_action;return n||(isConsoleMessage(e.data)?self.location.origin:null)}function extractAppConfig(e){if(!e||!e.options)throw getMissingValueError("App Configuration Object");if(!e.name)throw getMissingValueError("App Name");var t=e["options"];for(const n of["projectId","apiKey","appId","messagingSenderId"])if(!t[n])throw getMissingValueError(n);return{appName:e.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}function getMissingValueError(e){return ERROR_FACTORY.create("missing-app-config-values",{valueName:e})}_mergeStrings("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),_mergeStrings("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");class MessagingService{constructor(e,t,n){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;var r=extractAppConfig(e);this.firebaseDependencies={app:e,appConfig:r,installations:t,analyticsProvider:n}}_delete(){return Promise.resolve()}}const SwMessagingFactory=e=>{const t=new MessagingService(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),e.getProvider("analytics-internal"));return self.addEventListener("push",e=>{e.waitUntil(onPush(e,t))}),self.addEventListener("pushsubscriptionchange",e=>{e.waitUntil(onSubChange(e,t))}),self.addEventListener("notificationclick",e=>{e.waitUntil(onNotificationClick(e))}),t};function registerMessagingInSw(){_registerComponent(new Component("messaging-sw",SwMessagingFactory,"PUBLIC"))}async function isSwSupported(){return isIndexedDBAvailable()&&await validateIndexedDBOpenable()&&"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}function onBackgroundMessage$1(e,t){if(void 0!==self.document)throw ERROR_FACTORY.create("only-available-in-sw");return e.onBackgroundMessageHandler=t,()=>{e.onBackgroundMessageHandler=null}}function _setDeliveryMetricsExportedToBigQueryEnabled(e,t){e.deliveryMetricsExportedToBigQueryEnabled=t}function getMessagingInSw(e=getApp()){return isSwSupported().then(e=>{if(!e)throw ERROR_FACTORY.create("unsupported-browser")},e=>{throw ERROR_FACTORY.create("indexed-db-unsupported")}),_getProvider(getModularInstance(e),"messaging-sw").getImmediate()}function onBackgroundMessage(e,t){return onBackgroundMessage$1(e=getModularInstance(e),t)}function experimentalSetDeliveryMetricsExportedToBigQueryEnabled(e,t){return _setDeliveryMetricsExportedToBigQueryEnabled(e=getModularInstance(e),t)}registerMessagingInSw();export{experimentalSetDeliveryMetricsExportedToBigQueryEnabled,getMessagingInSw as getMessaging,isSwSupported as isSupported,onBackgroundMessage};