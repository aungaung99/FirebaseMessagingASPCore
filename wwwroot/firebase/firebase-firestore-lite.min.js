import{_registerComponent,registerVersion,_getProvider,getApp,_removeServiceInstance,SDK_VERSION}from"https://www.gstatic.com/firebasejs/9.6.7/firebase-app.js";const stringToByteArray$1=function(n){const r=[];let s=0;for(let e=0;e<n.length;e++){let t=n.charCodeAt(e);t<128?r[s++]=t:(t<2048?r[s++]=t>>6|192:(55296==(64512&t)&&e+1<n.length&&56320==(64512&n.charCodeAt(e+1))?(t=65536+((1023&t)<<10)+(1023&n.charCodeAt(++e)),r[s++]=t>>18|240,r[s++]=t>>12&63|128):r[s++]=t>>12|224,r[s++]=t>>6&63|128),r[s++]=63&t|128)}return r},byteArrayToString=function(t){const e=[];let n=0,r=0;for(;n<t.length;){var s,i,a=t[n++];a<128?e[r++]=String.fromCharCode(a):191<a&&a<224?(s=t[n++],e[r++]=String.fromCharCode((31&a)<<6|63&s)):239<a&&a<365?(i=((7&a)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536,e[r++]=String.fromCharCode(55296+(i>>10)),e[r++]=String.fromCharCode(56320+(1023&i))):(s=t[n++],i=t[n++],e[r++]=String.fromCharCode((15&a)<<12|(63&s)<<6|63&i))}return e.join("")},base64={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(r,t){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();var s=t?this.byteToCharMapWebSafe_:this.byteToCharMap_;const i=[];for(let n=0;n<r.length;n+=3){var a=r[n],o=n+1<r.length,u=o?r[n+1]:0,l=n+2<r.length,c=l?r[n+2]:0;let t=(15&u)<<2|c>>6,e=63&c;l||(e=64,o||(t=64)),i.push(s[a>>2],s[(3&a)<<4|u>>4],s[t],s[e])}return i.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(stringToByteArray$1(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):byteArrayToString(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(e,t){this.init_();var n=t?this.charToByteMapWebSafe_:this.charToByteMap_;const r=[];for(let t=0;t<e.length;){var s=n[e.charAt(t++)],i=t<e.length?n[e.charAt(t)]:0;++t;var a=t<e.length?n[e.charAt(t)]:64;++t;var o=t<e.length?n[e.charAt(t)]:64;if(++t,null==s||null==i||null==a||null==o)throw Error();r.push(s<<2|i>>4),64!==a&&(r.push(i<<4&240|a>>2),64!==o&&r.push(a<<6&192|o))}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},base64Encode=function(t){t=stringToByteArray$1(t);return base64.encodeByteArray(t,!0)},base64urlEncodeWithoutPadding=function(t){return base64Encode(t).replace(/\./g,"")};function createMockUserToken(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=e||"demo-project",r=t.iat||0,e=t.sub||t.user_id;if(!e)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");t=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:e,user_id:e,firebase:{sign_in_provider:"custom",identities:{}}},t);return[base64urlEncodeWithoutPadding(JSON.stringify({alg:"none",type:"JWT"})),base64urlEncodeWithoutPadding(JSON.stringify(t)),""].join(".")}const ERROR_NAME="FirebaseError";class FirebaseError extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name=ERROR_NAME,Object.setPrototypeOf(this,FirebaseError.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ErrorFactory.prototype.create)}}class ErrorFactory{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){var n=e[0]||{},e=`${this.service}/${t}`,t=this.errors[t],t=t?replaceTemplate(t,n):"Error",t=`${this.serviceName}: ${t} (${e}).`;return new FirebaseError(e,t,n)}}function replaceTemplate(t,r){return t.replace(PATTERN,(t,e)=>{var n=r[e];return null!=n?String(n):`<${e}?>`})}const PATTERN=/\{\$([^}]+)}/g;function getModularInstance(t){return t&&t._delegate?t._delegate:t}class Component{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}var LogLevel,lt,ft;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(LogLevel=LogLevel||{});const levelStringToEnum={debug:LogLevel.DEBUG,verbose:LogLevel.VERBOSE,info:LogLevel.INFO,warn:LogLevel.WARN,error:LogLevel.ERROR,silent:LogLevel.SILENT},defaultLogLevel=LogLevel.INFO,ConsoleMethod={[LogLevel.DEBUG]:"log",[LogLevel.VERBOSE]:"log",[LogLevel.INFO]:"info",[LogLevel.WARN]:"warn",[LogLevel.ERROR]:"error"},defaultLogHandler=(t,e,...n)=>{if(!(e<t.logLevel)){var r=(new Date).toISOString(),s=ConsoleMethod[e];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[s](`[${r}]  ${t.name}:`,...n)}};class Logger{constructor(t){this.name=t,this._logLevel=defaultLogLevel,this._logHandler=defaultLogHandler,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in LogLevel))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?levelStringToEnum[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,LogLevel.DEBUG,...t),this._logHandler(this,LogLevel.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,LogLevel.VERBOSE,...t),this._logHandler(this,LogLevel.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,LogLevel.INFO,...t),this._logHandler(this,LogLevel.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,LogLevel.WARN,...t),this._logHandler(this,LogLevel.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,LogLevel.ERROR,...t),this._logHandler(this,LogLevel.ERROR,...t)}}class l{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}l.UNAUTHENTICATED=new l(null),l.GOOGLE_CREDENTIALS=new l("google-credentials-uid"),l.FIRST_PARTY=new l("first-party-uid"),l.MOCK_USER=new l("mock-user");let f="9.6.7";const d=new Logger("@firebase/firestore");function w(t){d.setLogLevel(t)}function m(t,...e){d.logLevel<=LogLevel.DEBUG&&(e=e.map(_),d.debug(`Firestore (${f}): ${t}`,...e))}function p(t,...e){d.logLevel<=LogLevel.ERROR&&(e=e.map(_),d.error(`Firestore (${f}): ${t}`,...e))}function y(t,...e){d.logLevel<=LogLevel.WARN&&(e=e.map(_),d.warn(`Firestore (${f}): ${t}`,...e))}function _(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function g(t="Unexpected state"){t=`FIRESTORE (${f}) INTERNAL ASSERTION FAILED: `+t;throw p(t),new Error(t)}function v(t,e){t||g()}function b(t,e){return t}const E="ok",T="cancelled",I="unknown",A="invalid-argument",R="deadline-exceeded",P="not-found",V="already-exists",D="permission-denied",N="unauthenticated",$="resource-exhausted",S="failed-precondition",F="aborted",x="out-of-range",q="unimplemented",O="internal",C="unavailable",L="data-loss";class U extends FirebaseError{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class k{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}class j{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class M{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(l.UNAUTHENTICATED))}shutdown(){}}class B{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}}class z{constructor(t){this.auth=null,t.onInit(t=>{this.auth=t})}getToken(){return this.auth?this.auth.getToken().then(t=>t?(v("string"==typeof t.accessToken),new j(t.accessToken,new l(this.auth.getUid()))):null):Promise.resolve(null)}invalidateToken(){}start(t,e){}shutdown(){}}class G{constructor(t,e,n){this.type="FirstParty",this.user=l.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",e);t=t.auth.getAuthHeaderValueForFirstParty([]);t&&this.headers.set("Authorization",t),n&&this.headers.set("X-Goog-Iam-Authorization-Token",n)}}class Q{constructor(t,e,n){this.t=t,this.i=e,this.o=n}getToken(){return Promise.resolve(new G(this.t,this.i,this.o))}start(t,e){t.enqueueRetryable(()=>e(l.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class W{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&0<t.length&&this.headers.set("x-firebase-appcheck",this.value)}}class Y{constructor(t){this.u=t,this.appCheck=null,t.onInit(t=>{this.appCheck=t})}getToken(){return this.appCheck?this.appCheck.getToken().then(t=>t?(v("string"==typeof t.token),new W(t.token)):null):Promise.resolve(null)}invalidateToken(){}start(t,e){}shutdown(){}}class H{constructor(t,e,n,r,s,i,a,o){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=a,this.useFetchStreams=o}}class K{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new K("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof K&&t.projectId===this.projectId&&t.database===this.database}}class J{constructor(t,e,n){void 0===e?e=0:e>t.length&&g(),void 0===n?n=t.length-e:n>t.length-e&&g(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===J.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof J?t.forEach(t=>{e.push(t)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(n){for(let t=this.offset,e=this.limit();t<e;t++)n(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let t=0;t<r;t++){const r=e.get(t),s=n.get(t);if(r<s)return-1;if(r>s)return 1}return e.length<n.length?-1:e.length>n.length?1:0}}class X extends J{construct(t,e,n){return new X(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(0<=n.indexOf("//"))throw new U(A,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter(t=>0<t.length))}return new X(e)}static emptyPath(){return new X([])}}const Z=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class tt extends J{construct(t,e,n){return new tt(t,e,n)}static isValidIdentifier(t){return Z.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),t=!tt.isValidIdentifier(t)?"`"+t+"`":t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new tt(["__name__"])}static fromServerFormat(t){const e=[];let n="",r=0;var s=()=>{if(0===n.length)throw new U(A,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let i=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new U(A,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new U(A,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?i=!i:"."!==e||i?n+=e:s(),r++}if(s(),i)throw new U(A,"Unterminated ` in path: "+t);return new tt(e)}static emptyPath(){return new tt([])}}class et{constructor(t){this.path=t}static fromPath(t){return new et(X.fromString(t))}static fromName(t){return new et(X.fromString(t).popFirst(5))}static empty(){return new et(X.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===X.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return X.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new et(new X(t.slice()))}}function nt(t,e,n){if(!n)throw new U(A,`Function ${t}() cannot be called with an empty ${e}.`)}function rt(t){if(!et.isDocumentKey(t))throw new U(A,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function st(t){if(et.isDocumentKey(t))throw new U(A,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function it(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"!=typeof t)return"function"==typeof t?"a function":g();if(t instanceof Array)return"an array";t=(t=t).constructor?t.constructor.name:null;return t?`a custom ${t} object`:"an object"}function ot(t,e){if((t="_delegate"in t?t._delegate:t)instanceof e)return t;if(e.name===t.constructor.name)throw new U(A,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");t=it(t);throw new U(A,`Expected type '${e.name}', but it was: ${t}`)}function ut(t,e){if(e<=0)throw new U(A,`Function ${t}() requires a positive number, but it was: ${e}.`)}function ct(t){return null==t}function at(t){return 0===t&&1/t==-1/0}const ht={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};function dt(t){if(void 0===t)return p("RPC_ERROR","HTTP error has no status"),I;switch(t){case 200:return E;case 400:return S;case 401:return N;case 403:return D;case 404:return P;case 409:return F;case 416:return x;case 429:return $;case 499:return T;case 500:return I;case 501:return q;case 503:return C;case 504:return R;default:return 200<=t&&t<300?E:400<=t&&t<500?S:500<=t&&t<600?O:I}}(ft=lt=lt||{})[ft.OK=0]="OK",ft[ft.CANCELLED=1]="CANCELLED",ft[ft.UNKNOWN=2]="UNKNOWN",ft[ft.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ft[ft.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ft[ft.NOT_FOUND=5]="NOT_FOUND",ft[ft.ALREADY_EXISTS=6]="ALREADY_EXISTS",ft[ft.PERMISSION_DENIED=7]="PERMISSION_DENIED",ft[ft.UNAUTHENTICATED=16]="UNAUTHENTICATED",ft[ft.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ft[ft.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ft[ft.ABORTED=10]="ABORTED",ft[ft.OUT_OF_RANGE=11]="OUT_OF_RANGE",ft[ft.UNIMPLEMENTED=12]="UNIMPLEMENTED",ft[ft.INTERNAL=13]="INTERNAL",ft[ft.UNAVAILABLE=14]="UNAVAILABLE",ft[ft.DATA_LOSS=15]="DATA_LOSS";class wt extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.h=e+"://"+t.host,this.l="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}m(e,t,n,r,s){const i=this.p(e,t);m("RestConnection","Sending: ",i,n);t={};return this.g(t,r,s),this.v(e,i,t,n).then(t=>(m("RestConnection","Received: ",t),t),t=>{throw y("RestConnection",`${e} failed with error: `,t,"url: ",i,"request:",n),t})}T(t,e,n,r,s){return this.m(t,e,n,r,s)}g(n,t,e){n["X-Goog-Api-Client"]="gl-js/ fire/"+f,n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,e)=>n[e]=t),e&&e.headers.forEach((t,e)=>n[e]=t)}p(t,e){t=ht[t];return`${this.h}/v1/${e}:${t}`}}{constructor(t,e){super(t),this.I=e}A(t,e){throw new Error("Not supported by FetchConnection")}async v(t,e,n,r){r=JSON.stringify(r);let s;try{s=await this.I(e,{method:"POST",headers:n,body:r})}catch(t){throw new U(dt(t.status),"Request failed with error: "+t.statusText)}if(!s.ok)throw new U(dt(s.status),"Request failed with error: "+s.statusText);return s.json()}}function mt(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class pt{static R(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){var s=mt(40);for(let t=0;t<s.length;++t)r.length<20&&s[t]<n&&(r+=e.charAt(s[t]%e.length))}return r}}function yt(t,e){return t<e?-1:e<t?1:0}function _t(t,n,r){return t.length===n.length&&t.every((t,e)=>r(t,n[e]))}class gt{constructor(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new U(A,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new U(A,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new U(A,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new U(A,"Timestamp seconds out of range: "+t)}static now(){return gt.fromMillis(Date.now())}static fromDate(t){return gt.fromMillis(t.getTime())}static fromMillis(t){var e=Math.floor(t/1e3),t=Math.floor(1e6*(t-1e3*e));return new gt(e,t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?yt(this.nanoseconds,t.nanoseconds):yt(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class vt{constructor(t){this.timestamp=t}static fromTimestamp(t){return new vt(t)}static min(){return new vt(new gt(0,0))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function bt(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Et(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}class Tt{constructor(t){(this.fields=t).sort(tt.comparator)}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return _t(this.fields,t.fields,(t,e)=>t.isEqual(e))}}class It{constructor(t){this.binaryString=t}static fromBase64String(t){t=atob(t);return new It(t)}static fromUint8Array(t){t=function(e){let n="";for(let t=0;t<e.length;++t)n+=String.fromCharCode(e[t]);return n}(t);return new It(t)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(e){const n=new Uint8Array(e.length);for(let t=0;t<e.length;t++)n[t]=e.charCodeAt(t);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return yt(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}It.EMPTY_BYTE_STRING=new It("");const At=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Rt(e){if(v(!!e),"string"!=typeof e)return{seconds:Pt(e.seconds),nanos:Pt(e.nanos)};{let t=0;var n=At.exec(e);v(!!n),n[1]&&(n=((n=n[1])+"000000000").substr(0,9),t=Number(n));const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}}function Pt(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Vt(t){return"string"==typeof t?It.fromBase64String(t):It.fromUint8Array(t)}function Dt(t){return"server_timestamp"===(null===(t=((null===(t=null==t?void 0:t.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Nt(t){t=t.mapValue.fields.__previous_value__;return Dt(t)?Nt(t):t}function $t(t){t=Rt(t.mapValue.fields.__local_write_time__.timestampValue);return new gt(t.seconds,t.nanos)}function St(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Dt(t)?4:10:g()}function Ft(n,r){if(n===r)return!0;var t,e,s=St(n);if(s!==St(r))return!1;switch(s){case 0:return!0;case 1:return n.booleanValue===r.booleanValue;case 4:return $t(n).isEqual($t(r));case 3:return function(t){if("string"==typeof n.timestampValue&&"string"==typeof t.timestampValue&&n.timestampValue.length===t.timestampValue.length)return n.timestampValue===t.timestampValue;var e=Rt(n.timestampValue),t=Rt(t.timestampValue);return e.seconds===t.seconds&&e.nanos===t.nanos}(r);case 5:return n.stringValue===r.stringValue;case 6:return e=r,Vt(n.bytesValue).isEqual(Vt(e.bytesValue));case 7:return n.referenceValue===r.referenceValue;case 8:return t=r,Pt((e=n).geoPointValue.latitude)===Pt(t.geoPointValue.latitude)&&Pt(e.geoPointValue.longitude)===Pt(t.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Pt(t.integerValue)===Pt(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){t=Pt(t.doubleValue),e=Pt(e.doubleValue);return t===e?at(t)===at(e):isNaN(t)&&isNaN(e)}return!1}(n,r);case 9:return _t(n.arrayValue.values||[],r.arrayValue.values||[],Ft);case 10:return function(t){const e=t.mapValue.fields||{},n=r.mapValue.fields||{};if(bt(e)!==bt(n))return!1;for(const t in e)if(e.hasOwnProperty(t)&&(void 0===n[t]||!Ft(e[t],n[t])))return!1;return!0}(n);default:return g()}}function xt(t,e){return void 0!==(t.values||[]).find(t=>Ft(t,e))}function qt(t,e){if(t===e)return 0;var n,r,s,i=St(t),a=St(e);if(i!==a)return yt(i,a);switch(i){case 0:return 0;case 1:return yt(t.booleanValue,e.booleanValue);case 2:return r=e,s=Pt(t.integerValue||t.doubleValue),r=Pt(r.integerValue||r.doubleValue),s<r?-1:r<s?1:s===r?0:isNaN(s)?isNaN(r)?0:-1:1;case 3:return Ot(t.timestampValue,e.timestampValue);case 4:return Ot($t(t),$t(e));case 5:return yt(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Vt(t),r=Vt(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){var n=t.split("/"),r=e.split("/");for(let t=0;t<n.length&&t<r.length;t++){const e=yt(n[t],r[t]);if(0!==e)return e}return yt(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return n=t.geoPointValue,s=e.geoPointValue,0!==(r=yt(Pt(n.latitude),Pt(s.latitude)))?r:yt(Pt(n.longitude),Pt(s.longitude));case 9:return function(t,e){var n=t.values||[],r=e.values||[];for(let t=0;t<n.length&&t<r.length;++t){const e=qt(n[t],r[t]);if(e)return e}return yt(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){const n=t.fields||{},r=Object.keys(n),s=e.fields||{},i=Object.keys(s);r.sort(),i.sort();for(let t=0;t<r.length&&t<i.length;++t){const e=yt(r[t],i[t]);if(0!==e)return e;var a=qt(n[r[t]],s[i[t]]);if(0!==a)return a}return yt(r.length,i.length)}(t.mapValue,e.mapValue);default:throw g()}}function Ot(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return yt(t,e);var n=Rt(t),t=Rt(e),e=yt(n.seconds,t.seconds);return 0!==e?e:yt(n.nanos,t.nanos)}function Ct(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Lt(t){return!!t&&"arrayValue"in t}function Ut(t){return!!t&&"nullValue"in t}function kt(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function jt(t){return!!t&&"mapValue"in t}function Mt(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const n={mapValue:{fields:{}}};return Et(e.mapValue.fields,(t,e)=>n.mapValue.fields[t]=Mt(e)),n}if(e.arrayValue){const r={arrayValue:{values:[]}};for(let t=0;t<(e.arrayValue.values||[]).length;++t)r.arrayValue.values[t]=Mt(e.arrayValue.values[t]);return r}return Object.assign({},e)}class Bt{constructor(t){this.value=t}static empty(){return new Bt({mapValue:{}})}field(n){if(n.isEmpty())return this.value;{let e=this.value;for(let t=0;t<n.length-1;++t)if(e=(e.mapValue.fields||{})[n.get(t)],!jt(e))return null;return e=(e.mapValue.fields||{})[n.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Mt(e)}setAll(t){let n=tt.emptyPath(),r={},s=[];t.forEach((t,e)=>{if(!n.isImmediateParentOf(e)){const t=this.getFieldsMap(n);this.applyChanges(t,r,s),r={},s=[],n=e.popLast()}t?r[e.lastSegment()]=Mt(t):s.push(e.lastSegment())});t=this.getFieldsMap(n);this.applyChanges(t,r,s)}delete(t){const e=this.field(t.popLast());jt(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Ft(this.value,t.value)}getFieldsMap(n){let r=this.value;r.mapValue.fields||(r.mapValue={fields:{}});for(let e=0;e<n.length;++e){let t=r.mapValue.fields[n.get(e)];jt(t)&&t.mapValue.fields||(t={mapValue:{fields:{}}},r.mapValue.fields[n.get(e)]=t),r=t}return r.mapValue.fields}applyChanges(n,t,e){Et(t,(t,e)=>n[t]=e);for(const t of e)delete n[t]}clone(){return new Bt(Mt(this.value))}}class zt{constructor(t,e,n,r,s,i){this.key=t,this.documentType=e,this.version=n,this.readTime=r,this.data=s,this.documentState=i}static newInvalidDocument(t){return new zt(t,0,vt.min(),vt.min(),Bt.empty(),0)}static newFoundDocument(t,e,n){return new zt(t,1,e,vt.min(),n,0)}static newNoDocument(t,e){return new zt(t,2,e,vt.min(),Bt.empty(),0)}static newUnknownDocument(t,e){return new zt(t,3,e,vt.min(),Bt.empty(),2)}convertToFoundDocument(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Bt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Bt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof zt&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new zt(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Gt{constructor(t,e=null,n=[],r=[],s=null,i=null,a=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=a,this.P=null}}function Qt(t,e=null,n=[],r=[],s=null,i=null,a=null){return new Gt(t,e,n,r,s,i,a)}class Wt extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.V(t,e,n):new Yt(t,e,n):"array-contains"===e?new Xt(t,n):"in"===e?new Zt(t,n):"not-in"===e?new te(t,n):"array-contains-any"===e?new ee(t,n):new Wt(t,e,n)}static V(t,e,n){return new("in"===e?Ht:Kt)(t,n)}matches(t){t=t.data.field(this.field);return"!="===this.op?null!==t&&this.D(qt(t,this.value)):null!==t&&St(this.value)===St(t)&&this.D(qt(t,this.value))}D(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return 0<t;case">=":return 0<=t;default:return g()}}N(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)}}class Yt extends Wt{constructor(t,e,n){super(t,e,n),this.key=et.fromName(n.referenceValue)}matches(t){t=et.comparator(t.key,this.key);return this.D(t)}}class Ht extends Wt{constructor(t,e){super(t,"in",e),this.keys=Jt("in",e)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Kt extends Wt{constructor(t,e){super(t,"not-in",e),this.keys=Jt("not-in",e)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Jt(t,e){return((null===(e=e.arrayValue)||void 0===e?void 0:e.values)||[]).map(t=>et.fromName(t.referenceValue))}class Xt extends Wt{constructor(t,e){super(t,"array-contains",e)}matches(t){t=t.data.field(this.field);return Lt(t)&&xt(t.arrayValue,this.value)}}class Zt extends Wt{constructor(t,e){super(t,"in",e)}matches(t){t=t.data.field(this.field);return null!==t&&xt(this.value.arrayValue,t)}}class te extends Wt{constructor(t,e){super(t,"not-in",e)}matches(t){if(xt(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;t=t.data.field(this.field);return null!==t&&!xt(this.value.arrayValue,t)}}class ee extends Wt{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Lt(e)||!e.arrayValue.values)&&e.arrayValue.values.some(t=>xt(this.value.arrayValue,t))}}class ne{constructor(t,e){this.position=t,this.inclusive=e}}class re{constructor(t,e="asc"){this.field=t,this.dir=e}}function se(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function ie(e,n){if(null===e)return null===n;if(null===n)return!1;if(e.inclusive!==n.inclusive||e.position.length!==n.position.length)return!1;for(let t=0;t<e.position.length;t++)if(!Ft(e.position[t],n.position[t]))return!1;return!0}class oe{constructor(t,e=null,n=[],r=[],s=null,i="F",a=null,o=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=i,this.startAt=a,this.endAt=o,this.$=null,this.S=null,this.startAt,this.endAt}}function ue(t){return!ct(t.limit)&&"L"===t.limitType}function ce(t){return 0<t.explicitOrderBy.length?t.explicitOrderBy[0].field:null}function ae(t){for(const e of t.filters)if(e.N())return e.field;return null}function he(t){return null!==t.collectionGroup}function le(e){const n=b(e);if(null===n.$){n.$=[];const e=ae(n),t=ce(n);if(null!==e&&null===t)e.isKeyField()||n.$.push(new re(e)),n.$.push(new re(tt.keyField(),"asc"));else{let t=!1;for(const r of n.explicitOrderBy)n.$.push(r),r.field.isKeyField()&&(t=!0);if(!t){const e=0<n.explicitOrderBy.length?n.explicitOrderBy[n.explicitOrderBy.length-1].dir:"asc";n.$.push(new re(tt.keyField(),e))}}}return n.$}function fe(t){const e=b(t);if(!e.S)if("F"===e.limitType)e.S=Qt(e.path,e.collectionGroup,le(e),e.filters,e.limit,e.startAt,e.endAt);else{const r=[];for(const s of le(e)){const e="desc"===s.dir?"asc":"desc";r.push(new re(s.field,e))}var n=e.endAt?new ne(e.endAt.position,!e.endAt.inclusive):null,t=e.startAt?new ne(e.startAt.position,!e.startAt.inclusive):null;e.S=Qt(e.path,e.collectionGroup,r,e.filters,e.limit,n,t)}return e.S}function de(t,e){return function(e,n){if(e.limit!==n.limit)return!1;if(e.orderBy.length!==n.orderBy.length)return!1;for(let t=0;t<e.orderBy.length;t++)if(!se(e.orderBy[t],n.orderBy[t]))return!1;if(e.filters.length!==n.filters.length)return!1;for(let t=0;t<e.filters.length;t++)if(r=e.filters[t],s=n.filters[t],r.op!==s.op||!r.field.isEqual(s.field)||!Ft(r.value,s.value))return!1;var r,s;return e.collectionGroup===n.collectionGroup&&!!e.path.isEqual(n.path)&&!!ie(e.startAt,n.startAt)&&ie(e.endAt,n.endAt)}(fe(t),fe(e))&&t.limitType===e.limitType}function we(e,t){return"number"==typeof(n=t)&&Number.isInteger(n)&&!at(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER?{integerValue:""+t}:function(t){if(e.F){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:at(t)?"-0":t}}(t);var n}class me{constructor(){this._=void 0}}class pe extends me{}class ye extends me{constructor(t){super(),this.elements=t}}class _e extends me{constructor(t){super(),this.elements=t}}class ge extends me{constructor(t,e){super(),this.q=t,this.O=e}}class ve{constructor(t,e){this.field=t,this.transform=e}}class be{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new be}static exists(t){return new be(void 0,t)}static updateTime(t){return new be(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}class Ee{}class Te extends Ee{constructor(t,e,n,r=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}}class Ie extends Ee{constructor(t,e,n,r,s=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}}class Ae extends Ee{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}}class Re extends Ee{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}}const Pe={asc:"ASCENDING",desc:"DESCENDING"},Ve={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class De{constructor(t,e){this.databaseId=t,this.F=e}}function Ne(t,e){return t.F?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function $e(t,e){return t.F?e.toBase64():e.toUint8Array()}function Se(t,e){return Ne(t,e.toTimestamp())}function Fe(t){return v(!!t),vt.fromTimestamp((t=Rt(t),new gt(t.seconds,t.nanos)))}function xe(t,e){return t=t,new X(["projects",t.projectId,"databases",t.database]).child("documents").child(e).canonicalString()}function qe(t,e){return xe(t.databaseId,e.path)}function Oe(t,e){const n=function(t){t=X.fromString(t);return v(We(t)),t}(e);if(n.get(1)!==t.databaseId.projectId)throw new U(A,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new U(A,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new et((v(4<(t=n).length&&"documents"===t.get(4)),t.popFirst(5)))}function Ce(t,e){return xe(t.databaseId,e)}function Le(t){return new X(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Ue(t,e,n){return{name:qe(t,e),fields:n.value.mapValue.fields}}function ke(t,e){return"found"in e?function(t,e){v(!!e.found),e.found.name,e.found.updateTime;var n=Oe(t,e.found.name),t=Fe(e.found.updateTime),e=new Bt({mapValue:{fields:e.found.fields}});return zt.newFoundDocument(n,t,e)}(t,e):"missing"in e?function(t,e){v(!!e.missing),v(!!e.readTime);t=Oe(t,e.missing),e=Fe(e.readTime);return zt.newNoDocument(t,e)}(t,e):g()}function je(t,e){let n;if(e instanceof Te)n={update:Ue(t,e.key,e.value)};else if(e instanceof Ae)n={delete:qe(t,e.key)};else if(e instanceof Ie)n={update:Ue(t,e.key,e.data),updateMask:Qe(e.fieldMask)};else{if(!(e instanceof Re))return g();n={verify:qe(t,e.key)}}return 0<e.fieldTransforms.length&&(n.updateTransforms=e.fieldTransforms.map(t=>function(t){var e=t.transform;if(e instanceof pe)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(e instanceof ye)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:e.elements}};if(e instanceof _e)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:e.elements}};if(e instanceof ge)return{fieldPath:t.field.canonicalString(),increment:e.O};throw g()}(t))),e.precondition.isNone||(n.currentDocument=void 0!==(e=e.precondition).updateTime?{updateTime:Se(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:g()),n}function Me(t,e){const n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Ce(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Ce(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var s=function(t){if(0!==t.length){t=t.map(t=>function(t){if("=="===t.op){if(kt(t.value))return{unaryFilter:{field:Ge(t.field),op:"IS_NAN"}};if(Ut(t.value))return{unaryFilter:{field:Ge(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(kt(t.value))return{unaryFilter:{field:Ge(t.field),op:"IS_NOT_NAN"}};if(Ut(t.value))return{unaryFilter:{field:Ge(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ge(t.field),op:ze(t.op),value:t.value}}}(t));return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}}(e.filters);s&&(n.structuredQuery.where=s);s=function(t){if(0!==t.length)return t.map(t=>function(t){return{field:Ge(t.field),direction:Be(t.dir)}}(t))}(e.orderBy);s&&(n.structuredQuery.orderBy=s);s=e.limit,s=t.F||ct(s)?s:{value:s};return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt={before:(s=e.startAt).inclusive,values:s.position}),e.endAt&&(n.structuredQuery.endAt={before:!(e=e.endAt).inclusive,values:e.position}),n}function Be(t){return Pe[t]}function ze(t){return Ve[t]}function Ge(t){return{fieldPath:t.canonicalString()}}function Qe(t){const e=[];return t.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function We(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}function Ye(t){return new De(t,!0)}class He{constructor(t,e,n=1e3,r=1.5,s=6e4){this.C=t,this.timerId=e,this.L=n,this.U=r,this.k=s,this.j=0,this.M=null,this.B=Date.now(),this.reset()}reset(){this.j=0}G(){this.j=this.k}W(t){this.cancel();var e=Math.floor(this.j+this.Y()),n=Math.max(0,Date.now()-this.B),r=Math.max(0,e-n);0<r&&m("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.j} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.M=this.C.enqueueAfterDelay(this.timerId,r,()=>(this.B=Date.now(),t())),this.j*=this.U,this.j<this.L&&(this.j=this.L),this.j>this.k&&(this.j=this.k)}H(){null!==this.M&&(this.M.skipDelay(),this.M=null)}cancel(){null!==this.M&&(this.M.cancel(),this.M=null)}Y(){return(Math.random()-.5)*this.j}}class Ke extends class{}{constructor(t,e,n,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.K=n,this.q=r,this.J=!1}X(){if(this.J)throw new U(S,"The client has already been terminated.")}m(n,r,s){return this.X(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([t,e])=>this.K.m(n,r,s,t,e)).catch(t=>{throw"FirebaseError"===t.name?(t.code===N&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new U(I,t.toString())})}T(n,r,s){return this.X(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([t,e])=>this.K.T(n,r,s,t,e)).catch(t=>{throw"FirebaseError"===t.name?(t.code===N&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new U(I,t.toString())})}terminate(){this.J=!0}}async function Je(t,e){const n=b(t),r=Le(n.q)+"/documents",s={writes:e.map(t=>je(n.q,t))};await n.m("Commit",r,s)}async function Xe(t,e){const n=b(t),r=Le(n.q)+"/documents",s={documents:e.map(t=>qe(n.q,t))},i=await n.T("BatchGetDocuments",r,s),a=new Map;i.forEach(t=>{const e=ke(n.q,t);a.set(e.key.toString(),e)});const o=[];return e.forEach(t=>{t=a.get(t.toString());v(!!t),o.push(t)}),o}async function Ze(t,e){const n=b(t),r=Me(n.q,fe(e));return(await n.T("RunQuery",r.parent,{structuredQuery:r.structuredQuery})).filter(t=>!!t.document).map(t=>function(t,e){const n=Oe(t,e.name),r=Fe(e.updateTime),s=new Bt({mapValue:{fields:e.fields}}),i=zt.newFoundDocument(n,r,s);return i}(n.q,t.document))}const tn=new Map;function en(t){if(t._terminated)throw new U(S,"The client has already been terminated.");var e,n,r,s;return tn.has(t)||(m("ComponentProvider","Initializing Datastore"),e=t._databaseId,n=t.app.options.appId||"",r=t._persistenceKey,s=t._freezeSettings(),e=new H(e,n,r,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,s.useFetchStreams),n=new wt(e,fetch.bind(null)),r=Ye(t._databaseId),s=t._authCredentials,e=t._appCheckCredentials,n=n,r=r,r=new Ke(s,e,n,r),tn.set(t,r)),tn.get(t)}class nn{constructor(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new U(A,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new U(A,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,function(t,e){if(!0===t&&!0===e)throw new U(A,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")}(t.experimentalForceLongPolling,t.experimentalAutoDetectLongPolling)}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class rn{constructor(t,e,n){this._authCredentials=e,this._appCheckCredentials=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new nn({}),this._settingsFrozen=!1,t instanceof K?this._databaseId=t:(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new U(A,'"projectId" not provided in firebase.initializeApp.');return new K(t.options.projectId)}(t))}get app(){if(!this._app)throw new U(S,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new U(S,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new nn(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new M;switch(t.type){case"gapi":var e=t.client;return v(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Q(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new U(A,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=tn.get(t);e&&(m("ComponentProvider","Removing Datastore"),tn.delete(t),e.terminate())}(this),Promise.resolve()}}function sn(t,e){const n=_getProvider(t,"firestore/lite");if(n.isInitialized())throw new U(S,"Firestore can only be initialized once per app.");return n.initialize({options:e})}function on(t=getApp()){return _getProvider(t,"firestore/lite").getImmediate()}function un(n,t,r,s={}){const i=(n=ot(n,rn))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==t&&y("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},i),{host:`${t}:${r}`,ssl:!1})),s.mockUserToken){let t,e;if("string"==typeof s.mockUserToken)t=s.mockUserToken,e=l.MOCK_USER;else{t=createMockUserToken(s.mockUserToken,null===(r=n._app)||void 0===r?void 0:r.options.projectId);const i=s.mockUserToken.sub||s.mockUserToken.user_id;if(!i)throw new U(A,"mockUserToken must contain 'sub' or 'user_id' field!");e=new l(i)}n._authCredentials=new B(new j(t,e))}}function cn(t){return t=ot(t,rn),_removeServiceInstance(t.app,"firestore/lite"),t._delete()}class an{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ln(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new an(this.firestore,t,this._key)}}class hn{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new hn(this.firestore,t,this._query)}}class ln extends hn{constructor(t,e,n){super(t,e,new oe(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new an(this.firestore,null,new et(t))}withConverter(t){return new ln(this.firestore,t,this._path)}}function fn(t,e,...n){if(t=getModularInstance(t),nt("collection","path",e),t instanceof rn){var r=X.fromString(e,...n);return st(r),new ln(t,null,r)}if(!(t instanceof an||t instanceof ln))throw new U(A,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");n=t._path.child(X.fromString(e,...n));return st(n),new ln(t.firestore,null,n)}function dn(t,e){if(t=ot(t,rn),nt("collectionGroup","collection id",e),0<=e.indexOf("/"))throw new U(A,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new hn(t,null,(e=e,new oe(X.emptyPath(),e)))}function wn(t,e,...n){if(t=getModularInstance(t),nt("doc","path",e=1===arguments.length?pt.R():e),t instanceof rn){var r=X.fromString(e,...n);return rt(r),new an(t,null,new et(r))}if(!(t instanceof an||t instanceof ln))throw new U(A,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");r=t._path.child(X.fromString(e,...n));return rt(r),new an(t.firestore,t instanceof ln?t.converter:null,new et(r))}function mn(t,e){return t=getModularInstance(t),e=getModularInstance(e),(t instanceof an||t instanceof ln)&&(e instanceof an||e instanceof ln)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function pn(t,e){return t=getModularInstance(t),e=getModularInstance(e),t instanceof hn&&e instanceof hn&&t.firestore===e.firestore&&de(t._query,e._query)&&t.converter===e.converter}class yn{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new U(A,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new tt(e)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}function _n(){return new yn("__name__")}class gn{constructor(t){this._byteString=t}static fromBase64String(t){try{return new gn(It.fromBase64String(t))}catch(t){throw new U(A,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new gn(It.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class vn{constructor(t){this._methodName=t}}class bn{constructor(t,e){if(!isFinite(t)||t<-90||90<t)throw new U(A,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new U(A,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return yt(this._lat,t._lat)||yt(this._long,t._long)}}const En=/^__.*__$/;class Tn{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new Ie(t,this.data,this.fieldMask,e,this.fieldTransforms):new Te(t,this.data,e,this.fieldTransforms)}}class In{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new Ie(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function An(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw g()}}class Rn{constructor(t,e,n,r,s,i){this.settings=t,this.databaseId=e,this.q=n,this.ignoreUndefinedProperties=r,void 0===s&&this.Z(),this.fieldTransforms=s||[],this.fieldMask=i||[]}get path(){return this.settings.path}get tt(){return this.settings.tt}et(t){return new Rn(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.q,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}nt(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.et({path:n,rt:!1});return r.st(t),r}it(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.et({path:n,rt:!1});return r.Z(),r}ot(t){return this.et({path:void 0,rt:!0})}ut(t){return Qn(t,this.settings.methodName,this.settings.ct||!1,this.path,this.settings.at)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Z(){if(this.path)for(let t=0;t<this.path.length;t++)this.st(this.path.get(t))}st(t){if(0===t.length)throw this.ut("Document fields must not be empty");if(An(this.tt)&&En.test(t))throw this.ut('Document fields cannot begin and end with "__"')}}class Pn{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.q=n||Ye(t)}ht(t,e,n,r=!1){return new Rn({tt:t,methodName:e,at:n,path:tt.emptyPath(),rt:!1,ct:r},this.databaseId,this.q,this.ignoreUndefinedProperties)}}function Vn(t){var e=t._freezeSettings(),n=Ye(t._databaseId);return new Pn(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Dn(t,e,n,r,s,i={}){const a=t.ht(i.merge||i.mergeFields?2:0,e,n,s);Mn("Data must be an object, but it was:",a,r);r=kn(r,a);let o,u;if(i.merge)o=new Tt(a.fieldMask),u=a.fieldTransforms;else if(i.mergeFields){const t=[];for(const l of i.mergeFields){const s=Bn(e,l,n);if(!a.contains(s))throw new U(A,`Field '${s}' is specified in your field mask but missing from your input data.`);Wn(t,s)||t.push(s)}o=new Tt(t),u=a.fieldTransforms.filter(t=>o.covers(t.field))}else o=null,u=a.fieldTransforms;return new Tn(new Bt(r),o,u)}class Nn extends vn{_toFieldTransform(t){if(2!==t.tt)throw 1===t.tt?t.ut(`${this._methodName}() can only appear at the top level of your update data`):t.ut(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof Nn}}function $n(t,e,n){return new Rn({tt:3,at:e.settings.at,methodName:t._methodName,rt:n},e.databaseId,e.q,e.ignoreUndefinedProperties)}class Sn extends vn{_toFieldTransform(t){return new ve(t.path,new pe)}isEqual(t){return t instanceof Sn}}class Fn extends vn{constructor(t,e){super(t),this.lt=e}_toFieldTransform(t){const e=$n(this,t,!0),n=this.lt.map(t=>Un(t,e)),r=new ye(n);return new ve(t.path,r)}isEqual(t){return this===t}}class xn extends vn{constructor(t,e){super(t),this.lt=e}_toFieldTransform(t){const e=$n(this,t,!0),n=this.lt.map(t=>Un(t,e)),r=new _e(n);return new ve(t.path,r)}isEqual(t){return this===t}}class qn extends vn{constructor(t,e){super(t),this.ft=e}_toFieldTransform(t){var e=new ge(t.q,we(t.q,this.ft));return new ve(t.path,e)}isEqual(t){return this===t}}function On(t,s,i,e){const a=t.ht(1,s,i);Mn("Data must be an object, but it was:",a,e);const o=[],u=Bt.empty();Et(e,(t,e)=>{var n=Gn(s,t,i);e=getModularInstance(e);t=a.it(n);if(e instanceof Nn)o.push(n);else{const r=Un(e,t);null!=r&&(o.push(n),u.set(n,r))}});e=new Tt(o);return new In(u,e,a.fieldTransforms)}function Cn(e,n,t,r,s,i){const a=e.ht(1,n,t),o=[Bn(n,r,t)],u=[s];if(i.length%2!=0)throw new U(A,`Function ${n}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<i.length;t+=2)o.push(Bn(n,i[t])),u.push(i[t+1]);const l=[],c=Bt.empty();for(let t=o.length-1;0<=t;--t)if(!Wn(l,o[t])){const n=o[t];var h=getModularInstance(h=u[t]);const r=a.it(n);if(h instanceof Nn)l.push(n);else{const e=Un(h,r);null!=e&&(l.push(n),c.set(n,e))}}s=new Tt(l);return new In(c,s,a.fieldTransforms)}function Ln(t,e,n,r=!1){return Un(n,t.ht(r?4:3,e))}function Un(i,t){if(jn(i=getModularInstance(i)))return Mn("Unsupported field value:",t,i),kn(i,t);if(i instanceof vn)return function(t,e){if(!An(e.tt))throw e.ut(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.ut(`${t._methodName}() is not currently supported inside arrays`);t=t._toFieldTransform(e);t&&e.fieldTransforms.push(t)}(i,t),null;if(void 0===i&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),i instanceof Array){if(t.settings.rt&&4!==t.tt)throw t.ut("Nested arrays are not supported");return function(e){const n=[];let r=0;for(const s of i){let t=Un(s,e.ot(r));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),r++}return{arrayValue:{values:n}}}(t)}return function(t,e){if(null===(t=getModularInstance(i)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return we(e.q,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=gt.fromDate(t);return{timestampValue:Ne(e.q,n)}}if(t instanceof gt){n=new gt(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Ne(e.q,n)}}if(t instanceof bn)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof gn)return{bytesValue:$e(e.q,t._byteString)};if(t instanceof an){const r=e.databaseId,s=t.firestore._databaseId;if(!s.isEqual(r))throw e.ut(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:xe(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.ut(`Unsupported field value: ${it(t)}`)}(0,t)}function kn(t,n){const r={};return function(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return;return 1}(t)?n.path&&0<n.path.length&&n.fieldMask.push(n.path):Et(t,(t,e)=>{e=Un(e,n.nt(t));null!=e&&(r[t]=e)}),{mapValue:{fields:r}}}function jn(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof gt||t instanceof bn||t instanceof gn||t instanceof an||t instanceof vn)}function Mn(t,e,n){if(!jn(n)||("object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r))){n=it(n);throw"an object"===n?e.ut(t+" a custom object"):e.ut(t+" "+n)}var r}function Bn(t,e,n){if((e=getModularInstance(e))instanceof yn)return e._internalPath;if("string"==typeof e)return Gn(t,e);throw Qn("Field path arguments must be of type string or ",t,!1,void 0,n)}const zn=new RegExp("[~\\*/\\[\\]]");function Gn(e,n,r){if(0<=n.search(zn))throw Qn(`Invalid field path (${n}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,r);try{return new yn(...n.split("."))._internalPath}catch(t){throw Qn(`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,r)}}function Qn(t,e,n,r,s){var i=r&&!r.isEmpty(),a=void 0!==s;let o=`Function ${e}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let u="";return(i||a)&&(u+=" (found",i&&(u+=` in field ${r}`),a&&(u+=` in document ${s}`),u+=")"),new U(A,o+t+u)}function Wn(t,e){return t.some(t=>t.isEqual(e))}class Yn{constructor(t,e,n,r,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new an(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){var t=new Hn(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){t=this._document.data.field(Xn("DocumentSnapshot.get",t));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Hn extends Yn{data(){return super.data()}}class Kn{constructor(t,e){this._docs=e,this.query=t}get docs(){return[...this._docs]}get size(){return this.docs.length}get empty(){return 0===this.docs.length}forEach(t,e){this._docs.forEach(t,e)}}function Jn(t,e){return t=getModularInstance(t),e=getModularInstance(e),t instanceof Yn&&e instanceof Yn?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Kn&&e instanceof Kn&&pn(t.query,e.query)&&_t(t.docs,e.docs,Jn)}function Xn(t,e){return"string"==typeof e?Gn(t,e):(e instanceof yn?e:e._delegate)._internalPath}class Zn{}function tr(t,...e){for(const n of e)t=n._apply(t);return t}class er extends Zn{constructor(t,e,n){super(),this.dt=t,this.wt=e,this.yt=n,this.type="where"}_apply(t){var e=Vn(t.firestore),e=function(t,e,n,r,s,i,a){let o;if(s.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new U(A,`Invalid Query. You can't perform '${i}' queries on documentId().`);if("in"===i||"not-in"===i){pr(a,i);const e=[];for(const n of a)e.push(mr(r,t,n));o={arrayValue:{values:e}}}else o=mr(r,t,a)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||pr(a,i),o=Ln(n,e,a,"in"===i||"not-in"===i);i=Wt.create(s,i,o);return function(t,e){if(e.N()){const r=ae(t);if(null!==r&&!r.isEqual(e.field))throw new U(A,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${r.toString()}' and '${e.field.toString()}'`);var n=ce(t);null!==n&&yr(t,e.field,n)}const r=function(t,e){for(const n of t.filters)if(0<=e.indexOf(n.op))return n.op;return null}(t,function(){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==r)throw r===e.op?new U(A,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new U(A,`Invalid query. You cannot use '${e.op.toString()}' filters with '${r.toString()}' filters.`)}(t,i),i}(t._query,"where",e,t.firestore._databaseId,this.dt,this.wt,this.yt);return new hn(t.firestore,t.converter,(t=t._query,e=t.filters.concat([e]),new oe(t.path,t.collectionGroup,t.explicitOrderBy.slice(),e,t.limit,t.limitType,t.startAt,t.endAt)))}}function nr(t,e,n){t=Xn("where",t);return new er(t,e,n)}class rr extends Zn{constructor(t,e){super(),this.dt=t,this._t=e,this.type="orderBy"}_apply(t){var e=function(t,e,n){if(null!==t.startAt)throw new U(A,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new U(A,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new re(e,n);return e=r,null!==ce(n=t)||null!==(t=ae(n))&&yr(n,t,e.field),r}(t._query,this.dt,this._t);return new hn(t.firestore,t.converter,(t=t._query,e=t.explicitOrderBy.concat([e]),new oe(t.path,t.collectionGroup,e,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)))}}function sr(t,e="asc"){t=Xn("orderBy",t);return new rr(t,e)}class ir extends Zn{constructor(t,e,n){super(),this.type=t,this.gt=e,this.vt=n}_apply(t){return new hn(t.firestore,t.converter,(e=t._query,n=this.gt,t=this.vt,new oe(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),n,t,e.startAt,e.endAt)));var e,n}}function or(t){return ut("limit",t),new ir("limit",t,"F")}function ur(t){return ut("limitToLast",t),new ir("limitToLast",t,"L")}class cr extends Zn{constructor(t,e,n){super(),this.type=t,this.bt=e,this.Et=n}_apply(t){var e=wr(t,this.type,this.bt,this.Et);return new hn(t.firestore,t.converter,(t=t._query,e=e,new oe(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)))}}function ar(...t){return new cr("startAt",t,!0)}function hr(...t){return new cr("startAfter",t,!1)}class lr extends Zn{constructor(t,e,n){super(),this.type=t,this.bt=e,this.Et=n}_apply(t){var e=wr(t,this.type,this.bt,this.Et);return new hn(t.firestore,t.converter,(t=t._query,e=e,new oe(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)))}}function fr(...t){return new lr("endBefore",t,!1)}function dr(...t){return new lr("endAt",t,!0)}function wr(t,e,n,r){if(n[0]=getModularInstance(n[0]),n[0]instanceof Yn)return function(t,e,n,r,s){if(!r)throw new U(P,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const i=[];for(const n of le(t))if(n.field.isKeyField())i.push(Ct(e,r.key));else{const t=r.data.field(n.field);if(Dt(t))throw new U(A,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t){const t=n.field.canonicalString();throw new U(A,`Invalid query. You are trying to start or end a query using a document for which the field '${t}' (used as the orderBy) does not exist.`)}i.push(t)}return new ne(i,s)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var s=Vn(t.firestore);return function(e,n,r,s,i,t){const a=e.explicitOrderBy;if(i.length>a.length)throw new U(A,`Too many arguments provided to ${s}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const o=[];for(let t=0;t<i.length;t++){const u=i[t];if(a[t].field.isKeyField()){if("string"!=typeof u)throw new U(A,`Invalid query. Expected a string for document ID in ${s}(), but got a ${typeof u}`);if(!he(e)&&-1!==u.indexOf("/"))throw new U(A,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${s}() must be a plain document ID, but '${u}' contains a slash.`);const r=e.path.child(X.fromString(u));if(!et.isDocumentKey(r))throw new U(A,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${s}() must result in a valid document path, but '${r}' is not because it contains an odd number of segments.`);const i=new et(r);o.push(Ct(n,i))}else{const e=Ln(r,s,u);o.push(e)}}return new ne(o,t)}(t._query,t.firestore._databaseId,s,e,n,r)}function mr(t,e,n){if("string"==typeof(n=getModularInstance(n))){if(""===n)throw new U(A,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!he(e)&&-1!==n.indexOf("/"))throw new U(A,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);e=e.path.child(X.fromString(n));if(!et.isDocumentKey(e))throw new U(A,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${e}' is not because it has an odd number of segments (${e.length}).`);return Ct(t,new et(e))}if(n instanceof an)return Ct(t,n._key);throw new U(A,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${it(n)}.`)}function pr(t,e){if(!Array.isArray(t)||0===t.length)throw new U(A,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(10<t.length)throw new U(A,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function yr(t,e,n){if(!n.isEqual(e))throw new U(A,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}function _r(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}class gr extends class{convertValue(t,e="none"){switch(St(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Pt(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Vt(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw g()}}convertObject(t,n){const r={};return Et(t.fields,(t,e)=>{r[t]=this.convertValue(e,n)}),r}convertGeoPoint(t){return new bn(Pt(t.latitude),Pt(t.longitude))}convertArray(t,e){return(t.values||[]).map(t=>this.convertValue(t,e))}convertServerTimestamp(t,e){switch(e){case"previous":var n=Nt(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp($t(t));default:return null}}convertTimestamp(t){t=Rt(t);return new gt(t.seconds,t.nanos)}convertDocumentKey(t,e){const n=X.fromString(t);v(We(n));const r=new K(n.get(1),n.get(3)),s=new et(n.popFirst(5));return r.isEqual(e)||p(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}}{constructor(t){super(),this.firestore=t}convertBytes(t){return new gn(t)}convertReference(t){t=this.convertDocumentKey(t,this.firestore._databaseId);return new an(this.firestore,null,t)}}function vr(n){const t=en((n=ot(n,an)).firestore),r=new gr(n.firestore);return Xe(t,[n._key]).then(t=>{v(1===t.length);const e=t[0];return new Yn(n.firestore,r,n._key,e.isFoundDocument()?e:null,n.converter)})}function br(n){!function(t){if(ue(t)&&0===t.explicitOrderBy.length)throw new U(q,"limitToLast() queries require specifying at least one orderBy() clause")}((n=ot(n,hn))._query);const t=en(n.firestore),r=new gr(n.firestore);return Ze(t,n._query).then(t=>{const e=t.map(t=>new Hn(n.firestore,r,t.key,t,n.converter));return ue(n._query)&&e.reverse(),new Kn(n,e)})}function Er(t,e,n){const r=_r((t=ot(t,an)).converter,e,n),s=Dn(Vn(t.firestore),"setDoc",t._key,r,null!==t.converter,n);return Je(en(t.firestore),[s.toMutation(t._key,be.none())])}function Tr(t,e,n,...r){var s=Vn((t=ot(t,an)).firestore);let i;return i="string"==typeof(e=getModularInstance(e))||e instanceof yn?Cn(s,"updateDoc",t._key,e,n,r):On(s,"updateDoc",t._key,e),Je(en(t.firestore),[i.toMutation(t._key,be.exists(!0))])}function Ir(t){return Je(en((t=ot(t,an)).firestore),[new Ae(t._key,be.none())])}function Ar(t,e){const n=wn(t=ot(t,ln)),r=_r(t.converter,e),s=Dn(Vn(t.firestore),"addDoc",n._key,r,null!==n.converter,{});return Je(en(t.firestore),[s.toMutation(n._key,be.exists(!1))]).then(()=>n)}function Rr(){return new Nn("deleteField")}function Pr(){return new Sn("serverTimestamp")}function Vr(...t){return new Fn("arrayUnion",t)}function Dr(...t){return new xn("arrayRemove",t)}function Nr(t){return new qn("increment",t)}class $r{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Vn(t)}set(t,e,n){this._verifyNotCommitted();const r=Sr(t,this._firestore),s=_r(r.converter,e,n),i=Dn(this._dataReader,"WriteBatch.set",r._key,s,null!==r.converter,n);return this._mutations.push(i.toMutation(r._key,be.none())),this}update(t,e,n,...r){this._verifyNotCommitted();t=Sr(t,this._firestore);let s;return s="string"==typeof(e=getModularInstance(e))||e instanceof yn?Cn(this._dataReader,"WriteBatch.update",t._key,e,n,r):On(this._dataReader,"WriteBatch.update",t._key,e),this._mutations.push(s.toMutation(t._key,be.exists(!0))),this}delete(t){this._verifyNotCommitted();t=Sr(t,this._firestore);return this._mutations=this._mutations.concat(new Ae(t._key,be.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new U(S,"A write batch can no longer be used after commit() has been called.")}}function Sr(t,e){if((t=getModularInstance(t)).firestore!==e)throw new U(A,"Provided document reference is from a different Firestore instance.");return t}function Fr(t){const e=en(t=ot(t,rn));return new $r(t,t=>Je(e,t))}class xr{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(t){if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new U(A,"Firestore transactions require all reads to be executed before all writes.");const e=await Xe(this.datastore,t);return e.forEach(t=>this.recordVersion(t)),e}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())}delete(t){this.write(new Ae(t,this.precondition(t))),this.writtenDocs.add(t.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,e)=>{e=et.fromPath(e);this.mutations.push(new Re(e,this.precondition(e)))}),await Je(this.datastore,this.mutations),this.committed=!0}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw g();e=vt.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new U(F,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?be.updateTime(e):be.none()}preconditionForUpdate(t){const e=this.readVersions.get(t.toString());if(this.writtenDocs.has(t.toString())||!e)return be.exists(!0);if(e.isEqual(vt.min()))throw new U(A,"Can't update a document that doesn't exist.");return be.updateTime(e)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}}class qr{constructor(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.Tt=5,this.It=new He(this.asyncQueue,"transaction_retry")}run(){--this.Tt,this.At()}At(){this.It.W(async()=>{const e=new xr(this.datastore),t=this.Rt(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(t=>{this.Pt(t)}))}).catch(t=>{this.Pt(t)})})}Rt(t){try{var e=this.updateFunction(t);return!ct(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Pt(t){0<this.Tt&&this.Vt(t)?(--this.Tt,this.asyncQueue.enqueueAndForget(()=>(this.At(),Promise.resolve()))):this.deferred.reject(t)}Vt(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!function(){switch(e){default:return g();case T:case I:case R:case $:case O:case C:case N:return;case A:case P:case V:case D:case S:case F:case x:case q:case L:return 1}}()}}function Or(){return"undefined"!=typeof document?document:null}class Cr{constructor(t,e,n,r,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new k,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(t=>{})}static createAndSchedule(t,e,n,r,s){const i=Date.now()+n,a=new Cr(t,e,i,r,s);return a.start(n),a}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new U(T,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}class Lr{constructor(){this.Dt=Promise.resolve(),this.Nt=[],this.$t=!1,this.St=[],this.Ft=null,this.xt=!1,this.qt=!1,this.Ot=[],this.It=new He(this,"async_queue_retry"),this.Ct=()=>{var t=Or();t&&m("AsyncQueue","Visibility state changed to "+t.visibilityState),this.It.H()};const t=Or();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Ct)}get isShuttingDown(){return this.$t}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Lt(),this.Ut(t)}enterRestrictedMode(t){if(!this.$t){this.$t=!0,this.qt=t||!1;const e=Or();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Ct)}}enqueue(t){if(this.Lt(),this.$t)return new Promise(()=>{});const e=new k;return this.Ut(()=>this.$t&&this.qt?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Nt.push(t),this.kt()))}async kt(){if(0!==this.Nt.length){try{await this.Nt[0](),this.Nt.shift(),this.It.reset()}catch(t){if("IndexedDbTransactionError"!==t.name)throw t;m("AsyncQueue","Operation failed with retryable error: "+t)}0<this.Nt.length&&this.It.W(()=>this.kt())}}Ut(t){var e=this.Dt.then(()=>(this.xt=!0,t().catch(t=>{throw this.Ft=t,this.xt=!1,p("INTERNAL UNHANDLED ERROR: ",function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(t=>(this.xt=!1,t))));return this.Dt=e}enqueueAfterDelay(t,e,n){this.Lt(),-1<this.Ot.indexOf(t)&&(e=0);n=Cr.createAndSchedule(this,t,e,n,t=>this.jt(t));return this.St.push(n),n}Lt(){this.Ft&&g()}verifyOperationInProgress(){}async Mt(){for(var t;await(t=this.Dt),t!==this.Dt;);}Bt(t){for(const e of this.St)if(e.timerId===t)return!0;return!1}zt(e){return this.Mt().then(()=>{this.St.sort((t,e)=>t.targetTimeMs-e.targetTimeMs);for(const t of this.St)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Mt()})}Gt(t){this.Ot.push(t)}jt(t){t=this.St.indexOf(t);this.St.splice(t,1)}}class Ur{constructor(t,e){this._firestore=t,this._transaction=e,this._dataReader=Vn(t)}get(t){const n=Sr(t,this._firestore),r=new gr(this._firestore);return this._transaction.lookup([n._key]).then(t=>{if(!t||1!==t.length)return g();const e=t[0];if(e.isFoundDocument())return new Yn(this._firestore,r,e.key,e,n.converter);if(e.isNoDocument())return new Yn(this._firestore,r,n._key,null,n.converter);throw g()})}set(t,e,n){t=Sr(t,this._firestore),e=_r(t.converter,e,n),n=Dn(this._dataReader,"Transaction.set",t._key,e,null!==t.converter,n);return this._transaction.set(t._key,n),this}update(t,e,n,...r){t=Sr(t,this._firestore),e="string"==typeof(e=getModularInstance(e))||e instanceof yn?Cn(this._dataReader,"Transaction.update",t._key,e,n,r):On(this._dataReader,"Transaction.update",t._key,e);return this._transaction.update(t._key,e),this}delete(t){t=Sr(t,this._firestore);return this._transaction.delete(t._key),this}}function kr(e,n){var t=en(e=ot(e,rn)),r=new k;return new qr(new Lr,t,t=>n(new Ur(e,t)),r).run(),r.promise}!function(t){f=t}(`${SDK_VERSION}_lite`),_registerComponent(new Component("firestore/lite",(t,{options:e})=>{const n=t.getProvider("app").getImmediate(),r=new rn(n,new z(t.getProvider("auth-internal")),new Y(t.getProvider("app-check-internal")));return e&&r._setSettings(e),r},"PUBLIC")),registerVersion("firestore-lite","3.4.5",""),registerVersion("firestore-lite","3.4.5","esm2017");export{gn as Bytes,ln as CollectionReference,an as DocumentReference,Yn as DocumentSnapshot,yn as FieldPath,vn as FieldValue,rn as Firestore,U as FirestoreError,bn as GeoPoint,hn as Query,Zn as QueryConstraint,Hn as QueryDocumentSnapshot,Kn as QuerySnapshot,gt as Timestamp,Ur as Transaction,$r as WriteBatch,Ar as addDoc,Dr as arrayRemove,Vr as arrayUnion,fn as collection,dn as collectionGroup,un as connectFirestoreEmulator,Ir as deleteDoc,Rr as deleteField,wn as doc,_n as documentId,dr as endAt,fr as endBefore,vr as getDoc,br as getDocs,on as getFirestore,Nr as increment,sn as initializeFirestore,or as limit,ur as limitToLast,sr as orderBy,tr as query,pn as queryEqual,mn as refEqual,kr as runTransaction,Pr as serverTimestamp,Er as setDoc,w as setLogLevel,Jn as snapshotEqual,hr as startAfter,ar as startAt,cn as terminate,Tr as updateDoc,nr as where,Fr as writeBatch};