import{_getProvider,getApp,_registerComponent,registerVersion}from"https://www.gstatic.com/firebasejs/9.6.7/firebase-app.js";const stringToByteArray$1=function(r){const o=[];let n=0;for(let t=0;t<r.length;t++){let e=r.charCodeAt(t);e<128?o[n++]=e:(e<2048?o[n++]=e>>6|192:(55296==(64512&e)&&t+1<r.length&&56320==(64512&r.charCodeAt(t+1))?(e=65536+((1023&e)<<10)+(1023&r.charCodeAt(++t)),o[n++]=e>>18|240,o[n++]=e>>12&63|128):o[n++]=e>>12|224,o[n++]=e>>6&63|128),o[n++]=63&e|128)}return o},byteArrayToString=function(e){const t=[];let r=0,o=0;for(;r<e.length;){var n,a,i=e[r++];i<128?t[o++]=String.fromCharCode(i):191<i&&i<224?(n=e[r++],t[o++]=String.fromCharCode((31&i)<<6|63&n)):239<i&&i<365?(a=((7&i)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536,t[o++]=String.fromCharCode(55296+(a>>10)),t[o++]=String.fromCharCode(56320+(1023&a))):(n=e[r++],a=e[r++],t[o++]=String.fromCharCode((15&i)<<12|(63&n)<<6|63&a))}return t.join("")},base64={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(o,e){if(!Array.isArray(o))throw Error("encodeByteArray takes an array as a parameter");this.init_();var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_;const a=[];for(let r=0;r<o.length;r+=3){var i=o[r],s=r+1<o.length,c=s?o[r+1]:0,l=r+2<o.length,h=l?o[r+2]:0;let e=(15&c)<<2|h>>6,t=63&h;l||(t=64,s||(e=64)),a.push(n[i>>2],n[(3&i)<<4|c>>4],n[e],n[t])}return a.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(stringToByteArray$1(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):byteArrayToString(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(t,e){this.init_();var r=e?this.charToByteMapWebSafe_:this.charToByteMap_;const o=[];for(let e=0;e<t.length;){var n=r[t.charAt(e++)],a=e<t.length?r[t.charAt(e)]:0;++e;var i=e<t.length?r[t.charAt(e)]:64;++e;var s=e<t.length?r[t.charAt(e)]:64;if(++e,null==n||null==a||null==i||null==s)throw Error();o.push(n<<2|a>>4),64!==i&&(o.push(a<<4&240|i>>2),64!==s&&o.push(i<<6&192|s))}return o},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},base64Decode=function(e){try{return base64.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};class Deferred{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(r){return(e,t)=>{e?this.reject(e):this.resolve(t),"function"==typeof r&&(this.promise.catch(()=>{}),1===r.length?r(e):r(e,t))}}}function isIndexedDBAvailable(){return"object"==typeof indexedDB}function getGlobal(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}const ERROR_NAME="FirebaseError";class FirebaseError extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=ERROR_NAME,Object.setPrototypeOf(this,FirebaseError.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ErrorFactory.prototype.create)}}class ErrorFactory{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){var r=t[0]||{},t=`${this.service}/${e}`,e=this.errors[e],e=e?replaceTemplate(e,r):"Error",e=`${this.serviceName}: ${e} (${t}).`;return new FirebaseError(t,e,r)}}function replaceTemplate(e,o){return e.replace(PATTERN,(e,t)=>{var r=o[t];return null!=r?String(r):`<${t}?>`})}const PATTERN=/\{\$([^}]+)}/g;function jsonEval(e){return JSON.parse(e)}const decode=function(e){let t={},r={},o={},n="";try{var a=e.split(".");t=jsonEval(base64Decode(a[0])||""),r=jsonEval(base64Decode(a[1])||""),n=a[2],o=r.d||{},delete r.d}catch(e){}return{header:t,claims:r,data:o,signature:n}},issuedAtTime=function(e){const t=decode(e).claims;return"object"==typeof t&&t.hasOwnProperty("iat")?t.iat:null},DEFAULT_INTERVAL_MILLIS=1e3,DEFAULT_BACKOFF_FACTOR=2,MAX_VALUE_MILLIS=144e5,RANDOM_FACTOR=.5;function calculateBackoffMillis(e,t=DEFAULT_INTERVAL_MILLIS,r=DEFAULT_BACKOFF_FACTOR){r=t*Math.pow(r,e),e=Math.round(RANDOM_FACTOR*r*(Math.random()-.5)*2);return Math.min(MAX_VALUE_MILLIS,r+e)}function getModularInstance(e){return e&&e._delegate?e._delegate:e}class Component{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}var LogLevel;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(LogLevel=LogLevel||{});const levelStringToEnum={debug:LogLevel.DEBUG,verbose:LogLevel.VERBOSE,info:LogLevel.INFO,warn:LogLevel.WARN,error:LogLevel.ERROR,silent:LogLevel.SILENT},defaultLogLevel=LogLevel.INFO,ConsoleMethod={[LogLevel.DEBUG]:"log",[LogLevel.VERBOSE]:"log",[LogLevel.INFO]:"info",[LogLevel.WARN]:"warn",[LogLevel.ERROR]:"error"},defaultLogHandler=(e,t,...r)=>{if(!(t<e.logLevel)){var o=(new Date).toISOString(),n=ConsoleMethod[t];if(!n)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[n](`[${o}]  ${e.name}:`,...r)}};class Logger{constructor(e){this.name=e,this._logLevel=defaultLogLevel,this._logHandler=defaultLogHandler,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in LogLevel))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?levelStringToEnum[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,LogLevel.DEBUG,...e),this._logHandler(this,LogLevel.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,LogLevel.VERBOSE,...e),this._logHandler(this,LogLevel.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,LogLevel.INFO,...e),this._logHandler(this,LogLevel.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,LogLevel.WARN,...e),this._logHandler(this,LogLevel.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,LogLevel.ERROR,...e),this._logHandler(this,LogLevel.ERROR,...e)}}const APP_CHECK_STATES=new Map,DEFAULT_STATE={activated:!1,tokenObservers:[]},DEBUG_STATE={initialized:!1,enabled:!1};function getState(e){return APP_CHECK_STATES.get(e)||DEFAULT_STATE}function setState(e,t){APP_CHECK_STATES.set(e,t)}function getDebugState(){return DEBUG_STATE}const BASE_ENDPOINT="https://content-firebaseappcheck.googleapis.com/v1beta",EXCHANGE_RECAPTCHA_TOKEN_METHOD="exchangeRecaptchaToken",EXCHANGE_RECAPTCHA_ENTERPRISE_TOKEN_METHOD="exchangeRecaptchaEnterpriseToken",EXCHANGE_DEBUG_TOKEN_METHOD="exchangeDebugToken",TOKEN_REFRESH_TIME={OFFSET_DURATION:3e5,RETRIAL_MIN_WAIT:3e4,RETRIAL_MAX_WAIT:96e4},ONE_DAY=864e5;class Refresher{constructor(e,t,r,o,n){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=o,this.upperBound=n,this.pending=null,n<(this.nextErrorWaitInterval=o))throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(e){this.stop();try{this.pending=new Deferred,await sleep(this.getNextRun(e)),this.pending.resolve(),await this.pending.promise,this.pending=new Deferred,await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch(()=>{})}catch(e){this.retryPolicy(e)?this.process(!1).catch(()=>{}):this.stop()}}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();e=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),e}}function sleep(t){return new Promise(e=>{setTimeout(e,t)})}const ERRORS={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},ERROR_FACTORY=new ErrorFactory("appCheck","AppCheck",ERRORS);function getRecaptcha(e=!1){return e?null===(e=self.grecaptcha)||void 0===e?void 0:e.enterprise:self.grecaptcha}function ensureActivated(e){if(!getState(e).activated)throw ERROR_FACTORY.create("use-before-activation",{appName:e.name})}function uuidv4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0,r="x"===e?t:3&t|8;return r.toString(16)})}function getDurationString(e){var t=Math.round(e/1e3),r=Math.floor(t/86400),o=Math.floor((t-3600*r*24)/3600),e=Math.floor((t-3600*r*24-3600*o)/60),t=t-3600*r*24-3600*o-60*e;let n="";return r&&(n+=pad(r)+"d:"),o&&(n+=pad(o)+"h:"),n+=pad(e)+"m:"+pad(t)+"s",n}function pad(e){return 0===e?"00":10<=e?e.toString():"0"+e}async function exchangeToken({url:e,body:t},r){const o={"Content-Type":"application/json"},n=r.getImmediate({optional:!0});n&&(o["X-Firebase-Client"]=n.getPlatformInfoString());t={method:"POST",body:JSON.stringify(t),headers:o};let a;try{a=await fetch(e,t)}catch(e){throw ERROR_FACTORY.create("fetch-network-error",{originalErrorMessage:e.message})}if(200!==a.status)throw ERROR_FACTORY.create("fetch-status-error",{httpStatus:a.status});let i;try{i=await a.json()}catch(e){throw ERROR_FACTORY.create("fetch-parse-error",{originalErrorMessage:e.message})}e=i.ttl.match(/^([\d.]+)(s)$/);if(!e||!e[2]||isNaN(Number(e[1])))throw ERROR_FACTORY.create("fetch-parse-error",{originalErrorMessage:"ttl field (timeToLive) is not in standard Protobuf Duration "+`format: ${i.ttl}`});t=1e3*Number(e[1]),e=Date.now();return{token:i.attestationToken,expireTimeMillis:e+t,issuedAtTimeMillis:e}}function getExchangeRecaptchaV3TokenRequest(e,t){var{projectId:r,appId:o,apiKey:e}=e.options;return{url:`${BASE_ENDPOINT}/projects/${r}/apps/${o}:${EXCHANGE_RECAPTCHA_TOKEN_METHOD}?key=${e}`,body:{recaptcha_token:t}}}function getExchangeRecaptchaEnterpriseTokenRequest(e,t){var{projectId:r,appId:o,apiKey:e}=e.options;return{url:`${BASE_ENDPOINT}/projects/${r}/apps/${o}:${EXCHANGE_RECAPTCHA_ENTERPRISE_TOKEN_METHOD}?key=${e}`,body:{recaptcha_enterprise_token:t}}}function getExchangeDebugTokenRequest(e,t){var{projectId:r,appId:o,apiKey:e}=e.options;return{url:`${BASE_ENDPOINT}/projects/${r}/apps/${o}:${EXCHANGE_DEBUG_TOKEN_METHOD}?key=${e}`,body:{debug_token:t}}}const DB_NAME="firebase-app-check-database",DB_VERSION=1,STORE_NAME="firebase-app-check-store",DEBUG_TOKEN_KEY="debug-token";let dbPromise=null;function getDBPromise(){return dbPromise||(dbPromise=new Promise((t,r)=>{try{const e=indexedDB.open(DB_NAME,DB_VERSION);e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{r(ERROR_FACTORY.create("storage-open",{originalErrorMessage:null===(e=e.target.error)||void 0===e?void 0:e.message}))},e.onupgradeneeded=e=>{const t=e.target.result;0===e.oldVersion&&t.createObjectStore(STORE_NAME,{keyPath:"compositeKey"})}}catch(e){r(ERROR_FACTORY.create("storage-open",{originalErrorMessage:e.message}))}}),dbPromise)}function readTokenFromIndexedDB(e){return read(computeKey(e))}function writeTokenToIndexedDB(e,t){return write(computeKey(e),t)}function writeDebugTokenToIndexedDB(e){return write(DEBUG_TOKEN_KEY,e)}function readDebugTokenFromIndexedDB(){return read(DEBUG_TOKEN_KEY)}async function write(e,t){const r=await getDBPromise(),o=r.transaction(STORE_NAME,"readwrite"),n=o.objectStore(STORE_NAME),a=n.put({compositeKey:e,value:t});return new Promise((t,r)=>{a.onsuccess=e=>{t()},o.onerror=e=>{r(ERROR_FACTORY.create("storage-set",{originalErrorMessage:null===(e=e.target.error)||void 0===e?void 0:e.message}))}})}async function read(e){const t=await getDBPromise(),o=t.transaction(STORE_NAME,"readonly"),r=o.objectStore(STORE_NAME),n=r.get(e);return new Promise((t,r)=>{n.onsuccess=e=>{e=e.target.result;t(e?e.value:void 0)},o.onerror=e=>{r(ERROR_FACTORY.create("storage-get",{originalErrorMessage:null===(e=e.target.error)||void 0===e?void 0:e.message}))}})}function computeKey(e){return`${e.options.appId}-${e.name}`}const logger=new Logger("https://www.gstatic.com/firebasejs/9.6.7/firebase-app.js-check");async function readTokenFromStorage(t){if(isIndexedDBAvailable()){let e=void 0;try{e=await readTokenFromIndexedDB(t)}catch(e){logger.warn(`Failed to read token from IndexedDB. Error: ${e}`)}return e}}function writeTokenToStorage(e,t){return isIndexedDBAvailable()?writeTokenToIndexedDB(e,t).catch(e=>{logger.warn(`Failed to write token to IndexedDB. Error: ${e}`)}):Promise.resolve()}async function readOrCreateDebugTokenFromStorage(){let e=void 0;try{e=await readDebugTokenFromIndexedDB()}catch(e){}if(e)return e;var t=uuidv4();return writeDebugTokenToIndexedDB(t).catch(e=>logger.warn(`Failed to persist debug token to IndexedDB. Error: ${e}`)),t}function isDebugMode(){return getDebugState().enabled}async function getDebugToken(){var e=getDebugState();if(e.enabled&&e.token)return e.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)}function initializeDebugMode(){var e=getGlobal();const t=getDebugState();if(t.initialized=!0,"string"==typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN||!0===e.FIREBASE_APPCHECK_DEBUG_TOKEN){t.enabled=!0;const r=new Deferred;t.token=r,"string"==typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN?r.resolve(e.FIREBASE_APPCHECK_DEBUG_TOKEN):r.resolve(readOrCreateDebugTokenFromStorage())}}const defaultTokenErrorData={error:"UNKNOWN_ERROR"};function formatDummyToken(e){return base64.encodeString(JSON.stringify(e),!1)}async function getToken$2(e,t=!1){var r,o=e.app;ensureActivated(o);const n=getState(o);let a=n.token,i=void 0;if(a||(r=await n.cachedTokenPromise)&&isValid(r)&&(a=r),!t&&a&&isValid(a))return{token:a.token};let s=!1;if(isDebugMode()){n.exchangeTokenPromise||(n.exchangeTokenPromise=exchangeToken(getExchangeDebugTokenRequest(o,await getDebugToken()),e.platformLoggerProvider).then(e=>(n.exchangeTokenPromise=void 0,e)),s=!0);e=await n.exchangeTokenPromise;return await writeTokenToStorage(o,e),setState(o,Object.assign(Object.assign({},n),{token:e})),{token:e.token}}try{n.exchangeTokenPromise||(n.exchangeTokenPromise=n.provider.getToken().then(e=>(n.exchangeTokenPromise=void 0,e)),s=!0),a=await n.exchangeTokenPromise}catch(e){"appCheck/throttled"===e.code?logger.warn(e.message):logger.error(e),i=e}let c;return a?(c={token:a.token},setState(o,Object.assign(Object.assign({},n),{token:a})),await writeTokenToStorage(o,a)):c=makeDummyTokenResult(i),s&&notifyTokenListeners(o,c),c}function addTokenListener(e,t,r,o){var n=e["app"];const a=getState(n);t={next:r,error:o,type:t};if(setState(n,Object.assign(Object.assign({},a),{tokenObservers:[...a.tokenObservers,t]})),a.token&&isValid(a.token)){const i=a.token;Promise.resolve().then(()=>{r({token:i.token}),initTokenRefresher(e)}).catch(()=>{})}a.cachedTokenPromise.then(()=>initTokenRefresher(e))}function removeTokenListener(e,t){const r=getState(e);var o=r.tokenObservers.filter(e=>e.next!==t);0===o.length&&r.tokenRefresher&&r.tokenRefresher.isRunning()&&r.tokenRefresher.stop(),setState(e,Object.assign(Object.assign({},r),{tokenObservers:o}))}function initTokenRefresher(e){var t=e["app"],r=getState(t);let o=r.tokenRefresher;o||(o=createTokenRefresher(e),setState(t,Object.assign(Object.assign({},r),{tokenRefresher:o}))),!o.isRunning()&&r.isTokenAutoRefreshEnabled&&o.start()}function createTokenRefresher(r){const o=r["app"];return new Refresher(async()=>{var e=getState(o);let t;if(t=e.token?await getToken$2(r,!0):await getToken$2(r),t.error)throw t.error},()=>!0,()=>{var e=getState(o);if(e.token){var t=e.token.issuedAtTimeMillis+.5*(e.token.expireTimeMillis-e.token.issuedAtTimeMillis)+3e5,e=e.token.expireTimeMillis-3e5,t=Math.min(t,e);return Math.max(0,t-Date.now())}return 0},TOKEN_REFRESH_TIME.RETRIAL_MIN_WAIT,TOKEN_REFRESH_TIME.RETRIAL_MAX_WAIT)}function notifyTokenListeners(e,t){for(const r of getState(e).tokenObservers)try{"EXTERNAL"===r.type&&null!=t.error?r.error(t.error):r.next(t)}catch(e){}}function isValid(e){return 0<e.expireTimeMillis-Date.now()}function makeDummyTokenResult(e){return{token:formatDummyToken(defaultTokenErrorData),error:e}}class AppCheckService{constructor(e,t){this.app=e,this.platformLoggerProvider=t}_delete(){var e=getState(this.app)["tokenObservers"];for(const t of e)removeTokenListener(this.app,t.next);return Promise.resolve()}}function factory(e,t){return new AppCheckService(e,t)}function internalFactory(t){return{getToken:e=>getToken$2(t,e),addTokenListener:e=>addTokenListener(t,"INTERNAL",e),removeTokenListener:e=>removeTokenListener(t.app,e)}}const name="https://www.gstatic.com/firebasejs/9.6.7/firebase-app.js-check",version="0.5.3",RECAPTCHA_URL="https://www.google.com/recaptcha/api.js",RECAPTCHA_ENTERPRISE_URL="https://www.google.com/recaptcha/enterprise.js";function initializeV3(t,r){var e=getState(t);const o=new Deferred;setState(t,Object.assign(Object.assign({},e),{reCAPTCHAState:{initialized:o}}));const n=makeDiv(t);e=getRecaptcha(!1);return e?queueWidgetRender(t,r,e,n,o):loadReCAPTCHAV3Script(()=>{var e=getRecaptcha(!1);if(!e)throw new Error("no recaptcha");queueWidgetRender(t,r,e,n,o)}),o.promise}function initializeEnterprise(t,r){var e=getState(t);const o=new Deferred;setState(t,Object.assign(Object.assign({},e),{reCAPTCHAState:{initialized:o}}));const n=makeDiv(t);e=getRecaptcha(!0);return e?queueWidgetRender(t,r,e,n,o):loadReCAPTCHAEnterpriseScript(()=>{var e=getRecaptcha(!0);if(!e)throw new Error("no recaptcha");queueWidgetRender(t,r,e,n,o)}),o.promise}function queueWidgetRender(e,t,r,o,n){r.ready(()=>{renderInvisibleWidget(e,t,r,o),n.resolve(r)})}function makeDiv(e){e=`fire_app_check_${e.name}`;const t=document.createElement("div");return t.id=e,t.style.display="none",document.body.appendChild(t),e}async function getToken$1(o){ensureActivated(o);const n=await getState(o).reCAPTCHAState.initialized.promise;return new Promise((e,t)=>{const r=getState(o).reCAPTCHAState;n.ready(()=>{e(n.execute(r.widgetId,{action:"fire_app_check"}))})})}function renderInvisibleWidget(e,t,r,o){o=r.render(o,{sitekey:t,size:"invisible"}),t=getState(e);setState(e,Object.assign(Object.assign({},t),{reCAPTCHAState:Object.assign(Object.assign({},t.reCAPTCHAState),{widgetId:o})}))}function loadReCAPTCHAV3Script(e){const t=document.createElement("script");t.src=RECAPTCHA_URL,t.onload=e,document.head.appendChild(t)}function loadReCAPTCHAEnterpriseScript(e){const t=document.createElement("script");t.src=RECAPTCHA_ENTERPRISE_URL,t.onload=e,document.head.appendChild(t)}class ReCaptchaV3Provider{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){throwIfThrottled(this._throttleData);var t=await getToken$1(this._app).catch(e=>{throw ERROR_FACTORY.create("recaptcha-error")});let e;try{e=await exchangeToken(getExchangeRecaptchaV3TokenRequest(this._app,t),this._platformLoggerProvider)}catch(e){throw"fetch-status-error"===e.code?(this._throttleData=setBackoff(Number(null===(t=e.customData)||void 0===t?void 0:t.httpStatus),this._throttleData),ERROR_FACTORY.create("throttled",{time:getDurationString(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):e}return this._throttleData=null,e}initialize(e){this._app=e,this._platformLoggerProvider=_getProvider(e,"platform-logger"),initializeV3(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof ReCaptchaV3Provider&&this._siteKey===e._siteKey}}class ReCaptchaEnterpriseProvider{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){throwIfThrottled(this._throttleData);var t=await getToken$1(this._app).catch(e=>{throw ERROR_FACTORY.create("recaptcha-error")});let e;try{e=await exchangeToken(getExchangeRecaptchaEnterpriseTokenRequest(this._app,t),this._platformLoggerProvider)}catch(e){throw"fetch-status-error"===e.code?(this._throttleData=setBackoff(Number(null===(t=e.customData)||void 0===t?void 0:t.httpStatus),this._throttleData),ERROR_FACTORY.create("throttled",{time:getDurationString(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):e}return this._throttleData=null,e}initialize(e){this._app=e,this._platformLoggerProvider=_getProvider(e,"platform-logger"),initializeEnterprise(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof ReCaptchaEnterpriseProvider&&this._siteKey===e._siteKey}}class CustomProvider{constructor(e){this._customProviderOptions=e}async getToken(){var e=await this._customProviderOptions.getToken(),t=issuedAtTime(e.token),t=null!==t&&t<Date.now()&&0<t?1e3*t:Date.now();return Object.assign(Object.assign({},e),{issuedAtTimeMillis:t})}initialize(e){this._app=e}isEqual(e){return e instanceof CustomProvider&&this._customProviderOptions.getToken.toString()===e._customProviderOptions.getToken.toString()}}function setBackoff(e,t){if(404===e||403===e)return{backoffCount:1,allowRequestsAfter:Date.now()+ONE_DAY,httpStatus:e};var r=t?t.backoffCount:0,t=calculateBackoffMillis(r,1e3,2);return{backoffCount:r+1,allowRequestsAfter:Date.now()+t,httpStatus:e}}function throwIfThrottled(e){if(e&&Date.now()-e.allowRequestsAfter<=0)throw ERROR_FACTORY.create("throttled",{time:getDurationString(e.allowRequestsAfter-Date.now()),httpStatus:e.httpStatus})}function initializeAppCheck(e=getApp(),t){e=getModularInstance(e);const r=_getProvider(e,"app-check");if(getDebugState().initialized||initializeDebugMode(),isDebugMode()&&getDebugToken().then(e=>console.log(`App Check debug token: ${e}. You will need to add it to your app's App Check settings in the Firebase console for it to work.`)),r.isInitialized()){var o=r.getImmediate();const n=r.getOptions();if(n.isTokenAutoRefreshEnabled===t.isTokenAutoRefreshEnabled&&n.provider.isEqual(t.provider))return o;throw ERROR_FACTORY.create("already-initialized",{appName:e.name})}o=r.initialize({options:t});return _activate(e,t.provider,t.isTokenAutoRefreshEnabled),getState(e).isTokenAutoRefreshEnabled&&addTokenListener(o,"INTERNAL",()=>{}),o}function _activate(t,e,r){var o=getState(t);const n=Object.assign(Object.assign({},o),{activated:!0});n.provider=e,n.cachedTokenPromise=readTokenFromStorage(t).then(e=>(e&&isValid(e)&&(setState(t,Object.assign(Object.assign({},getState(t)),{token:e})),notifyTokenListeners(t,{token:e.token})),e)),n.isTokenAutoRefreshEnabled=void 0===r?t.automaticDataCollectionEnabled:r,setState(t,n),n.provider.initialize(t)}function setTokenAutoRefreshEnabled(e,t){e=e.app;const r=getState(e);r.tokenRefresher&&(!0===t?r.tokenRefresher.start():r.tokenRefresher.stop()),setState(e,Object.assign(Object.assign({},r),{isTokenAutoRefreshEnabled:t}))}async function getToken(e,t){t=await getToken$2(e,t);if(t.error)throw t.error;return{token:t.token}}function onTokenChanged(e,t,r,o){let n=()=>{},a=()=>{};return n=null!=t.next?t.next.bind(t):t,null!=t.error?a=t.error.bind(t):r&&(a=r),addTokenListener(e,"EXTERNAL",n,a),()=>removeTokenListener(e.app,n)}const APP_CHECK_NAME="app-check",APP_CHECK_NAME_INTERNAL="app-check-internal";function registerAppCheck(){_registerComponent(new Component(APP_CHECK_NAME,e=>{return factory(e.getProvider("app").getImmediate(),e.getProvider("platform-logger"))},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider(APP_CHECK_NAME_INTERNAL).initialize()})),_registerComponent(new Component(APP_CHECK_NAME_INTERNAL,e=>{return internalFactory(e.getProvider("app-check").getImmediate())},"PUBLIC").setInstantiationMode("EXPLICIT")),registerVersion(name,version)}registerAppCheck();export{CustomProvider,ReCaptchaEnterpriseProvider,ReCaptchaV3Provider,getToken,initializeAppCheck,onTokenChanged,setTokenAutoRefreshEnabled};