!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("@firebase/app-compat"),require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app-compat","@firebase/app"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).firebase,e.firebase.INTERNAL.modularAPIs)}(this,function(tf,nf){"use strict";try{!function(){var l,e,t=(e=tf)&&"object"==typeof e&&"default"in e?e:{default:e};function n(n){const r=[];let s=0;for(let t=0;t<n.length;t++){let e=n.charCodeAt(t);e<128?r[s++]=e:(e<2048?r[s++]=e>>6|192:(55296==(64512&e)&&t+1<n.length&&56320==(64512&n.charCodeAt(t+1))?(e=65536+((1023&e)<<10)+(1023&n.charCodeAt(++t)),r[s++]=e>>18|240,r[s++]=e>>12&63|128):r[s++]=e>>12|224,r[s++]=e>>6&63|128),r[s++]=63&e|128)}return r}function o(e){return e=n(e),r.encodeByteArray(e,!0).replace(/\./g,"")}const r={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(r,e){if(!Array.isArray(r))throw Error("encodeByteArray takes an array as a parameter");this.init_();var s=e?this.byteToCharMapWebSafe_:this.byteToCharMap_;const i=[];for(let n=0;n<r.length;n+=3){var o=r[n],a=n+1<r.length,h=a?r[n+1]:0,u=n+2<r.length,c=u?r[n+2]:0;let e=(15&h)<<2|c>>6,t=63&c;u||(t=64,a||(e=64)),i.push(s[o>>2],s[(3&o)<<4|h>>4],s[e],s[t])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(n(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){var s,i,o=e[n++];o<128?t[r++]=String.fromCharCode(o):191<o&&o<224?(s=e[n++],t[r++]=String.fromCharCode((31&o)<<6|63&s)):239<o&&o<365?(i=((7&o)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536,t[r++]=String.fromCharCode(55296+(i>>10)),t[r++]=String.fromCharCode(56320+(1023&i))):(s=e[n++],i=e[n++],t[r++]=String.fromCharCode((15&o)<<12|(63&s)<<6|63&i))}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(t,e){this.init_();var n=e?this.charToByteMapWebSafe_:this.charToByteMap_;const r=[];for(let e=0;e<t.length;){var s=n[t.charAt(e++)],i=e<t.length?n[t.charAt(e)]:0;++e;var o=e<t.length?n[t.charAt(e)]:64;++e;var a=e<t.length?n[t.charAt(e)]:64;if(++e,null==s||null==i||null==o||null==a)throw Error();r.push(s<<2|i>>4),64!==o&&(r.push(i<<4&240|o>>2),64!==a&&r.push(o<<6&192|a))}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};function f(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}class s extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,s.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,i.prototype.create)}}class i{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var r,n=t[0]||{},t=`${this.service}/${e}`,e=(e=this.errors[e])?(r=n,e.replace(a,(e,t)=>{var n=r[t];return null!=n?String(n):`<${t}?>`})):"Error",e=`${this.serviceName}: ${e} (${t}).`;return new s(t,e,n)}}const a=/\{\$([^}]+)}/g;function d(e){return e&&e._delegate?e._delegate:e}class h{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}(Zn=l=l||{})[Zn.DEBUG=0]="DEBUG",Zn[Zn.VERBOSE=1]="VERBOSE",Zn[Zn.INFO=2]="INFO",Zn[Zn.WARN=3]="WARN",Zn[Zn.ERROR=4]="ERROR",Zn[Zn.SILENT=5]="SILENT";const u={debug:l.DEBUG,verbose:l.VERBOSE,info:l.INFO,warn:l.WARN,error:l.ERROR,silent:l.SILENT},c=l.INFO,g={[l.DEBUG]:"log",[l.VERBOSE]:"log",[l.INFO]:"info",[l.WARN]:"warn",[l.ERROR]:"error"},m=(e,t,...n)=>{if(!(t<e.logLevel)){var r=(new Date).toISOString(),s=g[t];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[s](`[${r}]  ${e.name}:`,...n)}};var p="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},w=p||self;function y(){}function v(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function I(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var b="closure_uid_"+(1e9*Math.random()>>>0),T=0;function E(e,t,n){return e.call.apply(e.bind,arguments)}function S(t,n,e){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,r),t.apply(n,e)}}return function(){return t.apply(n,arguments)}}function _(e,t,n){return(_=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?E:S).apply(null,arguments)}function A(t){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function x(e,i){function t(){}t.prototype=i.prototype,e.Z=i.prototype,e.prototype=new t,(e.prototype.constructor=e).Vb=function(e,t,n){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return i.prototype[t].apply(e,r)}}function N(){this.s=this.s,this.o=this.o}var C={};N.prototype.s=!1,N.prototype.na=function(){var e;!this.s&&(this.s=!0,this.M(),0)&&(e=Object.prototype.hasOwnProperty.call(this,b)&&this[b]||(this[b]=++T),delete C[e])},N.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const D=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(t,n){if("string"==typeof t)return"string"!=typeof n||1!=n.length?-1:t.indexOf(n,0);for(let e=0;e<t.length;e++)if(e in t&&t[e]===n)return e;return-1},k=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(t,n,r){var s=t.length,i="string"==typeof t?t.split(""):t;for(let e=0;e<s;e++)e in i&&n.call(r,i[e],e,t)};function O(){return Array.prototype.concat.apply([],arguments)}function R(t){var n=t.length;if(0<n){const r=Array(n);for(let e=0;e<n;e++)r[e]=t[e];return r}return[]}function L(e){return/^[\s\xa0]*$/.test(e)}var M=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function P(e,t){return-1!=e.indexOf(t)}function F(e,t){return e<t?-1:t<e?1:0}var V=w.navigator;function U(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function q(e){const t={};for(const n in e)t[n]=e[n];return t}J=(V=V&&V.userAgent)?V:"";var B="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function j(t){let n,r;for(let e=1;e<arguments.length;e++){for(n in r=arguments[e])t[n]=r[n];for(let e=0;e<B.length;e++)n=B[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function K(e){return K[" "](e),e}K[" "]=y;var G,$=P(J,"Opera"),Q=P(J,"Trident")||P(J,"MSIE"),z=P(J,"Edge"),H=z||Q,W=P(J,"Gecko")&&!(P(J.toLowerCase(),"webkit")&&!P(J,"Edge"))&&!(P(J,"Trident")||P(J,"MSIE"))&&!P(J,"Edge"),Y=P(J.toLowerCase(),"webkit")&&!P(J,"Edge");function X(){var e=w.document;return e?e.documentMode:void 0}var V="",J=(J=J,W?/rv:([^\);]+)(\)|;)/.exec(J):z?/Edge\/([\d\.]+)/.exec(J):Q?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(J):Y?/WebKit\/(\S+)/.exec(J):$?/(?:Version)[ \/]?(\S+)/.exec(J):void 0);J&&(V=J?J[1]:""),G=Q&&null!=(J=X())&&J>parseFloat(V)?String(J):V;var Z={};var ee=w.document&&Q&&(X()||parseInt(G,10))||void 0,te=function(){if(!w.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{w.addEventListener("test",y,t),w.removeEventListener("test",y,t)}catch(e){}return e}();function ne(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}function re(e,t){if(ne.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(W){e:{try{K(t.nodeName);var s=!0;break e}catch(e){}s=!1}s||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:se[e.pointerType]||"",this.state=e.state,(this.i=e).defaultPrevented&&re.Z.h.call(this)}}ne.prototype.h=function(){this.defaultPrevented=!0},x(re,ne);var se={2:"touch",3:"pen",4:"mouse"};re.prototype.h=function(){re.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var ie="closure_listenable_"+(1e6*Math.random()|0),oe=0;function ae(e,t,n,r,s){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ia=s,this.key=++oe,this.ca=this.fa=!1}function he(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function ue(e){this.src=e,this.g={},this.h=0}function ce(e,t){var n,r,s,i=t.type;i in e.g&&(n=e.g[i],(s=0<=(r=D(n,t)))&&Array.prototype.splice.call(n,r,1),s&&(he(t),0==e.g[i].length&&(delete e.g[i],e.h--)))}function le(e,t,n,r){for(var s=0;s<e.length;++s){var i=e[s];if(!i.ca&&i.listener==t&&i.capture==!!n&&i.ia==r)return s}return-1}ue.prototype.add=function(e,t,n,r,s){var i=e.toString();(e=this.g[i])||(e=this.g[i]=[],this.h++);var o=le(e,t,r,s);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new ae(t,this.src,i,!!r,s)).fa=n,e.push(t)),t};var de="closure_lm_"+(1e6*Math.random()|0),fe={};function ge(e,t,n,r,s,i){if(!t)throw Error("Invalid event type");var o,a=I(s)?!!s.capture:!!s,h=we(e);if(h||(e[de]=h=new ue(e)),(n=h.add(t,n,r,a,i)).proxy)return n;if(o=ye,r=function e(t){return o.call(e.src,e.listener,t)},(n.proxy=r).src=e,r.listener=n,e.addEventListener)void 0===(s=te?s:a)&&(s=!1),e.addEventListener(t.toString(),r,s);else if(e.attachEvent)e.attachEvent(pe(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function me(e){var t,n,r;"number"!=typeof e&&e&&!e.ca&&((t=e.src)&&t[ie]?ce(t.i,e):(n=e.type,r=e.proxy,t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(pe(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=we(t))?(ce(n,e),0==n.h&&(n.src=null,t[de]=null)):he(e)))}function pe(e){return e in fe?fe[e]:fe[e]="on"+e}function ye(e,t){var n,r;return!!e.ca||(t=new re(t,this),n=e.listener,r=e.ia||e.src,e.fa&&me(e),n.call(r,t))}function we(e){return(e=e[de])instanceof ue?e:null}var ve="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ie(t){return"function"==typeof t?t:(t[ve]||(t[ve]=function(e){return t.handleEvent(e)}),t[ve])}function be(){N.call(this),this.i=new ue(this),(this.P=this).I=null}function Te(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t?t=new ne(t,e):t instanceof ne?t.target=t.target||e:(o=t,j(t=new ne(r,e),o)),o=!0,n)for(var s=n.length-1;0<=s;s--)var i=t.g=n[s],o=Ee(i,r,!0,t)&&o;if(o=Ee(i=t.g=e,r,!0,t)&&o,o=Ee(i,r,!1,t)&&o,n)for(s=0;s<n.length;s++)o=Ee(i=t.g=n[s],r,!1,t)&&o}function Ee(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var s=!0,i=0;i<t.length;++i){var o,a,h=t[i];h&&!h.ca&&h.capture==n&&(o=h.listener,a=h.ia||h.src,h.fa&&ce(e.i,h),s=!1!==o.call(a,r)&&s)}return s&&!r.defaultPrevented}x(be,N),be.prototype[ie]=!0,be.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,s,i){if(Array.isArray(n))for(var o=0;o<n.length;o++)e(t,n[o],r,s,i);else s=I(s)?!!s.capture:!!s,r=Ie(r),t&&t[ie]?(t=t.i,(n=String(n).toString())in t.g&&-1<(r=le(o=t.g[n],r,s,i))&&(he(o[r]),Array.prototype.splice.call(o,r,1),0==o.length&&(delete t.g[n],t.h--))):(t=t&&we(t))&&(n=t.g[n.toString()],(r=(t=-1)<(t=n?le(n,r,s,i):t)?n[t]:null)&&me(r))}(this,e,t,n,r)},be.prototype.M=function(){if(be.Z.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)he(n[r]);delete t.g[e],t.h--}}this.I=null},be.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},be.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var Se,_e=w.JSON.stringify,Ae=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new xe,e=>e.reset());class xe{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Ne(e,t){var n;Se||(n=w.Promise.resolve(void 0),Se=function(){n.then(ke)}),Ce||(Se(),Ce=!0),De.add(e,t)}var Ce=!1,De=new class{constructor(){this.h=this.g=null}add(e,t){const n=Ae.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function ke(){for(var e;e=function(){var e=De;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}();){try{e.h.call(e.g)}catch(e){!function(e){w.setTimeout(()=>{throw e},0)}(e)}var t=Ae;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}Ce=!1}function Oe(e,t){be.call(this),this.h=e||1,this.g=t||w,this.j=_(this.kb,this),this.l=Date.now()}function Re(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}function Le(e,t,n){if("function"==typeof e)n&&(e=_(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=_(e.handleEvent,e)}return 2147483647<Number(t)?-1:w.setTimeout(e,t||0)}x(Oe,be),($=Oe.prototype).da=!1,$.S=null,$.kb=function(){var e;this.da&&(0<(e=Date.now()-this.l)&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Te(this,"tick"),this.da&&(Re(this),this.start())))},$.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},$.M=function(){Oe.Z.M.call(this),Re(this),delete this.g};class Me extends N{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=Le(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.j);var n=t.h;t.h=null,t.m.apply(null,n)}(this)}M(){super.M(),this.g&&(w.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Pe(e){N.call(this),this.h=e,this.g={}}x(Pe,N);var Fe=[];function Ve(e,t,n,r){Array.isArray(n)||(n&&(Fe[0]=n.toString()),n=Fe);for(var s=0;s<n.length;s++){var i=function e(t,n,r,s,i){if(s&&s.once)return function e(t,n,r,s,i){if(Array.isArray(n)){for(var o=0;o<n.length;o++)e(t,n[o],r,s,i);return null}return r=Ie(r),t&&t[ie]?t.O(n,r,I(s)?!!s.capture:!!s,i):ge(t,n,r,!0,s,i)}(t,n,r,s,i);if(Array.isArray(n)){for(var o=0;o<n.length;o++)e(t,n[o],r,s,i);return null}return r=Ie(r),t&&t[ie]?t.N(n,r,I(s)?!!s.capture:!!s,i):ge(t,n,r,!1,s,i)}(t,n[s],r||e.handleEvent,!1,e.h||e);if(!i)break;e.g[i.key]=i}}function Ue(e){U(e.g,function(e,t){this.g.hasOwnProperty(t)&&me(e)},e),e.g={}}function qe(){this.g=!0}function Be(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(r.length<2)){var s=r[1];if(Array.isArray(s)&&!(s.length<1)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return _e(n)}catch(e){return t}}(e,n)+(r?" "+r:"")})}Pe.prototype.M=function(){Pe.Z.M.call(this),Ue(this)},Pe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},qe.prototype.Aa=function(){this.g=!1},qe.prototype.info=function(){};var je={},Ke=null;function Ge(){return Ke=Ke||new be}function $e(e){ne.call(this,je.Ma,e)}function Qe(){var e=Ge();Te(e,new $e(e))}function ze(e,t){ne.call(this,je.STAT_EVENT,e),this.stat=t}function He(e){var t=Ge();Te(t,new ze(t,e))}function We(e,t){ne.call(this,je.Na,e),this.size=t}function Ye(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return w.setTimeout(function(){e()},t)}je.Ma="serverreachability",x($e,ne),je.STAT_EVENT="statevent",x(ze,ne),je.Na="timingevent",x(We,ne);J={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},V={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function Xe(){}function Je(e){return e.h||(e.h=e.i())}function Ze(){}function et(){ne.call(this,"d")}function tt(){ne.call(this,"c")}function nt(){}function rt(e,t,n,r){this.l=e,this.j=t,this.m=n,this.X=r||1,this.V=new Pe(this),this.P=ot,this.W=new Oe(e=H?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new st}function st(){this.i=null,this.g="",this.h=!1}Xe.prototype.h=null,p={OPEN:"a",pb:"b",Ka:"c",Bb:"d"},x(et,ne),x(tt,ne),x(nt,Xe),nt.prototype.g=function(){return new XMLHttpRequest},nt.prototype.i=function(){return{}};var it=new nt,ot=45e3,at={},ht={};function ut(e,t,n){e.K=1,e.v=kt(_t(t)),e.s=n,e.U=!0,ct(e,null)}function ct(e,t){e.F=Date.now(),ft(e),e.A=_t(e.v);var o,a,h,u,c,l,n=e.A,r=e.X;Array.isArray(r)||(r=[String(r)]),Gt(n.h,"t",r),e.C=0,n=e.l.H,e.h=new st,e.g=$n(e.l,n?t:null,!e.s),0<e.O&&(e.L=new Me(_(e.Ia,e,e.g),e.O)),Ve(e.V,e.g,"readystatechange",e.gb),t=e.H?q(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Qe(),o=e.j,a=e.u,h=e.A,u=e.m,c=e.X,l=e.s,o.info(function(){if(o.g)if(l)for(var e="",t=l.split("&"),n=0;n<t.length;n++){var r,s,i=t[n].split("=");1<i.length&&(r=i[0],i=i[1],e=2<=(s=r.split("_")).length&&"type"==s[1]?e+(r+"=")+i+"&":e+(r+"=redacted&"))}else e=null;else e=l;return"XMLHTTP REQ ("+u+") [attempt "+c+"]: "+a+"\n"+h+"\n"+e})}function lt(e){return e.g&&"GET"==e.u&&2!=e.K&&e.l.Ba}function dt(e,t,n){let r=!0,s;for(;!e.I&&e.C<n.length;){if(s=(h=void 0,a=(i=e).C,-1==(h=(o=n).indexOf("\n",a))?ht:(a=Number(o.substring(a,h)),isNaN(a)?at:(h+=1)+a>o.length?ht:(o=o.substr(h,a),i.C=h+a,o))),s==ht){4==t&&(e.o=4,He(14),r=!1),Be(e.j,e.m,null,"[Incomplete Response]");break}if(s==at){e.o=4,He(15),Be(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}Be(e.j,e.m,s,null),wt(e,s)}var i,o,a,h;lt(e)&&s!=ht&&s!=at&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,He(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.aa&&(e.aa=!0,(t=e.l).g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),Fn(t),t.L=!0,He(11))):(Be(e.j,e.m,n,"[Invalid Chunked Response]"),yt(e),pt(e))}function ft(e){e.Y=Date.now()+e.P,gt(e,e.P)}function gt(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Ye(_(e.eb,e),t)}function mt(e){e.B&&(w.clearTimeout(e.B),e.B=null)}function pt(e){0==e.l.G||e.I||qn(e.l,e)}function yt(e){mt(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,Re(e.W),Ue(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function wt(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||Xt(n.i,e)))if(n.I=e.N,!e.J&&Xt(n.i,e)&&3==n.G){try{var r=n.Ca.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;Un(n),Nn(n)}Pn(n),He(18)}}else n.ta=s[1],0<n.ta-n.U&&s[2]<37500&&n.N&&0==n.A&&!n.v&&(n.v=Ye(_(n.ab,n),6e3));if(Yt(n.i)<=1&&n.ka){try{n.ka()}catch(e){}n.ka=void 0}}else jn(n,11)}else if(!e.J&&n.g!=e||Un(n),!L(t))for(s=n.Ca.g.parse(t),t=0;t<s.length;t++){var i=s[t];if(n.U=i[0],i=i[1],2==n.G)if("c"==i[0]){n.J=i[1],n.la=i[2];var o=i[3];null!=o&&(n.ma=o,n.h.info("VER="+n.ma));var a=i[4];null!=a&&(n.za=a,n.h.info("SVER="+n.za));var h,u,c,l=i[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;const m=e.g;m&&(!(h=m.g?m.g.getResponseHeader("X-Client-Wire-Protocol"):null)||!(u=r.i).g&&(P(h,"spdy")||P(h,"quic")||P(h,"h2"))&&(u.j=u.l,u.g=new Set,u.h&&(Jt(u,u.h),u.h=null)),!r.D||(c=m.g?m.g.getResponseHeader("X-HTTP-Session-Id"):null)&&(r.sa=c,Dt(r.F,r.D,c))),n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-e.F,n.h.info("Handshake RTT: "+n.O+"ms"));var d,f,g=e;(r=n).oa=Gn(r,r.H?r.la:null,r.W),g.J?(Zt(r.i,g),d=g,(f=r.K)&&d.setTimeout(f),d.B&&(mt(d),ft(d)),r.g=g):Mn(r),0<n.l.length&&kn(n)}else"stop"!=i[0]&&"close"!=i[0]||jn(n,7);else 3==n.G&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?jn(n,7):xn(n):"noop"!=i[0]&&n.j&&n.j.wa(i),n.A=0)}Qe()}catch(e){}}function vt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(v(e)||"string"==typeof e)k(e,t,void 0);else{if(e.T&&"function"==typeof e.T)var n=e.T();else if(e.R&&"function"==typeof e.R)n=void 0;else if(v(e)||"string"==typeof e)for(var n=[],r=e.length,s=0;s<r;s++)n.push(s);else for(s in n=[],r=0,e)n[r++]=s;for(var s=(r=function(e){if(e.R&&"function"==typeof e.R)return e.R();if("string"==typeof e)return e.split("");if(v(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e)).length,i=0;i<s;i++)t.call(void 0,r[i],n&&n[i],e)}}function It(e,t){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof It)for(n=e.T(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}function bt(e){if(e.i!=e.g.length){for(var t=0,n=0;t<e.g.length;){var r=e.g[t];Tt(e.h,r)&&(e.g[n++]=r),t++}e.g.length=n}if(e.i!=e.g.length){for(var s={},n=t=0;t<e.g.length;)Tt(s,r=e.g[t])||(s[e.g[n++]=r]=1),t++;e.g.length=n}}function Tt(e,t){return Object.prototype.hasOwnProperty.call(e,t)}($=rt.prototype).setTimeout=function(e){this.P=e},$.gb=function(e){e=e.target;const t=this.L;t&&3==Tn(e)?t.l():this.Ia(e)},$.Ia=function(e){try{if(e==this.g)e:{var t=Tn(this.g),n=this.g.Da();if(this.g.ba(),!(t<3)&&(3!=t||H||this.g&&(this.h.h||this.g.ga()||En(this.g)))){this.I||4!=t||7==n||Qe(),mt(this);var r=this.g.ba();this.N=r;t:if(lt(this)){var s=En(this.g);e="";var i=s.length,o=4==Tn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){yt(this),pt(this);var a="";break t}this.h.i=new w.TextDecoder}for(n=0;n<i;n++)this.h.h=!0,e+=this.h.i.decode(s[n],{stream:o&&n==i-1});s.splice(0,i),this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.ga();if(this.i=200==r,l=this.j,d=this.u,f=this.A,g=this.m,m=this.X,p=t,y=r,l.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+m+"]: "+d+"\n"+f+"\n"+p+" "+y}),this.i){if(this.$&&!this.J){t:{if(this.g){var h,u=this.g;if((h=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!L(h)){var c=h;break t}}c=null}if(!(r=c)){this.i=!1,this.o=3,He(12),yt(this),pt(this);break e}Be(this.j,this.m,r,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,wt(this,r)}this.U?(dt(this,t,a),H&&this.i&&3==t&&(Ve(this.V,this.W,"tick",this.fb),this.W.start())):(Be(this.j,this.m,a,null),wt(this,a)),4==t&&yt(this),this.i&&!this.I&&(4==t?qn(this.l,this):(this.i=!1,ft(this)))}else 400==r&&0<a.indexOf("Unknown SID")?(this.o=3,He(12)):(this.o=0,He(13)),yt(this),pt(this)}}}catch(e){}var l,d,f,g,m,p,y},$.fb=function(){var e,t;this.g&&(e=Tn(this.g),t=this.g.ga(),this.C<t.length&&(mt(this),dt(this,e,t),this.i&&4!=e&&ft(this)))},$.cancel=function(){this.I=!0,yt(this)},$.eb=function(){this.B=null;var e,t,n=Date.now();0<=n-this.Y?(e=this.j,t=this.A,e.info(function(){return"TIMEOUT: "+t}),2!=this.K&&(Qe(),He(17)),yt(this),this.o=2,pt(this)):gt(this,this.Y-n)},($=It.prototype).R=function(){bt(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e},$.T=function(){return bt(this),this.g.concat()},$.get=function(e,t){return Tt(this.h,e)?this.h[e]:t},$.set=function(e,t){Tt(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t},$.forEach=function(e,t){for(var n=this.T(),r=0;r<n.length;r++){var s=n[r],i=this.get(s);e.call(t,i,s,this)}};var Et=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function St(e,t){var n;this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof St?(this.g=void 0!==t?t:e.g,At(this,e.j),this.s=e.s,xt(this,e.i),Nt(this,e.m),this.l=e.l,t=e.h,(n=new qt).i=t.i,t.g&&(n.g=new It(t.g),n.h=t.h),Ct(this,n),this.o=e.o):e&&(n=String(e).match(Et))?(this.g=!!t,At(this,n[1]||"",!0),this.s=Ot(n[2]||""),xt(this,n[3]||"",!0),Nt(this,n[4]),this.l=Ot(n[5]||"",!0),Ct(this,n[6]||"",!0),this.o=Ot(n[7]||"")):(this.g=!!t,this.h=new qt(null,this.g))}function _t(e){return new St(e)}function At(e,t,n){e.j=n?Ot(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function xt(e,t,n){e.i=n?Ot(t,!0):t}function Nt(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.m=t}else e.m=null}function Ct(e,t,n){var r,s;t instanceof qt?(e.h=t,r=e.h,(s=e.g)&&!r.j&&(Bt(r),r.i=null,r.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(jt(this,t),Gt(this,n,e))},r)),r.j=s):(n||(t=Rt(t,Vt)),e.h=new qt(t,e.g))}function Dt(e,t,n){e.h.set(t,n)}function kt(e){return Dt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Ot(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Rt(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,Lt),n?e.replace(/%25([0-9a-fA-F]{2})/g,"%$1"):e):null}function Lt(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}St.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Rt(t,Mt,!0),":");var n=this.i;return!n&&"file"!=t||(e.push("//"),(t=this.s)&&e.push(Rt(t,Mt,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&e.push("/"),e.push(Rt(n,"/"==n.charAt(0)?Ft:Pt,!0))),(n=this.h.toString())&&e.push("?",n),(n=this.o)&&e.push("#",Rt(n,Ut)),e.join("")};var Mt=/[#\/\?@]/g,Pt=/[#\?:]/g,Ft=/[#\?]/g,Vt=/[#\?@]/g,Ut=/#/g;function qt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Bt(i){i.g||(i.g=new It,i.h=0,i.i&&function(e){if(e){e=e.split("&");for(var t=0;t<e.length;t++){var n,r=e[t].indexOf("="),s=null;0<=r?(n=e[t].substring(0,r),s=e[t].substring(r+1)):n=e[t],r=n,s=s?decodeURIComponent(s.replace(/\+/g," ")):"",i.add(decodeURIComponent(r.replace(/\+/g," ")),s)}}}(i.i))}function jt(e,t){Bt(e),t=$t(e,t),Tt(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,Tt((e=e.g).h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&bt(e)))}function Kt(e,t){return Bt(e),t=$t(e,t),Tt(e.g.h,t)}function Gt(e,t,n){jt(e,t),0<n.length&&(e.i=null,e.g.set($t(e,t),R(n)),e.h+=n.length)}function $t(e,t){return t=String(t),e.j?t.toLowerCase():t}($=qt.prototype).add=function(e,t){Bt(this),this.i=null,e=$t(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},$.forEach=function(n,r){Bt(this),this.g.forEach(function(e,t){k(e,function(e){n.call(r,e,t,this)},this)},this)},$.T=function(){Bt(this);for(var e=this.g.R(),t=this.g.T(),n=[],r=0;r<t.length;r++)for(var s=e[r],i=0;i<s.length;i++)n.push(t[r]);return n},$.R=function(e){Bt(this);var t=[];if("string"==typeof e)Kt(this,e)&&(t=O(t,this.g.get($t(this,e))));else{e=this.g.R();for(var n=0;n<e.length;n++)t=O(t,e[n])}return t},$.set=function(e,t){return Bt(this),this.i=null,Kt(this,e=$t(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},$.get=function(e,t){return e&&0<(e=this.R(e)).length?String(e[0]):t},$.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),n=0;n<t.length;n++)for(var r=t[n],s=encodeURIComponent(String(r)),r=this.R(r),i=0;i<r.length;i++){var o=s;""!==r[i]&&(o+="="+encodeURIComponent(String(r[i]))),e.push(o)}return this.i=e.join("&")};var Qt,zt=class{constructor(e,t){this.h=e,this.g=t}};function Ht(e){this.l=e||10,e=w.PerformanceNavigationTiming?0<(e=w.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(w.g&&w.g.Ea&&w.g.Ea()&&w.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Wt(e){return e.h||e.g&&e.g.size>=e.j}function Yt(e){return e.h?1:e.g?e.g.size:0}function Xt(e,t){return e.h?e.h==t:e.g&&e.g.has(t)}function Jt(e,t){e.g?e.g.add(t):e.h=t}function Zt(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function en(t){if(null!=t.h)return t.i.concat(t.h.D);if(null==t.g||0===t.g.size)return R(t.i);{let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}}function tn(){}function nn(){this.g=new tn}function rn(e,t,n,r,s){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,s(r)}catch(e){}}function sn(e){this.l=e.$b||null,this.j=e.ib||!1}function on(e,t){be.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=an,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Ht.prototype.cancel=function(){if(this.i=en(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},tn.prototype.stringify=function(e){return w.JSON.stringify(e,void 0)},tn.prototype.parse=function(e){return w.JSON.parse(e,void 0)},x(sn,Xe),sn.prototype.g=function(){return new on(this.l,this.j)},sn.prototype.i=(Qt={},function(){return Qt}),x(on,be);var an=0;function hn(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}function un(e){e.readyState=4,e.l=null,e.j=null,e.A=null,cn(e)}function cn(e){e.onreadystatechange&&e.onreadystatechange.call(e)}($=on.prototype).open=function(e,t){if(this.readyState!=an)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,cn(this)},$.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||w).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))},$.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,un(this)),this.readyState=an},$.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,cn(this)),this.g&&(this.readyState=3,cn(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==w.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;hn(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))},$.Sa=function(e){var t;this.g&&(this.u&&e.value?this.response.push(e.value):this.u||(t=e.value||new Uint8Array(0),(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)),(e.done?un:cn)(this),3==this.readyState&&hn(this))},$.Ua=function(e){this.g&&(this.response=this.responseText=e,un(this))},$.Ta=function(e){this.g&&(this.response=e,un(this))},$.ha=function(){this.g&&un(this)},$.setRequestHeader=function(e,t){this.v.append(e,t)},$.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},$.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(on.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var ln=w.JSON.parse;function dn(e){be.call(this),this.headers=new It,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=fn,this.K=this.L=!1}x(dn,be);var fn="",gn=/^https?$/i,mn=["POST","PUT"];function pn(e){return"content-type"==e.toLowerCase()}function yn(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,wn(e),In(e)}function wn(e){e.D||(e.D=!0,Te(e,"complete"),Te(e,"error"))}function vn(e){if(e.h&&(!e.C[1]||4!=Tn(e)||2!=e.ba()))if(e.v&&4==Tn(e))Le(e.Fa,0,e);else if(Te(e,"readystatechange"),4==Tn(e)){e.h=!1;try{var t,n,r,s,i=e.ba();e:switch(i){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var o=!0;break e;default:o=!1}if((t=o)||((n=0===i)&&(!(s=String(e.H).match(Et)[1]||null)&&w.self&&w.self.location&&(s=(r=w.self.location.protocol).substr(0,r.length-1)),n=!gn.test(s?s.toLowerCase():"")),t=n),t)Te(e,"complete"),Te(e,"success");else{e.m=6;try{var a=2<Tn(e)?e.g.statusText:""}catch(e){a=""}e.j=a+" ["+e.ba()+"]",wn(e)}}finally{In(e)}}}function In(e,t){if(e.g){bn(e);const n=e.g,r=e.C[0]?y:null;e.g=null,e.C=null,t||Te(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function bn(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(w.clearTimeout(e.A),e.A=null)}function Tn(e){return e.g?e.g.readyState:0}function En(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case fn:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Sn(e,t,r){e:{for(n in r){var n=!1;break e}n=!0}n||(r=function(){let n="";return U(r,function(e,t){n+=t,n+=":",n+=e,n+="\r\n"}),n}(),"string"==typeof e?null!=r&&encodeURIComponent(String(r)):Dt(e,t,r))}function _n(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function An(e){this.za=0,this.l=[],this.h=new qe,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=_n("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=_n("baseRetryDelayMs",5e3,e),this.$a=_n("retryDelaySeedMs",1e4,e),this.Ya=_n("forwardChannelMaxRetries",2,e),this.ra=_n("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new Ht(e&&e.concurrentRequestLimit),this.Ca=new nn,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||!1!==e.Xb}function xn(e){var t,n;Cn(e),3==e.G&&(t=e.V++,Dt(n=_t(e.F),"SID",e.J),Dt(n,"RID",t),Dt(n,"TYPE","terminate"),Rn(e,n),(t=new rt(e,e.h,t,void 0)).K=2,t.v=kt(_t(n)),n=!1,!(n=w.navigator&&w.navigator.sendBeacon?w.navigator.sendBeacon(t.v.toString(),""):n)&&w.Image&&((new Image).src=t.v,n=!0),n||(t.g=$n(t.l,null),t.g.ea(t.v)),t.F=Date.now(),ft(t)),Kn(e)}function Nn(e){e.g&&(Fn(e),e.g.cancel(),e.g=null)}function Cn(e){Nn(e),e.u&&(w.clearTimeout(e.u),e.u=null),Un(e),e.i.cancel(),e.m&&("number"==typeof e.m&&w.clearTimeout(e.m),e.m=null)}function Dn(e,t){e.l.push(new zt(e.Za++,t)),3==e.G&&kn(e)}function kn(e){Wt(e.i)||e.m||(e.m=!0,Ne(e.Ha,e),e.C=0)}function On(e,t){var n=t?t.m:e.V++,r=_t(e.F);Dt(r,"SID",e.J),Dt(r,"RID",n),Dt(r,"AID",e.U),Rn(e,r),e.o&&e.s&&Sn(r,e.o,e.s),n=new rt(e,e.h,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.l=t.D.concat(e.l)),t=Ln(e,n,1e3),n.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),Jt(e.i,n),ut(n,r,t)}function Rn(e,n){e.j&&vt({},function(e,t){Dt(n,t,e)})}function Ln(r,e,s){s=Math.min(r.l.length,s);var i=r.j?_(r.j.Oa,r.j,r):null;e:{var o=r.l;let n=-1;for(;;){const u=["count="+s];-1==n?0<s?(n=o[0].h,u.push("ofs="+n)):n=0:u.push("ofs="+n);let t=!0;for(let e=0;e<s;e++){var a=o[e].h,h=o[e].g;if((a-=n)<0)n=Math.max(0,o[e].h-100),t=!1;else try{!function(e,r){const s="req"+a+"_"||"";try{vt(e,function(e,t){let n=e;I(e)&&(n=_e(e)),r.push(s+t+"="+encodeURIComponent(n))})}catch(e){throw r.push(s+"type="+encodeURIComponent("_badmap")),e}}(h,u)}catch(r){i&&i(h)}}if(t){i=u.join("&");break e}}}return r=r.l.splice(0,s),e.D=r,i}function Mn(e){e.g||e.u||(e.Y=1,Ne(e.Ga,e),e.A=0)}function Pn(e){return!(e.g||e.u||3<=e.A)&&(e.Y++,e.u=Ye(_(e.Ga,e),Bn(e,e.A)),e.A++,1)}function Fn(e){null!=e.B&&(w.clearTimeout(e.B),e.B=null)}function Vn(e){e.g=new rt(e,e.h,"rpc",e.Y),null===e.o&&(e.g.H=e.s),e.g.O=0;var t=_t(e.oa);Dt(t,"RID","rpc"),Dt(t,"SID",e.J),Dt(t,"CI",e.N?"0":"1"),Dt(t,"AID",e.U),Rn(e,t),Dt(t,"TYPE","xmlhttp"),e.o&&e.s&&Sn(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.la,n.K=1,n.v=kt(_t(t)),n.s=null,n.U=!0,ct(n,e)}function Un(e){null!=e.v&&(w.clearTimeout(e.v),e.v=null)}function qn(e,t){var n,r,s,i=null;if(e.g==t){Un(e),Fn(e),e.g=null;var o=2}else{if(!Xt(e.i,t))return;i=t.D,Zt(e.i,t),o=1}if(e.I=t.N,0!=e.G)if(t.i)1==o?(i=t.s?t.s.length:0,t=Date.now()-t.F,n=e.C,Te(o=Ge(),new We(o,i)),kn(e)):Mn(e);else if(3==(n=t.o)||0==n&&0<e.I||(1!=o||(s=t,Yt((r=e).i)>=r.i.j-(r.m?1:0)||(r.m?(r.l=s.D.concat(r.l),0):1==r.G||2==r.G||r.C>=(r.Xa?0:r.Ya)||(r.m=Ye(_(r.Ha,r,s),Bn(r,r.C)),r.C++,0))))&&(2!=o||!Pn(e)))switch(i&&0<i.length&&(t=e.i,t.i=t.i.concat(i)),n){case 1:jn(e,5);break;case 4:jn(e,10);break;case 3:jn(e,6);break;default:jn(e,2)}}function Bn(e,t){let n=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(n*=2),n*t}function jn(e,t){var n,r;e.h.info("Error code "+t),2==t?(n=null,e.j&&(n=null),r=_(e.jb,e),n||(n=new St("//www.google.com/images/cleardot.gif"),w.location&&"http"==w.location.protocol||At(n,"https"),kt(n)),function(e,t){var n=new qe;if(w.Image){const r=new Image;r.onload=A(rn,n,r,"TestLoadImage: loaded",!0,t),r.onerror=A(rn,n,r,"TestLoadImage: error",!1,t),r.onabort=A(rn,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=A(rn,n,r,"TestLoadImage: timeout",!1,t),w.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(n.toString(),r)):He(2),e.G=0,e.j&&e.j.va(t),Kn(e),Cn(e)}function Kn(e){e.G=0,e.I=-1,e.j&&(0==en(e.i).length&&0==e.l.length||(e.i.i.length=0,R(e.l),e.l.length=0),e.j.ua())}function Gn(e,t,n){let r=(a=n)instanceof St?_t(a):new St(a,void 0);var s,i,o,a,h;return""!=r.i?(t&&xt(r,t+"."+r.i),Nt(r,r.m)):(h=w.location,r=(s=h.protocol,i=t?t+"."+h.hostname:h.hostname,o=+h.port,a=n,h=new St(null,void 0),s&&At(h,s),i&&xt(h,i),o&&Nt(h,o),a&&(h.l=a),h)),e.aa&&U(e.aa,function(e,t){Dt(r,t,e)}),t=e.D,n=e.sa,t&&n&&Dt(r,t,n),Dt(r,"VER",e.ma),Rn(e,r),r}function $n(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ba&&!e.qa?new dn(new sn({ib:!0})):new dn(e.qa)).L=e.H,t}function Qn(){}function zn(){if(Q&&!(10<=Number(ee)))throw Error("Environmental error: no available transport.")}function Hn(e,t){be.call(this),this.g=new An(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!L(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!L(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new Xn(this)}function Wn(e){et.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function Yn(){tt.call(this),this.status=1}function Xn(e){this.g=e}($=dn.prototype).ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=(this.u||it).g(),this.C=this.u?Je(this.u):Je(it),this.g.onreadystatechange=_(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(e){return void yn(this,e)}e=n||"";const s=new It(this.headers);r&&vt(r,function(e,t){s.set(t,e)}),r=function(t){e:{var n=pn,r=t.length,s="string"==typeof t?t.split(""):t;for(let e=0;e<r;e++)if(e in s&&n.call(void 0,s[e],e,t)){n=e;break e}n=-1}return n<0?null:"string"==typeof t?t.charAt(n):t[n]}(s.T()),n=w.FormData&&e instanceof w.FormData,0<=D(mn,t)&&!r&&!n&&s.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),s.forEach(function(e,t){this.g.setRequestHeader(t,e)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{bn(this),0<this.B&&((this.K=(a=this.g,Q&&(i=function(){let t=0;var n=M(String(G)).split("."),r=M("9").split("."),s=Math.max(n.length,r.length);for(let e=0;0==t&&e<s;e++)for(var i=n[e]||"",o=r[e]||"";i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],(0!=i[0].length||0!=o[0].length)&&(t=F(0==i[1].length?0:parseInt(i[1],10),0==o[1].length?0:parseInt(o[1],10))||F(0==i[2].length,0==o[2].length)||F(i[2],o[2]),i=i[3],o=o[3],0==t););return 0<=t},o=Z,Object.prototype.hasOwnProperty.call(o,9)?o[9]:o[9]=i())&&"number"==typeof a.timeout&&void 0!==a.ontimeout))?(this.g.timeout=this.B,this.g.ontimeout=_(this.pa,this)):this.A=Le(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){yn(this,e)}var i,o,a},$.pa=function(){this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Te(this,"timeout"),this.abort(8))},$.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,Te(this,"complete"),Te(this,"abort"),In(this))},$.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),In(this,!0)),dn.Z.M.call(this)},$.Fa=function(){this.s||(this.F||this.v||this.l?vn(this):this.cb())},$.cb=function(){vn(this)},$.ba=function(){try{return 2<Tn(this)?this.g.status:-1}catch(e){return-1}},$.ga=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},$.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),ln(t)}},$.Da=function(){return this.m},$.La=function(){return"string"==typeof this.j?this.j:String(this.j)},($=An.prototype).ma=8,$.G=1,$.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch(e){}},$.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;const i=new rt(this,this.h,t,void 0);let e=this.s;if(this.P&&(e?(e=q(e),j(e,this.P)):e=this.P),null===this.o&&(i.H=e),this.ja)e:{for(var n=0,r=0;r<this.l.length;r++){var s=this.l[r];if(void 0===(s="__data__"in s.g&&"string"==typeof(s=s.g.__data__)?s.length:void 0))break;if(4096<(n+=s)){n=r;break e}if(4096===n||r===this.l.length-1){n=r+1;break e}}n=1e3}else n=1e3;n=Ln(this,i,n),Dt(r=_t(this.F),"RID",t),Dt(r,"CVER",22),this.D&&Dt(r,"X-HTTP-Session-Id",this.D),Rn(this,r),this.o&&e&&Sn(r,this.o,e),Jt(this.i,i),this.Ra&&Dt(r,"TYPE","init"),this.ja?(Dt(r,"$req",n),Dt(r,"SID","null"),i.$=!0,ut(i,r,null)):ut(i,r,n),this.G=2}}else 3==this.G&&(t?On(this,t):0==this.l.length||Wt(this.i)||On(this))},$.Ga=function(){var e;this.u=null,Vn(this),this.$&&!(this.L||null==this.g||this.O<=0)&&(e=2*this.O,this.h.info("BP detection timer enabled: "+e),this.B=Ye(_(this.bb,this),e))},$.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,He(10),Nn(this),Vn(this))},$.ab=function(){null!=this.v&&(this.v=null,Nn(this),Pn(this),He(19))},$.jb=function(e){e?(this.h.info("Successfully pinged google.com"),He(2)):(this.h.info("Failed to ping google.com"),He(1))},($=Qn.prototype).xa=function(){},$.wa=function(){},$.va=function(){},$.ua=function(){},$.Oa=function(){},zn.prototype.g=function(e,t){return new Hn(e,t)},x(Hn,be),Hn.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),Ne(_(e.hb,e,t))),He(0),e.W=t,e.aa=n||{},e.N=e.X,e.F=Gn(e,null,e.W),kn(e)},Hn.prototype.close=function(){xn(this.g)},Hn.prototype.u=function(e){var t;"string"==typeof e?((t={}).__data__=e,Dn(this.g,t)):this.v?((t={}).__data__=_e(e),Dn(this.g,t)):Dn(this.g,e)},Hn.prototype.M=function(){this.g.j=null,delete this.j,xn(this.g),delete this.g,Hn.Z.M.call(this)},x(Wn,et),x(Yn,tt),x(Xn,Qn),Xn.prototype.xa=function(){Te(this.g,"a")},Xn.prototype.wa=function(e){Te(this.g,new Wn(e))},Xn.prototype.va=function(e){Te(this.g,new Yn)},Xn.prototype.ua=function(){Te(this.g,"b")},zn.prototype.createWebChannel=zn.prototype.g,Hn.prototype.send=Hn.prototype.u,Hn.prototype.open=Hn.prototype.m,J.NO_ERROR=0,J.TIMEOUT=8,J.HTTP_ERROR=6,V.COMPLETE="complete",(Ze.EventType=p).OPEN="a",p.CLOSE="b",p.ERROR="c",p.MESSAGE="d",be.prototype.listen=be.prototype.N,dn.prototype.listenOnce=dn.prototype.O,dn.prototype.getLastError=dn.prototype.La,dn.prototype.getLastErrorCode=dn.prototype.Da,dn.prototype.getStatus=dn.prototype.ba,dn.prototype.getResponseJson=dn.prototype.Qa,dn.prototype.getResponseText=dn.prototype.ga,dn.prototype.send=dn.prototype.ea;var Jn,Zn,er=Ge,tr=J,nr=V,rr=je,sr=sn,ir=Ze,or=dn,J="@firebase/firestore";class ar{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ar.UNAUTHENTICATED=new ar(null),ar.GOOGLE_CREDENTIALS=new ar("google-credentials-uid"),ar.FIRST_PARTY=new ar("first-party-uid"),ar.MOCK_USER=new ar("mock-user");let hr="9.6.7";const ur=new class{constructor(e){this.name=e,this._logLevel=c,this._logHandler=m,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in l))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?u[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,l.DEBUG,...e),this._logHandler(this,l.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,l.VERBOSE,...e),this._logHandler(this,l.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,l.INFO,...e),this._logHandler(this,l.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,l.WARN,...e),this._logHandler(this,l.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,l.ERROR,...e),this._logHandler(this,l.ERROR,...e)}}("@firebase/firestore");function cr(){return ur.logLevel}function lr(e,...t){ur.logLevel<=l.DEBUG&&(t=t.map(gr),ur.debug(`Firestore (${hr}): ${e}`,...t))}function dr(e,...t){ur.logLevel<=l.ERROR&&(t=t.map(gr),ur.error(`Firestore (${hr}): ${e}`,...t))}function fr(e,...t){ur.logLevel<=l.WARN&&(t=t.map(gr),ur.warn(`Firestore (${hr}): ${e}`,...t))}function gr(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(e){return t}}function mr(e="Unexpected state"){e=`FIRESTORE (${hr}) INTERNAL ASSERTION FAILED: `+e;throw dr(e),new Error(e)}function pr(e){e||mr()}const yr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class wr extends s{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class vr{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Ir{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class br{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(ar.UNAUTHENTICATED))}shutdown(){}}class Tr{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Er{constructor(e){this.t=e,this.currentUser=ar.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,n){let r=this.i;const s=e=>this.i!==r?(r=this.i,n(e)):Promise.resolve();let i=new vr;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new vr,t.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const e=i;t.enqueueRetryable(async()=>{await e.promise,await s(this.currentUser)})},a=e=>{lr("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(e=>a(e)),setTimeout(()=>{var e;this.auth||((e=this.t.getImmediate({optional:!0}))?a(e):(lr("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new vr))},0),o()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.i!==t?(lr("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(pr("string"==typeof e.accessToken),new Ir(e.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){var e=this.auth&&this.auth.getUid();return pr(null===e||"string"==typeof e),new ar(e)}}class Sr{constructor(e,t,n){this.type="FirstParty",this.user=ar.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",t);e=e.auth.getAuthHeaderValueForFirstParty([]);e&&this.headers.set("Authorization",e),n&&this.headers.set("X-Goog-Iam-Authorization-Token",n)}}class _r{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new Sr(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(ar.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Ar{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&0<e.length&&this.headers.set("x-firebase-appcheck",this.value)}}class xr{constructor(e){this.g=e,this.forceRefresh=!1,this.appCheck=null,this.p=null}start(t,n){const r=e=>{null!=e.error&&lr("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);var t=e.token!==this.p;return this.p=e.token,lr("FirebaseAppCheckTokenProvider",`Received ${t?"new":"existing"} token.`),t?n(e.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable(()=>r(e))};const s=e=>{lr("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.g.onInit(e=>s(e)),setTimeout(()=>{var e;this.appCheck||((e=this.g.getImmediate({optional:!0}))?s(e):lr("FirebaseAppCheckTokenProvider","AppCheck not yet detected"))},0)}getToken(){var e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(pr("string"==typeof e.token),this.p=e.token,new Ar(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class Nr{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.I(e),this.T=e=>t.writeSequenceNumber(e))}I(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){var e=++this.previousValue;return this.T&&this.T(e),e}}Nr.A=-1;class Cr{static R(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/t.length)*t.length;let r="";for(;r.length<20;){var s=function(){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),t=new Uint8Array(40);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let e=0;e<40;e++)t[e]=Math.floor(256*Math.random());return t}();for(let e=0;e<s.length;++e)r.length<20&&s[e]<n&&(r+=t.charAt(s[e]%t.length))}return r}}function Dr(e,t){return e<t?-1:t<e?1:0}function kr(e,n,r){return e.length===n.length&&e.every((e,t)=>r(e,n[t]))}function Or(e){return e+"\0"}class Rr{constructor(e,t){if(this.seconds=e,(this.nanoseconds=t)<0)throw new wr(yr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(1e9<=t)throw new wr(yr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new wr(yr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(253402300800<=e)throw new wr(yr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Rr.fromMillis(Date.now())}static fromDate(e){return Rr.fromMillis(e.getTime())}static fromMillis(e){var t=Math.floor(e/1e3),e=Math.floor(1e6*(e-1e3*t));return new Rr(t,e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Dr(this.nanoseconds,e.nanoseconds):Dr(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Lr{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Lr(e)}static min(){return new Lr(new Rr(0,0))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function Mr(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Pr(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Fr(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class Vr{constructor(e,t,n){void 0===t?t=0:t>e.length&&mr(),void 0===n?n=e.length-t:n>e.length-t&&mr(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Vr.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Vr?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(n){for(let e=this.offset,t=this.limit();e<t;e++)n(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,n){const r=Math.min(t.length,n.length);for(let e=0;e<r;e++){const r=t.get(e),s=n.get(e);if(r<s)return-1;if(r>s)return 1}return t.length<n.length?-1:t.length>n.length?1:0}}class Ur extends Vr{construct(e,t,n){return new Ur(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(0<=n.indexOf("//"))throw new wr(yr.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>0<e.length))}return new Ur(t)}static emptyPath(){return new Ur([])}}const qr=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Br extends Vr{construct(e,t,n){return new Br(e,t,n)}static isValidIdentifier(e){return qr.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e=Br.isValidIdentifier(e)?e:"`"+e+"`")).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Br(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;var s=()=>{if(0===n.length)throw new wr(yr.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let i=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new wr(yr.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new wr(yr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?i=!i:"."!==t||i?n+=t:s(),r++}if(s(),i)throw new wr(yr.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Br(t)}static emptyPath(){return new Br([])}}class jr{constructor(e){(this.fields=e).sort(Br.comparator)}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return kr(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class Kr{constructor(e){this.binaryString=e}static fromBase64String(e){e=atob(e);return new Kr(e)}static fromUint8Array(e){e=function(t){let n="";for(let e=0;e<t.length;++e)n+=String.fromCharCode(t[e]);return n}(e);return new Kr(e)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Dr(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Kr.EMPTY_BYTE_STRING=new Kr("");const Gr=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function $r(t){if(pr(!!t),"string"!=typeof t)return{seconds:Qr(t.seconds),nanos:Qr(t.nanos)};{let e=0;var n=Gr.exec(t);pr(!!n),n[1]&&(n=(n[1]+"000000000").substr(0,9),e=Number(n));const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}}function Qr(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function zr(e){return"string"==typeof e?Kr.fromBase64String(e):Kr.fromUint8Array(e)}function Hr(e){return"server_timestamp"===(null===(e=((null===(e=null==e?void 0:e.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===e?void 0:e.stringValue)}function Wr(e){e=$r(e.mapValue.fields.__local_write_time__.timestampValue);return new Rr(e.seconds,e.nanos)}class Yr{constructor(e,t,n,r,s,i,o,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class Xr{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Xr("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Xr&&e.projectId===this.projectId&&e.database===this.database}}function Jr(e){return null==e}function Zr(e){return 0===e&&1/e==-1/0}function es(e){return"number"==typeof e&&Number.isInteger(e)&&!Zr(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}class ts{constructor(e){this.path=e}static fromPath(e){return new ts(Ur.fromString(e))}static fromName(e){return new ts(Ur.fromString(e).popFirst(5))}static empty(){return new ts(Ur.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return 2<=this.path.length&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Ur.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Ur.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ts(new Ur(e.slice()))}}const ns={mapValue:{fields:{__type__:{stringValue:"__max___"}}}};function rs(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Hr(e)?4:10:mr()}function ss(n,r){if(n===r)return!0;var e,t,s=rs(n);if(s!==rs(r))return!1;switch(s){case 0:return!0;case 1:return n.booleanValue===r.booleanValue;case 4:return Wr(n).isEqual(Wr(r));case 3:return function(e){if("string"==typeof n.timestampValue&&"string"==typeof e.timestampValue&&n.timestampValue.length===e.timestampValue.length)return n.timestampValue===e.timestampValue;var t=$r(n.timestampValue),e=$r(e.timestampValue);return t.seconds===e.seconds&&t.nanos===e.nanos}(r);case 5:return n.stringValue===r.stringValue;case 6:return t=r,zr(n.bytesValue).isEqual(zr(t.bytesValue));case 7:return n.referenceValue===r.referenceValue;case 8:return e=r,Qr((t=n).geoPointValue.latitude)===Qr(e.geoPointValue.latitude)&&Qr(t.geoPointValue.longitude)===Qr(e.geoPointValue.longitude);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Qr(e.integerValue)===Qr(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){e=Qr(e.doubleValue),t=Qr(t.doubleValue);return e===t?Zr(e)===Zr(t):isNaN(e)&&isNaN(t)}return!1}(n,r);case 9:return kr(n.arrayValue.values||[],r.arrayValue.values||[],ss);case 10:return function(e){const t=e.mapValue.fields||{},n=r.mapValue.fields||{};if(Mr(t)!==Mr(n))return!1;for(const e in t)if(t.hasOwnProperty(e)&&(void 0===n[e]||!ss(t[e],n[e])))return!1;return!0}(n);default:return mr()}}function is(e,t){return void 0!==(e.values||[]).find(e=>ss(e,t))}function os(e,t){if(e===t)return 0;var n,r,s,i=rs(e),o=rs(t);if(i!==o)return Dr(i,o);switch(i){case 0:return 0;case 1:return Dr(e.booleanValue,t.booleanValue);case 2:return n=t,(r=Qr(e.integerValue||e.doubleValue))<(s=Qr(n.integerValue||n.doubleValue))?-1:s<r?1:r===s?0:isNaN(r)?isNaN(s)?0:-1:1;case 3:return as(e.timestampValue,t.timestampValue);case 4:return as(Wr(e),Wr(t));case 5:return Dr(e.stringValue,t.stringValue);case 6:return function(e,t){const n=zr(e),r=zr(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){var n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=Dr(n[e],r[e]);if(0!==t)return t}return Dr(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return r=e.geoPointValue,n=t.geoPointValue,0!==(s=Dr(Qr(r.latitude),Qr(n.latitude)))?s:Dr(Qr(r.longitude),Qr(n.longitude));case 9:return function(e,t){var n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=os(n[e],r[e]);if(t)return t}return Dr(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){const n=e.fields||{},r=Object.keys(n),s=t.fields||{},i=Object.keys(s);r.sort(),i.sort();for(let e=0;e<r.length&&e<i.length;++e){const t=Dr(r[e],i[e]);if(0!==t)return t;var o=os(n[r[e]],s[i[e]]);if(0!==o)return o}return Dr(r.length,i.length)}(e.mapValue,t.mapValue);default:throw mr()}}function as(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Dr(e,t);var n=$r(e),e=$r(t),t=Dr(n.seconds,e.seconds);return 0!==t?t:Dr(n.nanos,e.nanos)}function hs(e){return function s(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?`time(${(e=$r(r.timestampValue)).seconds},${e.nanos})`:"stringValue"in r?r.stringValue:"bytesValue"in r?zr(r.bytesValue).toBase64():"referenceValue"in r?(t=r.referenceValue,ts.fromName(t).toString()):"geoPointValue"in r?`geo(${(t=r.geoPointValue).latitude},${t.longitude})`:"arrayValue"in r?function(){let e="[",t=!0;for(const n of r.arrayValue.values||[])t?t=!1:e+=",",e+=s(n);return e+"]"}():"mapValue"in r?function(e){let t="{",n=!0;for(const r of Object.keys(e.fields||{}).sort())n?n=!1:t+=",",t+=`${r}:${s(e.fields[r])}`;return t+"}"}(r.mapValue):mr();var e,t}(e)}function us(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function cs(e){return e&&"integerValue"in e}function ls(e){return!!e&&"arrayValue"in e}function ds(e){return e&&"nullValue"in e}function fs(e){return e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function gs(e){return e&&"mapValue"in e}function ms(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const n={mapValue:{fields:{}}};return Pr(t.mapValue.fields,(e,t)=>n.mapValue.fields[e]=ms(t)),n}if(t.arrayValue){const r={arrayValue:{values:[]}};for(let e=0;e<(t.arrayValue.values||[]).length;++e)r.arrayValue.values[e]=ms(t.arrayValue.values[e]);return r}return Object.assign({},t)}class ps{constructor(e){this.value=e}static empty(){return new ps({mapValue:{}})}field(n){if(n.isEmpty())return this.value;{let t=this.value;for(let e=0;e<n.length-1;++e)if(t=(t.mapValue.fields||{})[n.get(e)],!gs(t))return null;return t=(t.mapValue.fields||{})[n.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ms(t)}setAll(e){let n=Br.emptyPath(),r={},s=[];e.forEach((e,t)=>{if(!n.isImmediateParentOf(t)){const e=this.getFieldsMap(n);this.applyChanges(e,r,s),r={},s=[],n=t.popLast()}e?r[t.lastSegment()]=ms(e):s.push(t.lastSegment())});e=this.getFieldsMap(n);this.applyChanges(e,r,s)}delete(e){const t=this.field(e.popLast());gs(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ss(this.value,e.value)}getFieldsMap(n){let r=this.value;r.mapValue.fields||(r.mapValue={fields:{}});for(let t=0;t<n.length;++t){let e=r.mapValue.fields[n.get(t)];gs(e)&&e.mapValue.fields||(e={mapValue:{fields:{}}},r.mapValue.fields[n.get(t)]=e),r=e}return r.mapValue.fields}applyChanges(n,e,t){Pr(e,(e,t)=>n[e]=t);for(const e of t)delete n[e]}clone(){return new ps(ms(this.value))}}class ys{constructor(e,t,n,r,s,i){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.data=s,this.documentState=i}static newInvalidDocument(e){return new ys(e,0,Lr.min(),Lr.min(),ps.empty(),0)}static newFoundDocument(e,t,n){return new ys(e,1,t,Lr.min(),n,0)}static newNoDocument(e,t){return new ys(e,2,t,Lr.min(),ps.empty(),0)}static newUnknownDocument(e,t){return new ys(e,3,t,Lr.min(),ps.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=ps.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=ps.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof ys&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ys(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class ws{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}ws.UNKNOWN_ID=-1;class vs{constructor(e,t){this.fieldPath=e,this.kind=t}}class Is{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Is(0,bs.min())}}class bs{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new bs(Lr.min(),ts.empty(),-1)}}class Ts{constructor(e,t=null,n=[],r=[],s=null,i=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=o,this.P=null}}function Es(e,t=null,n=[],r=[],s=null,i=null,o=null){return new Ts(e,t,n,r,s,i,o)}function Ss(e){const t=e;if(null===t.P){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>{return(e=e).field.canonicalString()+e.op.toString()+hs(e.value)}).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),Jr(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>hs(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>hs(e)).join(",")),t.P=e}return t.P}function _s(t,n){if(t.limit!==n.limit)return!1;if(t.orderBy.length!==n.orderBy.length)return!1;for(let e=0;e<t.orderBy.length;e++)if(r=t.orderBy[e],s=n.orderBy[e],r.dir!==s.dir||!r.field.isEqual(s.field))return!1;var r,s,i,o;if(t.filters.length!==n.filters.length)return!1;for(let e=0;e<t.filters.length;e++)if(i=t.filters[e],o=n.filters[e],i.op!==o.op||!i.field.isEqual(o.field)||!ss(i.value,o.value))return!1;return t.collectionGroup===n.collectionGroup&&!!t.path.isEqual(n.path)&&!!Us(t.startAt,n.startAt)&&Us(t.endAt,n.endAt)}function As(e){return ts.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class xs extends class{}{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.v(e,t,n):new Ns(e,t,n):"array-contains"===t?new Os(e,n):"in"===t?new Rs(e,n):"not-in"===t?new Ls(e,n):"array-contains-any"===t?new Ms(e,n):new xs(e,t,n)}static v(e,t,n){return new("in"===t?Cs:Ds)(e,n)}matches(e){e=e.data.field(this.field);return"!="===this.op?null!==e&&this.V(os(e,this.value)):null!==e&&rs(this.value)===rs(e)&&this.V(os(e,this.value))}V(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return 0<e;case">=":return 0<=e;default:return mr()}}S(){return 0<=["<","<=",">",">=","!=","not-in"].indexOf(this.op)}}class Ns extends xs{constructor(e,t,n){super(e,t,n),this.key=ts.fromName(n.referenceValue)}matches(e){e=ts.comparator(e.key,this.key);return this.V(e)}}class Cs extends xs{constructor(e,t){super(e,"in",t),this.keys=ks(0,t)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class Ds extends xs{constructor(e,t){super(e,"not-in",t),this.keys=ks(0,t)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function ks(e,t){return((null===(t=t.arrayValue)||void 0===t?void 0:t.values)||[]).map(e=>ts.fromName(e.referenceValue))}class Os extends xs{constructor(e,t){super(e,"array-contains",t)}matches(e){e=e.data.field(this.field);return ls(e)&&is(e.arrayValue,this.value)}}class Rs extends xs{constructor(e,t){super(e,"in",t)}matches(e){e=e.data.field(this.field);return null!==e&&is(this.value.arrayValue,e)}}class Ls extends xs{constructor(e,t){super(e,"not-in",t)}matches(e){if(is(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;e=e.data.field(this.field);return null!==e&&!is(this.value.arrayValue,e)}}class Ms extends xs{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!ls(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>is(this.value.arrayValue,e))}}class Ps{constructor(e,t){this.position=e,this.inclusive=t}}class Fs{constructor(e,t="asc"){this.field=e,this.dir=t}}function Vs(t,n,r){let s=0;for(let e=0;e<t.position.length;e++){const i=n[e],o=t.position[e];if(s=i.field.isKeyField()?ts.comparator(ts.fromName(o.referenceValue),r.key):os(o,r.data.field(i.field)),"desc"===i.dir&&(s*=-1),0!==s)break}return s}function Us(t,n){if(null===t)return null===n;if(null===n)return!1;if(t.inclusive!==n.inclusive||t.position.length!==n.position.length)return!1;for(let e=0;e<t.position.length;e++)if(!ss(t.position[e],n.position[e]))return!1;return!0}class qs{constructor(e,t=null,n=[],r=[],s=null,i="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=i,this.startAt=o,this.endAt=a,this.D=null,this.C=null,this.startAt,this.endAt}}function Bs(e,t,n,r,s,i,o,a){return new qs(e,t,n,r,s,i,o,a)}function js(e){return new qs(e)}function Ks(e){return!Jr(e.limit)&&"F"===e.limitType}function Gs(e){return!Jr(e.limit)&&"L"===e.limitType}function $s(e){return 0<e.explicitOrderBy.length?e.explicitOrderBy[0].field:null}function Qs(e){for(const t of e.filters)if(t.S())return t.field;return null}function zs(e){return null!==e.collectionGroup}function Hs(t){const n=t;if(null===n.D){n.D=[];const t=Qs(n),e=$s(n);if(null!==t&&null===e)t.isKeyField()||n.D.push(new Fs(t)),n.D.push(new Fs(Br.keyField(),"asc"));else{let e=!1;for(const r of n.explicitOrderBy)n.D.push(r),r.field.isKeyField()&&(e=!0);if(!e){const t=0<n.explicitOrderBy.length?n.explicitOrderBy[n.explicitOrderBy.length-1].dir:"asc";n.D.push(new Fs(Br.keyField(),t))}}}return n.D}function Ws(e){const t=e;if(!t.C)if("F"===t.limitType)t.C=Es(t.path,t.collectionGroup,Hs(t),t.filters,t.limit,t.startAt,t.endAt);else{const r=[];for(const s of Hs(t)){const t="desc"===s.dir?"asc":"desc";r.push(new Fs(s.field,t))}var n=t.endAt?new Ps(t.endAt.position,!t.endAt.inclusive):null,e=t.startAt?new Ps(t.startAt.position,!t.startAt.inclusive):null;t.C=Es(t.path,t.collectionGroup,r,t.filters,t.limit,n,e)}return t.C}function Ys(e,t,n){return new qs(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Xs(e,t){return _s(Ws(e),Ws(t))&&e.limitType===t.limitType}function Js(e){return`${Ss(Ws(e))}|lt:${e.limitType}`}function Zs(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(t+=`, filters: [${e.filters.map(e=>{return`${(e=e).field.canonicalString()} ${e.op} ${hs(e.value)}`}).join(", ")}]`),Jr(e.limit)||(t+=", limit: "+e.limit),0<e.orderBy.length&&(t+=`, orderBy: [${e.orderBy.map(e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e)).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>hs(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>hs(e)).join(",")),`Target(${t})`}(Ws(e))}; limitType=${e.limitType})`}function ei(n,e){return e.isFoundDocument()&&(o=(i=e).key.path,null!==(s=n).collectionGroup?i.key.hasCollectionId(s.collectionGroup)&&s.path.isPrefixOf(o):ts.isDocumentKey(s.path)?s.path.isEqual(o):s.path.isImmediateParentOf(o))&&function(e){for(const t of n.explicitOrderBy)if(!t.field.isKeyField()&&null===e.data.field(t.field))return;return 1}(e)&&function(e){for(const t of n.filters)if(!t.matches(e))return;return 1}(e)&&(s=e,(!(e=n).startAt||(r=Vs(t=e.startAt,Hs(e),s),t.inclusive?r<=0:r<0))&&(!e.endAt||(r=Vs(t=e.endAt,Hs(e),s),t.inclusive?0<=r:0<r)));var t,r,s,i,o}function ti(s){return(e,t)=>{let n=!1;for(const r of Hs(s)){const s=function(e,t,n){var r,s=e.field.isKeyField()?ts.comparator(t.key,n.key):(r=e.field,n=n,t=t.data.field(r),r=n.data.field(r),null!==t&&null!==r?os(t,r):mr());switch(e.dir){case"asc":return s;case"desc":return-1*s;default:return mr()}}(r,e,t);if(0!==s)return s;n=n||r.field.isKeyField()}return 0}}function ni(e,t){if(e.N){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Zr(t)?"-0":t}}function ri(e){return{integerValue:""+e}}function si(e,t){return es(t)?ri(t):ni(e,t)}class ii{constructor(){this._=void 0}}function oi(e,t){return e instanceof di?cs(e=t)||e&&"doubleValue"in e?t:{integerValue:0}:null}class ai extends ii{}class hi extends ii{constructor(e){super(),this.elements=e}}function ui(e,t){const n=gi(t);for(const t of e.elements)n.some(e=>ss(e,t))||n.push(t);return{arrayValue:{values:n}}}class ci extends ii{constructor(e){super(),this.elements=e}}function li(e,t){let n=gi(t);for(const t of e.elements)n=n.filter(e=>!ss(e,t));return{arrayValue:{values:n}}}class di extends ii{constructor(e,t){super(),this.O=e,this.k=t}}function fi(e){return Qr(e.integerValue||e.doubleValue)}function gi(e){return ls(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class mi{constructor(e,t){this.field=e,this.transform=t}}class pi{constructor(e,t){this.version=e,this.transformResults=t}}class yi{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new yi}static exists(e){return new yi(void 0,e)}static updateTime(e){return new yi(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function wi(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class vi{}function Ii(e,t,n){e instanceof Si?function(e,t,n){const r=e.value.clone(),s=xi(e.fieldTransforms,t,n.transformResults);r.setAll(s),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof _i?function(e,t,n){if(!wi(e.precondition,t))return t.convertToUnknownDocument(n.version);const r=xi(e.fieldTransforms,t,n.transformResults),s=t.data;s.setAll(Ai(e)),s.setAll(r),t.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}function bi(e,t,n){e instanceof Si?function(e,t,n){if(wi(e.precondition,t)){const r=e.value.clone(),s=Ni(e.fieldTransforms,n,t);r.setAll(s),t.convertToFoundDocument(Ei(t),r).setHasLocalMutations()}}(e,t,n):e instanceof _i?function(e,t,n){if(wi(e.precondition,t)){const r=Ni(e.fieldTransforms,n,t),s=t.data;s.setAll(Ai(e)),s.setAll(r),t.convertToFoundDocument(Ei(t),s).setHasLocalMutations()}}(e,t,n):wi(e.precondition,t)&&t.convertToNoDocument(Lr.min())}function Ti(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||n&&r&&kr(n,r,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&(e=e.transform,t=t.transform,e instanceof hi&&t instanceof hi||e instanceof ci&&t instanceof ci?kr(e.elements,t.elements,ss):e instanceof di&&t instanceof di?ss(e.k,t.k):e instanceof ai&&t instanceof ai)}(e,t)))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask)));var n,r}function Ei(e){return e.isFoundDocument()?e.version:Lr.min()}class Si extends vi{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}}class _i extends vi{constructor(e,t,n,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}}function Ai(n){const r=new Map;return n.fieldMask.fields.forEach(e=>{var t;e.isEmpty()||(t=n.data.field(e),r.set(e,t))}),r}function xi(t,n,r){const s=new Map;pr(t.length===r.length);for(let e=0;e<r.length;e++){var i=t[e],o=i.transform,a=n.data.field(i.field);s.set(i.field,(i=o,o=a,a=r[e],i instanceof hi?ui(i,o):i instanceof ci?li(i,o):a))}return s}function Ni(e,t,n){const r=new Map;for(const u of e){const e=u.transform,c=n.data.field(u.field);r.set(u.field,(s=e,i=c,o=t,0,s instanceof ai?function(){const e={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:o.seconds,nanos:o.nanoseconds}}}};return i&&(e.fields.__previous_value__=i),{mapValue:e}}():s instanceof hi?ui(s,i):s instanceof ci?li(s,i):(h=fi(a=oi(s,i))+fi(s.k),cs(a)&&cs(s.k)?ri(h):ni(s.O,h))))}var s,i,o,a,h;return r}class Ci extends vi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}}class Di extends vi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}}class ki{constructor(e){this.count=e}}function Oi(e){switch(e){default:return mr(),0;case yr.CANCELLED:case yr.UNKNOWN:case yr.DEADLINE_EXCEEDED:case yr.RESOURCE_EXHAUSTED:case yr.INTERNAL:case yr.UNAVAILABLE:case yr.UNAUTHENTICATED:return;case yr.INVALID_ARGUMENT:case yr.NOT_FOUND:case yr.ALREADY_EXISTS:case yr.PERMISSION_DENIED:case yr.FAILED_PRECONDITION:case yr.ABORTED:case yr.OUT_OF_RANGE:case yr.UNIMPLEMENTED:case yr.DATA_LOSS:return 1}}function Ri(e){if(void 0===e)return dr("GRPC error has no .code"),yr.UNKNOWN;switch(e){case Jn.OK:return yr.OK;case Jn.CANCELLED:return yr.CANCELLED;case Jn.UNKNOWN:return yr.UNKNOWN;case Jn.DEADLINE_EXCEEDED:return yr.DEADLINE_EXCEEDED;case Jn.RESOURCE_EXHAUSTED:return yr.RESOURCE_EXHAUSTED;case Jn.INTERNAL:return yr.INTERNAL;case Jn.UNAVAILABLE:return yr.UNAVAILABLE;case Jn.UNAUTHENTICATED:return yr.UNAUTHENTICATED;case Jn.INVALID_ARGUMENT:return yr.INVALID_ARGUMENT;case Jn.NOT_FOUND:return yr.NOT_FOUND;case Jn.ALREADY_EXISTS:return yr.ALREADY_EXISTS;case Jn.PERMISSION_DENIED:return yr.PERMISSION_DENIED;case Jn.FAILED_PRECONDITION:return yr.FAILED_PRECONDITION;case Jn.ABORTED:return yr.ABORTED;case Jn.OUT_OF_RANGE:return yr.OUT_OF_RANGE;case Jn.UNIMPLEMENTED:return yr.UNIMPLEMENTED;case Jn.DATA_LOSS:return yr.DATA_LOSS;default:return mr()}}(V=Jn={})[V.OK=0]="OK",V[V.CANCELLED=1]="CANCELLED",V[V.UNKNOWN=2]="UNKNOWN",V[V.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",V[V.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",V[V.NOT_FOUND=5]="NOT_FOUND",V[V.ALREADY_EXISTS=6]="ALREADY_EXISTS",V[V.PERMISSION_DENIED=7]="PERMISSION_DENIED",V[V.UNAUTHENTICATED=16]="UNAUTHENTICATED",V[V.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",V[V.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",V[V.ABORTED=10]="ABORTED",V[V.OUT_OF_RANGE=11]="OUT_OF_RANGE",V[V.UNIMPLEMENTED=12]="UNIMPLEMENTED",V[V.INTERNAL=13]="INTERNAL",V[V.UNAVAILABLE=14]="UNAVAILABLE",V[V.DATA_LOSS=15]="DATA_LOSS";class Li{constructor(e,t){this.comparator=e,this.root=t||Pi.EMPTY}insert(e,t){return new Li(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Pi.BLACK,null,null))}remove(e){return new Li(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Pi.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:0<n&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;n=r<0?n.left:(t+=n.left.size+1,n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(n){this.inorderTraversal((e,t)=>(n(e,t),!1))}toString(){const n=[];return this.inorderTraversal((e,t)=>(n.push(`${e}:${t}`),!1)),`{${n.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Mi(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Mi(this.root,e,this.comparator,!1)}getReverseIterator(){return new Mi(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Mi(this.root,e,this.comparator,!0)}}class Mi{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();var t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return 0<this.nodeStack.length}peek(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Pi{constructor(e,t,n,r,s){this.key=e,this.value=t,this.color=null!=n?n:Pi.RED,this.left=null!=r?r:Pi.EMPTY,this.right=null!=s?s:Pi.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,s){return new Pi(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;var s=n(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===s?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Pi.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return Pi.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){var e=this.copy(null,null,Pi.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){var e=this.copy(null,null,Pi.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){var e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw mr();if(this.right.isRed())throw mr();var e=this.left.check();if(e!==this.right.check())throw mr();return e+(this.isRed()?0:1)}}Pi.EMPTY=null,Pi.RED=!0,Pi.BLACK=!1,Pi.EMPTY=new class{constructor(){this.size=0}get key(){throw mr()}get value(){throw mr()}get color(){throw mr()}get left(){throw mr()}get right(){throw mr()}copy(e,t,n,r,s){return this}insert(e,t,n){return new Pi(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Fi{constructor(e){this.comparator=e,this.data=new Li(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(n){this.data.inorderTraversal((e,t)=>(n(e),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){var r=n.getNext();if(0<=this.comparator(r.key,e[1]))return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Vi(this.data.getIterator())}getIteratorFrom(e){return new Vi(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof Fi))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(e){const t=new Fi(this.comparator);return t.data=e,t}}class Vi{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Ui(e){return e.hasNext()?e.getNext():void 0}const qi=new Li(ts.comparator),Bi=new Li(ts.comparator),ji=new Li(ts.comparator),Ki=new Fi(ts.comparator);function Gi(...e){let t=Ki;for(const n of e)t=t.add(n);return t}const $i=new Fi(Dr);class Qi{constructor(e,t,n,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t){const n=new Map;return n.set(e,zi.createSynthesizedTargetChangeForCurrentChange(e,t)),new Qi(Lr.min(),n,$i,qi,Gi())}}class zi{constructor(e,t,n,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t){return new zi(Kr.EMPTY_BYTE_STRING,t,Gi(),Gi(),Gi())}}class Hi{constructor(e,t,n,r){this.M=e,this.removedTargetIds=t,this.key=n,this.$=r}}class Wi{constructor(e,t){this.targetId=e,this.F=t}}class Yi{constructor(e,t,n=Kr.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class Xi{constructor(){this.B=0,this.L=eo(),this.U=Kr.EMPTY_BYTE_STRING,this.q=!1,this.K=!0}get current(){return this.q}get resumeToken(){return this.U}get G(){return 0!==this.B}get j(){return this.K}W(e){0<e.approximateByteSize()&&(this.K=!0,this.U=e)}H(){let n=Gi(),r=Gi(),s=Gi();return this.L.forEach((e,t)=>{switch(t){case 0:n=n.add(e);break;case 2:r=r.add(e);break;case 1:s=s.add(e);break;default:mr()}}),new zi(this.U,this.q,n,r,s)}J(){this.K=!1,this.L=eo()}Y(e,t){this.K=!0,this.L=this.L.insert(e,t)}X(e){this.K=!0,this.L=this.L.remove(e)}Z(){this.B+=1}tt(){--this.B}et(){this.K=!0,this.q=!0}}class Ji{constructor(e){this.nt=e,this.st=new Map,this.it=qi,this.rt=Zi(),this.ot=new Fi(Dr)}ct(e){for(const t of e.M)e.$&&e.$.isFoundDocument()?this.ut(t,e.$):this.at(t,e.key,e.$);for(const n of e.removedTargetIds)this.at(n,e.key,e.$)}ht(n){this.forEachTarget(n,e=>{const t=this.lt(e);switch(n.state){case 0:this.ft(e)&&t.W(n.resumeToken);break;case 1:t.tt(),t.G||t.J(),t.W(n.resumeToken);break;case 2:t.tt(),t.G||this.removeTarget(e);break;case 3:this.ft(e)&&(t.et(),t.W(n.resumeToken));break;case 4:this.ft(e)&&(this.dt(e),t.W(n.resumeToken));break;default:mr()}})}forEachTarget(e,n){0<e.targetIds.length?e.targetIds.forEach(n):this.st.forEach((e,t)=>{this.ft(t)&&n(t)})}_t(e){const t=e.targetId,n=e.F.count,r=this.wt(t);if(r){const e=r.target;if(As(e))if(0===n){const n=new ts(e.path);this.at(t,n,ys.newNoDocument(n,Lr.min()))}else pr(1===n);else this.gt(t)!==n&&(this.dt(t),this.ot=this.ot.add(t))}}yt(r){const s=new Map;this.st.forEach((e,t)=>{var n=this.wt(t);if(n){if(e.current&&As(n.target)){const s=new ts(n.target.path);null!==this.it.get(s)||this.It(t,s)||this.at(t,s,ys.newNoDocument(s,r))}e.j&&(s.set(t,e.H()),e.J())}});let i=Gi();this.rt.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{e=this.wt(e);return!e||2===e.purpose||(n=!1)}),n&&(i=i.add(e))}),this.it.forEach((e,t)=>t.setReadTime(r));var e=new Qi(r,s,this.ot,this.it,i);return this.it=qi,this.rt=Zi(),this.ot=new Fi(Dr),e}ut(e,t){var n;this.ft(e)&&(n=this.It(e,t.key)?2:0,this.lt(e).Y(t.key,n),this.it=this.it.insert(t.key,t),this.rt=this.rt.insert(t.key,this.Et(t.key).add(e)))}at(e,t,n){if(this.ft(e)){const r=this.lt(e);this.It(e,t)?r.Y(t,1):r.X(t),this.rt=this.rt.insert(t,this.Et(t).delete(e)),n&&(this.it=this.it.insert(t,n))}}removeTarget(e){this.st.delete(e)}gt(e){var t=this.lt(e).H();return this.nt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Z(e){this.lt(e).Z()}lt(e){let t=this.st.get(e);return t||(t=new Xi,this.st.set(e,t)),t}Et(e){let t=this.rt.get(e);return t||(t=new Fi(Dr),this.rt=this.rt.insert(e,t)),t}ft(e){var t=null!==this.wt(e);return t||lr("WatchChangeAggregator","Detected inactive target",e),t}wt(e){var t=this.st.get(e);return t&&t.G?null:this.nt.Tt(e)}dt(t){this.st.set(t,new Xi),this.nt.getRemoteKeysForTarget(t).forEach(e=>{this.at(t,e,null)})}It(e,t){return this.nt.getRemoteKeysForTarget(e).has(t)}}function Zi(){return new Li(ts.comparator)}function eo(){return new Li(ts.comparator)}const to={asc:"ASCENDING",desc:"DESCENDING"},no={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class ro{constructor(e,t){this.databaseId=e,this.N=t}}function so(e,t){return e.N?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function io(e,t){return e.N?t.toBase64():t.toUint8Array()}function oo(e){return pr(!!e),Lr.fromTimestamp((e=$r(e),new Rr(e.seconds,e.nanos)))}function ao(e,t){return new Ur(["projects",e.projectId,"databases",e.database]).child("documents").child(t).canonicalString()}function ho(e){e=Ur.fromString(e);return pr(_o(e)),e}function uo(e,t){return ao(e.databaseId,t.path)}function co(e,t){const n=ho(t);if(n.get(1)!==e.databaseId.projectId)throw new wr(yr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new wr(yr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new ts(mo(n))}function lo(e,t){return ao(e.databaseId,t)}function fo(e){e=ho(e);return 4===e.length?Ur.emptyPath():mo(e)}function go(e){return new Ur(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function mo(e){return pr(4<e.length&&"documents"===e.get(4)),e.popFirst(5)}function po(e,t,n){return{name:uo(e,t),fields:n.value.mapValue.fields}}function yo(e,t,n){const r=co(e,t.name),s=oo(t.updateTime),i=new ps({mapValue:{fields:t.fields}}),o=ys.newFoundDocument(r,s,i);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function wo(e,t){let n;if(t instanceof Si)n={update:po(e,t.key,t.value)};else if(t instanceof Ci)n={delete:uo(e,t.key)};else if(t instanceof _i)n={update:po(e,t.key,t.data),updateMask:function(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof Di))return mr();n={verify:uo(e,t.key)}}return 0<t.fieldTransforms.length&&(n.updateTransforms=t.fieldTransforms.map(e=>function(e){var t=e.transform;if(t instanceof ai)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof hi)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof ci)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof di)return{fieldPath:e.field.canonicalString(),increment:t.k};throw mr()}(e))),t.precondition.isNone||(n.currentDocument=void 0!==(r=t.precondition).updateTime?{updateTime:so(e,(t=r.updateTime).toTimestamp())}:void 0!==r.exists?{exists:r.exists}:mr()),n;var r}function vo(t,n){const e=n.currentDocument?void 0!==(i=n.currentDocument).updateTime?yi.updateTime(oo(i.updateTime)):void 0!==i.exists?yi.exists(i.exists):yi.none():yi.none(),r=n.updateTransforms?n.updateTransforms.map(e=>function(e,t){let n=null;if("setToServerValue"in t)pr("REQUEST_TIME"===t.setToServerValue),n=new ai;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new hi(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new ci(e)}else"increment"in t?n=new di(e,t.increment):mr();t=Br.fromServerFormat(t.fieldPath);return new mi(t,n)}(t,e)):[];if(n.update){n.update.name;var s=co(t,n.update.name),i=new ps({mapValue:{fields:n.update.fields}});if(n.updateMask){const t=function(){const e=n.updateMask.fieldPaths||[];return new jr(e.map(e=>Br.fromServerFormat(e)))}();return new _i(s,i,t,e,r)}return new Si(s,i,e,r)}if(n.delete){const r=co(t,n.delete);return new Ci(r,e)}if(n.verify){const r=co(t,n.verify);return new Di(r,e)}return mr()}function Io(e,t){return{documents:[lo(e,t.path)]}}function bo(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=lo(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=lo(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var s,i=function(e){if(0!==e.length){e=e.map(e=>function(e){if("=="===e.op){if(fs(e.value))return{unaryFilter:{field:Eo(e.field),op:"IS_NAN"}};if(ds(e.value))return{unaryFilter:{field:Eo(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(fs(e.value))return{unaryFilter:{field:Eo(e.field),op:"IS_NOT_NAN"}};if(ds(e.value))return{unaryFilter:{field:Eo(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Eo(e.field),op:(t=e.op,no[t]),value:e.value}};var t}(e));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(t.filters);return i&&(n.structuredQuery.where=i),(i=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:Eo(e.field),direction:(e=e.dir,to[e])}}(e))}(t.orderBy))&&(n.structuredQuery.orderBy=i),null!==(i=(s=t.limit,e.N||Jr(s)?s:{value:s}))&&(n.structuredQuery.limit=i),t.startAt&&(n.structuredQuery.startAt={before:(i=t.startAt).inclusive,values:i.position}),t.endAt&&(n.structuredQuery.endAt={before:!(t=t.endAt).inclusive,values:t.position}),n}function To(e){let t=fo(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let s=null;var i,o,a,h;0<r&&(pr(1===r),(i=n.from[0]).allDescendants?s=i.collectionId:t=t.child(i.collectionId));let u=[];n.where&&(u=function t(e){return e?void 0!==e.unaryFilter?[function(e){switch(e.unaryFilter.op){case"IS_NAN":var t=So(e.unaryFilter.field);return xs.create(t,"==",{doubleValue:NaN});case"IS_NULL":return t=So(e.unaryFilter.field),xs.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var n=So(e.unaryFilter.field);return xs.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":return n=So(e.unaryFilter.field),xs.create(n,"!=",{nullValue:"NULL_VALUE"});default:return mr()}}(e)]:void 0!==e.fieldFilter?[(n=e,xs.create(So(n.fieldFilter.field),function(){switch(n.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return mr()}}(),n.fieldFilter.value))]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(e=>t(e)).reduce((e,t)=>e.concat(t)):mr():[];var n}(n.where));let c=[];n.orderBy&&(c=n.orderBy.map(e=>function(e){return new Fs(So(e.field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}())}(e)));let l=null;n.limit&&(l=Jr(e="object"==typeof(e=n.limit)?e.value:e)?null:e);let d=null;n.startAt&&(d=(h=!!(o=n.startAt).before,a=o.values||[],new Ps(a,h)));let f=null;return n.endAt&&(f=(a=!(o=n.endAt).before,h=o.values||[],new Ps(h,a))),Bs(t,s,c,u,l,"F",d,f)}function Eo(e){return{fieldPath:e.canonicalString()}}function So(e){return Br.fromServerFormat(e.fieldPath)}function _o(e){return 4<=e.length&&"projects"===e.get(0)&&"databases"===e.get(2)}function Ao(t){let s="";for(let e=0;e<t.length;e++)0<s.length&&(s=xo(s)),s=function(t){let n=s;const r=t.length;for(let e=0;e<r;e++){const r=t.charAt(e);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}(t.get(e));return xo(s)}function xo(e){return e+""}function No(n){const r=n.length;if(pr(2<=r),2===r)return pr(""===n.charAt(0)&&""===n.charAt(1)),Ur.emptyPath();r;const s=[];let i="";for(let t=0;t<r;){const r=n.indexOf("",t);switch((r<0||r>o)&&mr(),n.charAt(r+1)){case"":const o=n.substring(t,r);let e;0===i.length?e=o:(i+=o,e=i,i=""),s.push(e);break;case"":i+=n.substring(t,r),i+="\0";break;case"":i+=n.substring(t,r+1);break;default:mr()}t=r+2}return new Ur(s)}class Co{constructor(e,t){this.seconds=e,this.nanoseconds=t}}class Do{constructor(e,t,n){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=n}}Do.store="owner",Do.key="owner";class ko{constructor(e,t,n){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=n}}ko.store="mutationQueues",ko.keyPath="userId";class Oo{constructor(e,t,n,r,s){this.userId=e,this.batchId=t,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=s}}Oo.store="mutations",Oo.keyPath="batchId",Oo.userMutationsIndex="userMutationsIndex",Oo.userMutationsKeyPath=["userId","batchId"];class Ro{constructor(){}static prefixForUser(e){return[e]}static prefixForPath(e,t){return[e,Ao(t)]}static key(e,t,n){return[e,Ao(t),n]}}Ro.store="documentMutations",Ro.PLACEHOLDER=new Ro;class Lo{constructor(e,t){this.path=e,this.readTime=t}}class Mo{constructor(e,t){this.path=e,this.version=t}}class Po{constructor(e,t,n,r,s,i){this.unknownDocument=e,this.noDocument=t,this.document=n,this.hasCommittedMutations=r,this.readTime=s,this.parentPath=i}}Po.store="remoteDocuments",Po.readTimeIndex="readTimeIndex",Po.readTimeIndexPath="readTime",Po.collectionReadTimeIndex="collectionReadTimeIndex",Po.collectionReadTimeIndexPath=["parentPath","readTime"];class Fo{constructor(e){this.byteSize=e}}Fo.store="remoteDocumentGlobal",Fo.key="remoteDocumentGlobalKey";class Vo{constructor(e,t,n,r,s,i,o){this.targetId=e,this.canonicalId=t,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=s,this.lastLimboFreeSnapshotVersion=i,this.query=o}}Vo.store="targets",Vo.keyPath="targetId",Vo.queryTargetsIndexName="queryTargetsIndex",Vo.queryTargetsKeyPath=["canonicalId","targetId"];class Uo{constructor(e,t,n){this.targetId=e,this.path=t,this.sequenceNumber=n}}Uo.store="targetDocuments",Uo.keyPath=["targetId","path"],Uo.documentTargetsIndex="documentTargetsIndex",Uo.documentTargetsKeyPath=["path","targetId"];class qo{constructor(e,t,n,r){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=n,this.targetCount=r}}qo.key="targetGlobalKey",qo.store="targetGlobal";class Bo{constructor(e,t){this.collectionId=e,this.parent=t}}Bo.store="collectionParents",Bo.keyPath=["collectionId","parent"];class jo{constructor(e,t,n,r){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=n,this.inForeground=r}}jo.store="clientMetadata",jo.keyPath="clientId";class Ko{constructor(e,t,n){this.bundleId=e,this.createTime=t,this.version=n}}Ko.store="bundles",Ko.keyPath="bundleId";class Go{constructor(e,t,n){this.name=e,this.readTime=t,this.bundledQuery=n}}Go.store="namedQueries",Go.keyPath="name";class $o{constructor(e,t,n){this.indexId=e,this.collectionGroup=t,this.fields=n}}$o.store="indexConfiguration",$o.keyPath="indexId",$o.collectionGroupIndex="collectionGroupIndex",$o.collectionGroupIndexPath="collectionGroup";class Qo{constructor(e,t,n,r,s,i){this.indexId=e,this.uid=t,this.sequenceNumber=n,this.readTime=r,this.documentKey=s,this.largestBatchId=i}}Qo.store="indexState",Qo.keyPath=["indexId","uid"],Qo.sequenceNumberIndex="sequenceNumberIndex",Qo.sequenceNumberIndexPath=["uid","sequenceNumber"];class zo{constructor(e,t,n,r,s){this.indexId=e,this.uid=t,this.arrayValue=n,this.directionalValue=r,this.documentKey=s}}zo.store="indexEntries",zo.keyPath=["indexId","uid","arrayValue","directionalValue","documentKey"],zo.documentKeyIndex="documentKeyIndex",zo.documentKeyIndexPath=["indexId","uid","documentKey"];class Ho{constructor(e,t,n,r,s,i){this.userId=e,this.collectionPath=t,this.documentId=n,this.collectionGroup=r,this.largestBatchId=s,this.overlayMutation=i}}Ho.store="documentOverlays",Ho.keyPath=["userId","collectionPath","documentId"],Ho.collectionPathOverlayIndex="collectionPathOverlayIndex",Ho.collectionPathOverlayIndexPath=["userId","collectionPath","largestBatchId"],Ho.collectionGroupOverlayIndex="collectionGroupOverlayIndex",Ho.collectionGroupOverlayIndexPath=["userId","collectionGroup","largestBatchId"];const Wo=[ko.store,Oo.store,Ro.store,Po.store,Vo.store,Do.store,qo.store,Uo.store,jo.store,Fo.store,Bo.store,Ko.store,Go.store],Yo=[...Wo,Ho.store],Xo=[...Yo,$o.store,Qo.store,zo.store],Jo="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Zo{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}class ea{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(r,s){return this.callbackAttached&&mr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(s,this.error):this.wrapSuccess(r,this.result):new ea((t,n)=>{this.nextCallback=e=>{this.wrapSuccess(r,e).next(t,n)},this.catchCallback=e=>{this.wrapFailure(s,e).next(t,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{var t=e();return t instanceof ea?t:ea.resolve(t)}catch(e){return ea.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):ea.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):ea.reject(t)}static resolve(n){return new ea((e,t)=>{e(n)})}static reject(n){return new ea((e,t)=>{t(n)})}static waitFor(e){return new ea((t,n)=>{let r=0,s=0,i=!1;e.forEach(e=>{++r,e.next(()=>{++s,i&&s===r&&t()},e=>n(e))}),i=!0,s===r&&t()})}static or(e){let t=ea.resolve(!1);for(const n of e)t=t.next(e=>e?ea.resolve(e):n());return t}static forEach(e,n){const r=[];return e.forEach((e,t)=>{r.push(n.call(this,e,t))}),this.waitFor(r)}}class ta{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.At=new vr,this.transaction.oncomplete=()=>{this.At.resolve()},this.transaction.onabort=()=>{e.error?this.At.reject(new sa(t,e.error)):this.At.resolve()},this.transaction.onerror=e=>{e=ua(e.target.error);this.At.reject(new sa(t,e))}}static open(e,t,n,r){try{return new ta(t,e.transaction(r,n))}catch(e){throw new sa(t,e)}}get Rt(){return this.At.promise}abort(e){e&&this.At.reject(e),this.aborted||(lr("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}Pt(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){e=this.transaction.objectStore(e);return new oa(e)}}class na{constructor(e,t,n){this.name=e,this.version=t,this.bt=n,12.2===na.vt(f())&&dr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return lr("SimpleDb","Removing database:",e),aa(window.indexedDB.deleteDatabase(e)).toPromise()}static Vt(){if("object"!=typeof indexedDB)return!1;if(na.St())return!0;const e=f(),t=na.vt(e),n=0<t&&t<10,r=na.Dt(e),s=0<r&&r<4.5;return!(0<e.indexOf("MSIE ")||0<e.indexOf("Trident/")||0<e.indexOf("Edge/")||n||s)}static St(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.Ct)}static Nt(e,t){return e.store(t)}static vt(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static Dt(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async xt(s){return this.db||(lr("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{e=e.target.result;t(e)},r.onblocked=()=>{n(new sa(s,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=e=>{e=e.target.error;"VersionError"===e.name?n(new wr(yr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===e.name?n(new wr(yr.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+e)):n(new sa(s,e))},r.onupgradeneeded=e=>{lr("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;this.bt.kt(t,r.transaction,e.oldVersion,this.version).next(()=>{lr("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.Ot&&(this.db.onversionchange=e=>this.Ot(e)),this.db}Mt(t){this.Ot=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(e,t,n,r){var s="readonly"===t;let i=0;for(;;){++i;try{this.db=await this.xt(e);const t=ta.open(this.db,e,s?"readonly":"readwrite",n),i=r(t).next(e=>(t.Pt(),e)).catch(e=>(t.abort(e),ea.reject(e))).toPromise();return i.catch(()=>{}),await t.Rt,i}catch(e){const t="FirebaseError"!==e.name&&i<3;if(lr("SimpleDb","Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}class ra{constructor(e){this.$t=e,this.Ft=!1,this.Bt=null}get isDone(){return this.Ft}get Lt(){return this.Bt}set cursor(e){this.$t=e}done(){this.Ft=!0}Ut(e){this.Bt=e}delete(){return aa(this.$t.delete())}}class sa extends wr{constructor(e,t){super(yr.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function ia(e){return"IndexedDbTransactionError"===e.name}class oa{constructor(e){this.store=e}put(e,t){return aa(void 0!==t?(lr("SimpleDb","PUT",this.store.name,e,t),this.store.put(t,e)):(lr("SimpleDb","PUT",this.store.name,"<auto-key>",e),this.store.put(e)))}add(e){return lr("SimpleDb","ADD",this.store.name,e,e),aa(this.store.add(e))}get(t){return aa(this.store.get(t)).next(e=>(lr("SimpleDb","GET",this.store.name,t,e=void 0===e?null:e),e))}delete(e){return lr("SimpleDb","DELETE",this.store.name,e),aa(this.store.delete(e))}count(){return lr("SimpleDb","COUNT",this.store.name),aa(this.store.count())}qt(e,t){t=this.options(e,t);if(t.index||"function"!=typeof this.store.getAll){const e=this.cursor(t),n=[];return this.Kt(e,(e,t)=>{n.push(t)}).next(()=>n)}{const e=this.store.getAll(t.range);return new ea((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}}Gt(e,t){lr("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.jt=!1;t=this.cursor(n);return this.Kt(t,(e,t,n)=>n.delete())}Qt(e,t){let n;t?n=e:(n={},t=e);e=this.cursor(n);return this.Kt(e,t)}Wt(r){const e=this.cursor({});return new ea((n,t)=>{e.onerror=e=>{e=ua(e.target.error);t(e)},e.onsuccess=e=>{const t=e.target.result;t?r(t.primaryKey,t.value).next(e=>{e?t.continue():n()}):n()}})}Kt(e,i){const o=[];return new ea((s,t)=>{e.onerror=e=>{t(e.target.error)},e.onsuccess=e=>{const t=e.target.result;if(t){const n=new ra(t),r=i(t.primaryKey,t.value,n);if(r instanceof ea){const e=r.catch(e=>(n.done(),ea.reject(e)));o.push(e)}n.isDone?s():null===n.Lt?t.continue():t.continue(n.Lt)}else s()}}).next(()=>ea.waitFor(o))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.jt?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function aa(e){return new ea((t,n)=>{e.onsuccess=e=>{e=e.target.result;t(e)},e.onerror=e=>{e=ua(e.target.error);n(e)}})}let ha=!1;function ua(e){const t=na.vt(f());if(12.2<=t&&t<13){const t="An internal error was encountered in the Indexed Database server";if(0<=e.message.indexOf(t)){const e=new wr("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ha||(ha=!0,setTimeout(()=>{throw e},0)),e}}return e}class ca extends Zo{constructor(e,t){super(),this.zt=e,this.currentSequenceNumber=t}}function la(e,t){return na.Nt(e.zt,t)}class da{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){var n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const r=this.mutations[e];r.key.isEqual(t.key)&&Ii(r,t,n[e])}}applyToLocalView(e){for(const t of this.baseMutations)t.key.isEqual(e.key)&&bi(t,e,this.localWriteTime);for(const n of this.mutations)n.key.isEqual(e.key)&&bi(n,e,this.localWriteTime)}applyToLocalDocumentSet(r){this.mutations.forEach(e=>{const t=r.get(e.key),n=t;this.applyToLocalView(n),t.isValidDocument()||n.convertToNoDocument(Lr.min())})}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Gi())}isEqual(e){return this.batchId===e.batchId&&kr(this.mutations,e.mutations,(e,t)=>Ti(e,t))&&kr(this.baseMutations,e.baseMutations,(e,t)=>Ti(e,t))}}class fa{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){pr(e.mutations.length===n.length);let r=ji;var s=e.mutations;for(let e=0;e<s.length;e++)r=r.insert(s[e].key,n[e].version);return new fa(e,t,n,r)}}class ga{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class ma{constructor(e,t,n,r,s=Lr.min(),i=Lr.min(),o=Kr.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o}withSequenceNumber(e){return new ma(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new ma(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new ma(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class pa{constructor(e){this.Ht=e}}function ya(e,t){let n;if(t.document)n=yo(e.Ht,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=ts.fromSegments(t.noDocument.path),r=Ta(t.noDocument.readTime);n=ys.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return mr();{const e=ts.fromSegments(t.unknownDocument.path),s=Ta(t.unknownDocument.version);n=ys.newUnknownDocument(e,s)}}return t.readTime&&n.setReadTime(Ia(t.readTime)),n}function wa(e,t){var n=va(t.readTime),r=t.key.path.popLast().toArray();if(t.isFoundDocument()){var s={name:uo(i=e.Ht,(e=t).key),fields:e.data.value.mapValue.fields,updateTime:so(i,e.version.toTimestamp())},i=t.hasCommittedMutations;return new Po(null,null,s,i,n,r)}if(t.isNoDocument()){var s=t.key.path.toArray(),i=ba(t.version),o=t.hasCommittedMutations;return new Po(null,new Lo(s,i),null,o,n,r)}if(t.isUnknownDocument()){o=t.key.path.toArray(),t=ba(t.version);return new Po(new Mo(o,t),null,null,!0,n,r)}return mr()}function va(e){e=e.toTimestamp();return[e.seconds,e.nanoseconds]}function Ia(e){e=new Rr(e[0],e[1]);return Lr.fromTimestamp(e)}function ba(e){e=e.toTimestamp();return new Co(e.seconds,e.nanoseconds)}function Ta(e){e=new Rr(e.seconds,e.nanoseconds);return Lr.fromTimestamp(e)}function Ea(t,n){const r=(n.baseMutations||[]).map(e=>vo(t.Ht,e));for(let e=0;e<n.mutations.length-1;++e){const r=n.mutations[e];if(e+1<n.mutations.length&&void 0!==n.mutations[e+1].transform){const s=n.mutations[e+1];r.updateTransforms=s.transform.fieldTransforms,n.mutations.splice(e+1,1),++e}}const s=n.mutations.map(e=>vo(t.Ht,e)),e=Rr.fromMillis(n.localWriteTimeMs);return new da(n.batchId,e,r,s)}function Sa(e){var t=Ta(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?Ta(e.lastLimboFreeSnapshotVersion):Lr.min(),r=void 0!==e.query.documents?(pr(1===(r=e.query).documents.length),Ws(js(fo(r.documents[0])))):Ws(To(e.query));return new ma(r,e.targetId,0,e.lastListenSequenceNumber,t,n,Kr.fromBase64String(e.resumeToken))}function _a(e,t){var n=ba(t.snapshotVersion),r=ba(t.lastLimboFreeSnapshotVersion),s=(As(t.target)?Io:bo)(e.Ht,t.target),e=t.resumeToken.toBase64();return new Vo(t.targetId,Ss(t.target),n,e,t.sequenceNumber,r,s)}function Aa(e){var t=To({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Ys(t,t.limit,"L"):t}function xa(e,t){return new ga(t.largestBatchId,vo(e.Ht,t.overlayMutation))}function Na(e,t){var n=t.path.lastSegment();return[e,Ao(t.path.popLast()),n]}class Ca{getBundleMetadata(e,t){return Da(e).get(t).next(e=>{if(e)return{id:(e=e).bundleId,createTime:Ta(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return Da(e).put({bundleId:(t=t).id,createTime:ba(oo(t.createTime)),version:t.version})}getNamedQuery(e,t){return ka(e).get(t).next(e=>{if(e)return{name:(e=e).name,query:Aa(e.bundledQuery),readTime:Ta(e.readTime)}})}saveNamedQuery(e,t){return ka(e).put({name:t.name,readTime:ba(oo(t.readTime)),bundledQuery:t.bundledQuery})}}function Da(e){return la(e,Ko.store)}function ka(e){return la(e,Go.store)}class Oa{constructor(e,t){this.O=e,this.userId=t}static Jt(e,t){t=t.uid||"";return new Oa(e,t)}getOverlay(e,t){return Ra(e).get(Na(this.userId,t)).next(e=>e?xa(this.O,e):null)}saveOverlays(t,n,e){const r=[];return e.forEach(e=>{e=new ga(n,e);r.push(this.Yt(t,e))}),ea.waitFor(r)}removeOverlaysForBatchId(t,e,n){const r=new Set;e.forEach(e=>r.add(Ao(e.getCollectionPath())));const s=[];return r.forEach(e=>{e=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,n+1],!1,!0);s.push(Ra(t).Gt(Ho.collectionPathOverlayIndex,e))}),ea.waitFor(s)}getOverlaysForCollection(e,t,n){const r=new Map,s=Ao(t),i=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Ra(e).qt(Ho.collectionPathOverlayIndex,i).next(e=>{for(const t of e){const e=xa(this.O,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,n,s){const i=new Map;let o;t=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Ra(e).Qt({index:Ho.collectionGroupOverlayIndex,range:t},(e,t,n)=>{const r=xa(this.O,t);i.size<s||r.largestBatchId===o?(i.set(r.getKey(),r),o=r.largestBatchId):n.done()}).next(()=>i)}Yt(e,t){return Ra(e).put(function(e,t,n){var[,r,s]=Na(t,n.mutation.key);return new Ho(t,r,s,n.mutation.key.getCollectionGroup(),n.largestBatchId,wo(e.Ht,n.mutation))}(this.O,this.userId,t))}}function Ra(e){return la(e,Ho.store)}class La{constructor(){}Xt(e,t){this.Zt(e,t),t.te()}Zt(e,t){var n,r;"nullValue"in e?this.ee(t,5):"booleanValue"in e?(this.ee(t,10),t.ne(e.booleanValue?1:0)):"integerValue"in e?(this.ee(t,15),t.ne(Qr(e.integerValue))):"doubleValue"in e?(n=Qr(e.doubleValue),isNaN(n)?this.ee(t,13):(this.ee(t,15),Zr(n)?t.ne(0):t.ne(n))):"timestampValue"in e?(r=e.timestampValue,this.ee(t,20),"string"==typeof r?t.se(r):(t.se(`${r.seconds||""}`),t.ne(r.nanos||0))):"stringValue"in e?(this.ie(e.stringValue,t),this.re(t)):"bytesValue"in e?(this.ee(t,30),t.oe(zr(e.bytesValue)),this.re(t)):"referenceValue"in e?this.ce(e.referenceValue,t):"geoPointValue"in e?(r=e.geoPointValue,this.ee(t,45),t.ne(r.latitude||0),t.ne(r.longitude||0)):"mapValue"in e?ss(e,ns)?this.ee(t,Number.MAX_SAFE_INTEGER):(this.ue(e.mapValue,t),this.re(t)):"arrayValue"in e?(this.ae(e.arrayValue,t),this.re(t)):mr()}ie(e,t){this.ee(t,25),this.he(e,t)}he(e,t){t.se(e)}ue(e,t){var n=e.fields||{};this.ee(t,55);for(const e of Object.keys(n))this.ie(e,t),this.Zt(n[e],t)}ae(e,t){e=e.values||[];this.ee(t,50);for(const n of e)this.Zt(n,t)}ce(e,t){this.ee(t,37),ts.fromName(e).path.forEach(e=>{this.ee(t,60),this.he(e,t)})}ee(e,t){e.ne(t)}re(e){e.ne(2)}}function Ma(e){e=64-function(t){let n=0;for(let e=0;e<8;++e){var r=function(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}(255&t[e]);if(n+=r,8!==r)break}return n}(e);return Math.ceil(e/8)}La.le=new La;class Pa{constructor(){this.buffer=new Uint8Array(1024),this.position=0}fe(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.de(n.value),n=t.next();this._e()}we(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.me(n.value),n=t.next();this.ge()}ye(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.de(e);else if(e<2048)this.de(960|e>>>6),this.de(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.de(480|e>>>12),this.de(128|63&e>>>6),this.de(128|63&e);else{const e=t.codePointAt(0);this.de(240|e>>>18),this.de(128|63&e>>>12),this.de(128|63&e>>>6),this.de(128|63&e)}}this._e()}pe(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.me(e);else if(e<2048)this.me(960|e>>>6),this.me(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.me(480|e>>>12),this.me(128|63&e>>>6),this.me(128|63&e);else{const e=t.codePointAt(0);this.me(240|e>>>18),this.me(128|63&e>>>12),this.me(128|63&e>>>6),this.me(128|63&e)}}this.ge()}Ie(t){var n=this.Ee(t),t=Ma(n);this.Te(1+t),this.buffer[this.position++]=255&t;for(let e=n.length-t;e<n.length;++e)this.buffer[this.position++]=255&n[e]}Ae(t){var n=this.Ee(t),t=Ma(n);this.Te(1+t),this.buffer[this.position++]=~(255&t);for(let e=n.length-t;e<n.length;++e)this.buffer[this.position++]=~(255&n[e])}Re(){this.Pe(255),this.Pe(255)}be(){this.ve(255),this.ve(255)}reset(){this.position=0}seed(e){this.Te(e.length),this.buffer.set(e,this.position),this.position+=e.length}Ve(){return this.buffer.slice(0,this.position)}Ee(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=n?255:0;return t}de(e){e&=255;0==e?(this.Pe(0),this.Pe(255)):255==e?(this.Pe(255),this.Pe(0)):this.Pe(e)}me(e){var t=255&e;0==t?(this.ve(0),this.ve(255)):255==t?(this.ve(255),this.ve(0)):this.ve(e)}_e(){this.Pe(0),this.Pe(1)}ge(){this.ve(0),this.ve(1)}Pe(e){this.Te(1),this.buffer[this.position++]=e}ve(e){this.Te(1),this.buffer[this.position++]=~e}Te(t){t+=this.position;if(!(t<=this.buffer.length)){let e=2*this.buffer.length;e<t&&(e=t);const n=new Uint8Array(e);n.set(this.buffer),this.buffer=n}}}class Fa{constructor(e){this.Se=e}oe(e){this.Se.fe(e)}se(e){this.Se.ye(e)}ne(e){this.Se.Ie(e)}te(){this.Se.Re()}}class Va{constructor(e){this.Se=e}oe(e){this.Se.we(e)}se(e){this.Se.pe(e)}ne(e){this.Se.Ae(e)}te(){this.Se.be()}}class Ua{constructor(){this.Se=new Pa,this.De=new Fa(this.Se),this.Ce=new Va(this.Se)}seed(e){this.Se.seed(e)}Ne(e){return 0===e?this.De:this.Ce}Ve(){return this.Se.Ve()}reset(){this.Se.reset()}}class qa{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}}function Ba(e,t){let n=e.indexId-t.indexId;return 0!==n?n:(n=ts.comparator(e.documentKey,t.documentKey),0!==n?n:(n=ja(e.arrayValue,t.arrayValue),0!==n?n:ja(e.directionalValue,t.directionalValue)))}function ja(t,n){for(let e=0;e<t.length&&e<n.length;++e){var r=t[e]-n[e];if(0!=r)return r}return t.length-n.length}class Ka{constructor(){this.xe=new Ga}addToCollectionParentIndex(e,t){return this.xe.add(t),ea.resolve()}getCollectionParents(e,t){return ea.resolve(this.xe.getEntries(t))}addFieldIndex(e,t){return ea.resolve()}deleteFieldIndex(e,t){return ea.resolve()}getDocumentsMatchingTarget(e,t,n){return ea.resolve(Gi())}getFieldIndex(e,t){return ea.resolve(null)}getFieldIndexes(e,t){return ea.resolve([])}getNextCollectionGroupToUpdate(e){return ea.resolve(null)}updateCollectionGroup(e,t,n){return ea.resolve()}updateIndexEntries(e,t){return ea.resolve()}}class Ga{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Fi(Ur.comparator),s=!r.has(n);return this.index[t]=r.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new Fi(Ur.comparator)).toArray()}}class $a{constructor(e){this.user=e,this.ke=new Ga,this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(this.ke.has(t))return ea.resolve();var n=t.lastSegment(),r=t.popLast();return e.addOnCommittedListener(()=>{this.ke.add(t)}),r={collectionId:n,parent:Ao(r)},Qa(e).put(r)}getCollectionParents(e,n){const r=[],t=IDBKeyRange.bound([n,""],[Or(n),""],!1,!0);return Qa(e).qt(t).next(e=>{for(const t of e){if(t.collectionId!==n)break;r.push(No(t.parent))}return r})}addFieldIndex(e,t){const n=Ha(e),r=new $o(t.indexId,t.collectionGroup,t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind]));return delete r.indexId,n.add(r).next()}deleteFieldIndex(e,t){const n=Ha(e),r=Wa(e),s=za(e);return n.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,t,n){return ea.resolve(Gi())}getFieldIndex(e,t){return ea.resolve(null)}Oe(e,t){const n=new Ua;for(const s of e.fields.filter(e=>2!==e.kind)){const e=t.data.field(s.fieldPath);if(null==e)return null;var r=n.Ne(s.kind);La.le.Xt(e,r)}return n.Ve()}Me(e){const t=new Ua;return La.le.Xt(e,t.Ne(0)),t.Ve()}getFieldIndexes(e,t){const n=Ha(e),i=Wa(e);return(t?n.qt($o.collectionGroupIndex,IDBKeyRange.bound(t,t)):n.qt()).next(e=>{const s=[];return ea.forEach(e,r=>i.get([r.indexId,this.uid]).next(e=>{var t,n;s.push((t=r,n=e?new Is(e.sequenceNumber,new bs(Ta(e.readTime),new ts(No(e.documentKey)),e.largestBatchId)):Is.empty(),e=t.fields.map(([e,t])=>new vs(Br.fromServerFormat(e),t)),new ws(t.indexId,t.collectionGroup,e,n)))})).next(()=>s)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>e.indexState.sequenceNumber-t.indexState.sequenceNumber),e[0].collectionGroup))}updateCollectionGroup(e,n,r){const s=Ha(e),i=Wa(e);return this.$e(e).next(t=>s.qt($o.collectionGroupIndex,IDBKeyRange.bound(n,n)).next(e=>ea.forEach(e,e=>i.put(function(e,t,n,r){return new Qo(e,t.uid||"",n,ba(r.readTime),Ao(r.documentKey.path),r.largestBatchId)}(e.indexId,this.user,t,r)))))}updateIndexEntries(s,e){const n=new Map;return ea.forEach(e,(t,r)=>{var e=n.get(t.collectionGroup);return(e?ea.resolve(e):this.getFieldIndexes(s,t.collectionGroup)).next(e=>(n.set(t.collectionGroup,e),ea.forEach(e,n=>this.Fe(s,t,n).next(e=>{var t=this.Be(r,n);return e.isEqual(t)?ea.resolve():this.Le(s,r,e,t)}))))})}Ue(e,t,n){return za(e).put(new zo(n.indexId,this.uid,n.arrayValue,n.directionalValue,Ao(t.key.path)))}qe(e,t,n){return za(e).delete([n.indexId,this.uid,n.arrayValue,n.directionalValue,Ao(t.key.path)])}Fe(e,n,r){const t=za(e);let s=new Fi(Ba);return t.Qt({index:zo.documentKeyIndex,range:IDBKeyRange.only([r.indexId,this.uid,Ao(n.path)])},(e,t)=>{s=s.add(new qa(r.indexId,n,t.arrayValue,t.directionalValue))}).next(()=>s)}Be(e,t){let n=new Fi(Ba);var r=this.Oe(t,e);if(null==r)return n;const s=t.fields.find(e=>2===e.kind);if(null!=s){var i=e.data.field(s.fieldPath);if(ls(i))for(const s of i.arrayValue.values||[])n=n.add(new qa(t.indexId,e.key,this.Me(s),r))}else n=n.add(new qa(t.indexId,e.key,new Uint8Array,r));return n}Le(t,n,u,e){lr("IndexedDbIndexManager","Updating index entries for document '%s'",n.key);const r=[];return function(e,n,r,s){var i=u.getIterator(),o=e.getIterator();let a=Ui(i),h=Ui(o);for(;a||h;){let e=!1,t=!1;if(a&&h){const r=n(a,h);r<0?t=!0:0<r&&(e=!0)}else null!=a?t=!0:e=!0;e?(r(h),h=Ui(o)):t?(s(a),a=Ui(i)):(a=Ui(i),h=Ui(o))}}(e,Ba,e=>{r.push(this.Ue(t,n,e))},e=>{r.push(this.qe(t,n,e))}),ea.waitFor(r)}$e(e){let r=1;return Wa(e).Qt({index:Qo.sequenceNumberIndex,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,t,n)=>{n.done(),r=t.sequenceNumber+1}).next(()=>r)}}function Qa(e){return la(e,Bo.store)}function za(e){return la(e,zo.store)}function Ha(e){return la(e,$o.store)}function Wa(e){return la(e,Qo.store)}const Ya={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Xa{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Xa(e,Xa.DEFAULT_COLLECTION_PERCENTILE,Xa.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Ja(e,t,n){const r=e.store(Oo.store),s=e.store(Ro.store),i=[],o=IDBKeyRange.only(n.batchId);let a=0;const h=r.Qt({range:o},(e,t,n)=>(a++,n.delete()));i.push(h.next(()=>{pr(1===a)}));const u=[];for(const e of n.mutations){const r=Ro.key(t,e.key.path,n.batchId);i.push(s.delete(r)),u.push(e.key)}return ea.waitFor(i).next(()=>u)}function Za(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw mr();t=e.noDocument}return JSON.stringify(t).length}Xa.DEFAULT_COLLECTION_PERCENTILE=10,Xa.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Xa.DEFAULT=new Xa(41943040,Xa.DEFAULT_COLLECTION_PERCENTILE,Xa.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Xa.DISABLED=new Xa(-1,0,0);class eh{constructor(e,t,n,r){this.userId=e,this.O=t,this.indexManager=n,this.referenceDelegate=r,this.Ke={}}static Jt(e,t,n,r){pr(""!==e.uid);e=e.isAuthenticated()?e.uid:"";return new eh(e,t,n,r)}checkEmpty(e){let r=!0;var t=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return nh(e).Qt({index:Oo.userMutationsIndex,range:t},(e,t,n)=>{r=!1,n.done()}).next(()=>r)}addMutationBatch(c,l,d,f){const g=rh(c),m=nh(c);return m.add({}).next(e=>{pr("number"==typeof e);const t=new da(e,l,d,f),n=(s=this.O,i=this.userId,a=(o=t).baseMutations.map(e=>wo(s.Ht,e)),h=o.mutations.map(e=>wo(s.Ht,e)),new Oo(i,o.batchId,o.localWriteTime.toMillis(),a,h)),r=[];var s,i,o,a,h;let u=new Fi((e,t)=>Dr(e.canonicalString(),t.canonicalString()));for(const c of f){const l=Ro.key(this.userId,c.key.path,e);u=u.add(c.key.path.popLast()),r.push(m.put(n)),r.push(g.put(l,Ro.PLACEHOLDER))}return u.forEach(e=>{r.push(this.indexManager.addToCollectionParentIndex(c,e))}),c.addOnCommittedListener(()=>{this.Ke[e]=t.keys()}),ea.waitFor(r).next(()=>t)})}lookupMutationBatch(e,t){return nh(e).get(t).next(e=>e?(pr(e.userId===this.userId),Ea(this.O,e)):null)}Ge(e,t){return this.Ke[t]?ea.resolve(this.Ke[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){e=e.keys();return this.Ke[t]=e}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return nh(e).Qt({index:Oo.userMutationsIndex,range:n},(e,t,n)=>{t.userId===this.userId&&(pr(t.batchId>=r),s=Ea(this.O,t)),n.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return nh(e).Qt({index:Oo.userMutationsIndex,range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){var t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return nh(e).qt(Oo.userMutationsIndex,t).next(e=>e.map(e=>Ea(this.O,e)))}getAllMutationBatchesAffectingDocumentKey(i,o){const e=Ro.prefixForPath(this.userId,o.path),t=IDBKeyRange.lowerBound(e),a=[];return rh(i).Qt({range:t},(e,t,n)=>{var[r,s,e]=e,s=No(s);if(r===this.userId&&o.path.isEqual(s))return nh(i).get(e).next(e=>{if(!e)throw mr();pr(e.userId===this.userId),a.push(Ea(this.O,e))});n.done()}).next(()=>a)}getAllMutationBatchesAffectingDocumentKeys(t,e){let o=new Fi(Dr);const n=[];return e.forEach(i=>{var e=Ro.prefixForPath(this.userId,i.path),e=IDBKeyRange.lowerBound(e),e=rh(t).Qt({range:e},(e,t,n)=>{var[r,s,e]=e,s=No(s);r===this.userId&&i.path.isEqual(s)?o=o.add(e):n.done()});n.push(e)}),ea.waitFor(n).next(()=>this.je(t,o))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,o=i.length+1,n=Ro.prefixForPath(this.userId,i),r=IDBKeyRange.lowerBound(n);let a=new Fi(Dr);return rh(e).Qt({range:r},(e,t,n)=>{var[r,s,e]=e,s=No(s);r===this.userId&&i.isPrefixOf(s)?s.length===o&&(a=a.add(e)):n.done()}).next(()=>this.je(e,a))}je(t,e){const n=[],r=[];return e.forEach(e=>{r.push(nh(t).get(e).next(e=>{if(null===e)throw mr();pr(e.userId===this.userId),n.push(Ea(this.O,e))}))}),ea.waitFor(r).next(()=>n)}removeMutationBatch(t,n){return Ja(t.zt,this.userId,n).next(e=>(t.addOnCommittedListener(()=>{this.Qe(n.batchId)}),ea.forEach(e,e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))}Qe(e){delete this.Ke[e]}performConsistencyCheck(n){return this.checkEmpty(n).next(e=>{if(!e)return ea.resolve();const t=IDBKeyRange.lowerBound(Ro.prefixForUser(this.userId)),r=[];return rh(n).Qt({range:t},(e,t,n)=>{if(e[0]===this.userId){const t=No(e[1]);r.push(t)}else n.done()}).next(()=>{pr(0===r.length)})})}containsKey(e,t){return th(e,this.userId,t)}We(e){return sh(e).get(this.userId).next(e=>e||new ko(this.userId,-1,""))}}function th(e,s,t){const n=Ro.prefixForPath(s,t.path),i=n[1],r=IDBKeyRange.lowerBound(n);let o=!1;return rh(e).Qt({range:r,jt:!0},(e,t,n)=>{var[r,e]=e;r===s&&e===i&&(o=!0),n.done()}).next(()=>o)}function nh(e){return la(e,Oo.store)}function rh(e){return la(e,Ro.store)}function sh(e){return la(e,ko.store)}class ih{constructor(e){this.ze=e}next(){return this.ze+=2,this.ze}static He(){return new ih(0)}static Je(){return new ih(-1)}}class oh{constructor(e,t){this.referenceDelegate=e,this.O=t}allocateTargetId(n){return this.Ye(n).next(e=>{const t=new ih(e.highestTargetId);return e.highestTargetId=t.next(),this.Xe(n,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Ye(e).next(e=>Lr.fromTimestamp(new Rr(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Ye(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,n,r){return this.Ye(t).next(e=>(e.highestListenSequenceNumber=n,r&&(e.lastRemoteSnapshotVersion=r.toTimestamp()),n>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=n),this.Xe(t,e)))}addTargetData(t,n){return this.Ze(t,n).next(()=>this.Ye(t).next(e=>(e.targetCount+=1,this.tn(n,e),this.Xe(t,e))))}updateTargetData(e,t){return this.Ze(e,t)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>ah(t).delete(e.targetId)).next(()=>this.Ye(t)).next(e=>(pr(0<e.targetCount),--e.targetCount,this.Xe(t,e)))}removeTargets(n,r,s){let i=0;const o=[];return ah(n).Qt((e,t)=>{t=Sa(t);t.sequenceNumber<=r&&null===s.get(t.targetId)&&(i++,o.push(this.removeTargetData(n,t)))}).next(()=>ea.waitFor(o)).next(()=>i)}forEachTarget(e,n){return ah(e).Qt((e,t)=>{t=Sa(t);n(t)})}Ye(e){return hh(e).get(qo.key).next(e=>(pr(null!==e),e))}Xe(e,t){return hh(e).put(qo.key,t)}Ze(e,t){return ah(e).put(_a(this.O,t))}tn(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.Ye(e).next(e=>e.targetCount)}getTargetData(e,r){var t=Ss(r),t=IDBKeyRange.bound([t,Number.NEGATIVE_INFINITY],[t,Number.POSITIVE_INFINITY]);let s=null;return ah(e).Qt({range:t,index:Vo.queryTargetsIndexName},(e,t,n)=>{t=Sa(t);_s(r,t.target)&&(s=t,n.done())}).next(()=>s)}addMatchingKeys(n,e,r){const s=[],i=uh(n);return e.forEach(e=>{var t=Ao(e.path);s.push(i.put(new Uo(r,t))),s.push(this.referenceDelegate.addReference(n,r,e))}),ea.waitFor(s)}removeMatchingKeys(n,e,r){const s=uh(n);return ea.forEach(e,e=>{var t=Ao(e.path);return ea.waitFor([s.delete([r,t]),this.referenceDelegate.removeReference(n,r,e)])})}removeMatchingKeysForTargetId(e,t){const n=uh(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=uh(e);let s=Gi();return r.Qt({range:n,jt:!0},(e,t,n)=>{e=No(e[1]),e=new ts(e);s=s.add(e)}).next(()=>s)}containsKey(e,t){t=Ao(t.path),t=IDBKeyRange.bound([t],[Or(t)],!1,!0);let r=0;return uh(e).Qt({index:Uo.documentTargetsIndex,jt:!0,range:t},([e],t,n)=>{0!==e&&(r++,n.done())}).next(()=>0<r)}Tt(e,t){return ah(e).get(t).next(e=>e?Sa(e):null)}}function ah(e){return la(e,Vo.store)}function hh(e){return la(e,qo.store)}function uh(e){return la(e,Uo.store)}async function ch(e){if(e.code!==yr.FAILED_PRECONDITION||e.message!==Jo)throw e;lr("LocalStore","Unexpectedly lost primary lease")}function lh([e,t],[n,r]){n=Dr(e,n);return 0===n?Dr(t,r):n}class dh{constructor(e){this.en=e,this.buffer=new Fi(lh),this.nn=0}sn(){return++this.nn}rn(e){e=[e,this.sn()];if(this.buffer.size<this.en)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();lh(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class fh{constructor(e,t){this.garbageCollector=e,this.asyncQueue=t,this.on=!1,this.cn=null}start(e){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.un(e)}stop(){this.cn&&(this.cn.cancel(),this.cn=null)}get started(){return null!==this.cn}un(e){var t=this.on?3e5:6e4;lr("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.cn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.cn=null,this.on=!0;try{await e.collectGarbage(this.garbageCollector)}catch(e){ia(e)?lr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await ch(e)}await this.un(e)})}}class gh{constructor(e,t){this.an=e,this.params=t}calculateTargetCount(e,t){return this.an.hn(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return ea.resolve(Nr.A);const n=new dh(t);return this.an.forEachTarget(e,e=>n.rn(e.sequenceNumber)).next(()=>this.an.ln(e,e=>n.rn(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.an.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.an.removeOrphanedDocuments(e,t)}collect(t,n){return-1===this.params.cacheSizeCollectionThreshold?(lr("LruGarbageCollector","Garbage collection skipped; disabled"),ea.resolve(Ya)):this.getCacheSize(t).next(e=>e<this.params.cacheSizeCollectionThreshold?(lr("LruGarbageCollector",`Garbage collection skipped; Cache size ${e} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ya):this.fn(t,n))}getCacheSize(e){return this.an.getCacheSize(e)}fn(t,n){let r,s,i,o,a,h,u;const c=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(e=>(s=e>this.params.maximumSequenceNumbersToCollect?(lr("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),this.params.maximumSequenceNumbersToCollect):e,o=Date.now(),this.nthSequenceNumber(t,s))).next(e=>(r=e,a=Date.now(),this.removeTargets(t,r,n))).next(e=>(i=e,h=Date.now(),this.removeOrphanedDocuments(t,r))).next(e=>(u=Date.now(),cr()<=l.DEBUG&&lr("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-c}ms\n\tDetermined least recently used ${s} in `+(a-o)+"ms\n"+`\tRemoved ${i} targets in `+(h-a)+"ms\n"+`\tRemoved ${e} documents in `+(u-h)+"ms\n"+`Total Duration: ${u-c}ms`),ea.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:e})))}}class mh{constructor(e,t){this.db=e,this.garbageCollector=(e=this,new gh(e,t))}hn(e){const n=this.dn(e);return this.db.getTargetCache().getTargetCount(e).next(t=>n.next(e=>t+e))}dn(e){let t=0;return this.ln(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}ln(e,n){return this._n(e,(e,t)=>n(t))}addReference(e,t,n){return ph(e,n)}removeReference(e,t,n){return ph(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return ph(e,t)}wn(t,n){let r=!1;return sh(t).Wt(e=>th(t,e,n).next(e=>(e&&(r=!0),ea.resolve(!e)))).next(()=>r)}removeOrphanedDocuments(n,r){const s=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let o=0;return this._n(n,(t,e)=>{if(e<=r){const r=this.wn(n,t).next(e=>{if(!e)return o++,s.getEntry(n,t).next(()=>(s.removeEntry(t,Lr.min()),uh(n).delete([0,Ao(t.path)])))});i.push(r)}}).next(()=>ea.waitFor(i)).next(()=>s.apply(n)).next(()=>o)}removeTarget(e,t){t=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,t)}updateLimboDocument(e,t){return ph(e,t)}_n(e,r){const t=uh(e);let s,i=Nr.A;return t.Qt({index:Uo.documentTargetsIndex},([e],{path:t,sequenceNumber:n})=>{0===e?(i!==Nr.A&&r(new ts(No(s)),i),i=n,s=t):i=Nr.A}).next(()=>{i!==Nr.A&&r(new ts(No(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function ph(e,t){return uh(e).put((e=e.currentSequenceNumber,new Uo(0,Ao(t.path),e)))}class yh{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={}}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(t,n){const e=this.mapKeyFn(t),r=this.inner[e];if(void 0!==r){for(let e=0;e<r.length;e++)if(this.equalsFn(r[e][0],t))return void(r[e]=[t,n]);r.push([t,n])}else this.inner[e]=[[t,n]]}delete(t){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return!1;for(let e=0;e<r.length;e++)if(this.equalsFn(r[e][0],t))return 1===r.length?delete this.inner[n]:r.splice(e,1),!0;return!1}forEach(r){Pr(this.inner,(e,t)=>{for(const[e,n]of t)r(e,n)})}isEmpty(){return Fr(this.inner)}}class wh{constructor(){this.changes=new yh(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ys.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?ea.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class vh{constructor(e){this.O=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return Th(e).put(Eh(t),n)}removeEntry(e,t){const n=Th(e),r=Eh(t);return n.delete(r)}updateMetadata(t,n){return this.getMetadata(t).next(e=>(e.byteSize+=n,this.mn(t,e)))}getEntry(e,t){return Th(e).get(Eh(t)).next(e=>this.gn(t,e))}yn(e,t){return Th(e).get(Eh(t)).next(e=>({document:this.gn(t,e),size:Za(e)}))}getEntries(e,t){let n=qi;return this.pn(e,t,(e,t)=>{t=this.gn(e,t);n=n.insert(e,t)}).next(()=>n)}In(e,t){let r=qi,s=new Li(ts.comparator);return this.pn(e,t,(e,t)=>{var n=this.gn(e,t);r=r.insert(e,n),s=s.insert(e,Za(t))}).next(()=>({documents:r,En:s}))}pn(e,t,s){if(t.isEmpty())return ea.resolve();const n=IDBKeyRange.bound(t.first().path.toArray(),t.last().path.toArray()),i=t.getIterator();let o=i.getNext();return Th(e).Qt({range:n},(e,t,n)=>{for(var r=ts.fromSegments(e);o&&ts.comparator(o,r)<0;)s(o,null),o=i.getNext();o&&o.isEqual(r)&&(s(o,t),o=i.hasNext()?i.getNext():null),o?n.Ut(o.path.toArray()):n.done()}).next(()=>{for(;o;)s(o,null),o=i.hasNext()?i.getNext():null})}getAll(e,r,t){let s=qi;const i=r.length+1,n={};if(t.isEqual(Lr.min())){const e=r.toArray();n.range=IDBKeyRange.lowerBound(e)}else{const e=r.toArray(),s=va(t);n.range=IDBKeyRange.lowerBound([e,s],!0),n.index=Po.collectionReadTimeIndex}return Th(e).Qt(n,(e,t,n)=>{e.length===i&&(t=this.gn(ts.fromSegments(e),t),r.isPrefixOf(t.key.path)?s=s.insert(t.key,t):n.done())}).next(()=>s)}newChangeBuffer(e){return new Ih(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return bh(e).get(Fo.key).next(e=>(pr(!!e),e))}mn(e,t){return bh(e).put(Fo.key,t)}gn(e,t){if(t){const e=ya(this.O,t);if(!e.isNoDocument()||!e.version.isEqual(Lr.min()))return e}return ys.newInvalidDocument(e)}}class Ih extends wh{constructor(e,t){super(),this.Tn=e,this.trackRemovals=t,this.An=new yh(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(i){const o=[];let a=0,h=new Fi((e,t)=>Dr(e.canonicalString(),t.canonicalString()));return this.changes.forEach((e,t)=>{var n=this.An.get(e);if(t.isValidDocument()){var r=wa(this.Tn.O,t);h=h.add(e.path.popLast());var s=Za(r);a+=s-n,o.push(this.Tn.addEntry(i,e,r))}else if(a-=n,this.trackRemovals){const a=wa(this.Tn.O,t.convertToNoDocument(Lr.min()));o.push(this.Tn.addEntry(i,e,a))}else o.push(this.Tn.removeEntry(i,e))}),h.forEach(e=>{o.push(this.Tn.indexManager.addToCollectionParentIndex(i,e))}),o.push(this.Tn.updateMetadata(i,a)),ea.waitFor(o)}getFromCache(e,t){return this.Tn.yn(e,t).next(e=>(this.An.set(t,e.size),e.document))}getAllFromCache(e,t){return this.Tn.In(e,t).next(({documents:e,En:t})=>(t.forEach((e,t)=>{this.An.set(e,t)}),e))}}function bh(e){return la(e,Fo.store)}function Th(e){return la(e,Po.store)}function Eh(e){return e.path.toArray()}class Sh{constructor(e){this.O=e}kt(t,n,e,r){const s=new ta("createOrUpgrade",n);var i;e<1&&1<=r&&(t.createObjectStore(Do.store),(i=t).createObjectStore(ko.store,{keyPath:ko.keyPath}),i.createObjectStore(Oo.store,{keyPath:Oo.keyPath,autoIncrement:!0}).createIndex(Oo.userMutationsIndex,Oo.userMutationsKeyPath,{unique:!0}),i.createObjectStore(Ro.store),_h(t),t.createObjectStore(Po.store));let o=ea.resolve();return e<3&&3<=r&&(0!==e&&((i=t).deleteObjectStore(Uo.store),i.deleteObjectStore(Vo.store),i.deleteObjectStore(qo.store),_h(t)),o=o.next(()=>function(){const e=s.store(qo.store),t=new qo(0,0,Lr.min().toTimestamp(),0);return e.put(qo.key,t)}())),e<4&&4<=r&&(0!==e&&(o=o.next(()=>function(r,s){return s.store(Oo.store).qt().next(e=>{r.deleteObjectStore(Oo.store),r.createObjectStore(Oo.store,{keyPath:Oo.keyPath,autoIncrement:!0}).createIndex(Oo.userMutationsIndex,Oo.userMutationsKeyPath,{unique:!0});const t=s.store(Oo.store),n=e.map(e=>t.put(e));return ea.waitFor(n)})}(t,s))),o=o.next(()=>{t.createObjectStore(jo.store,{keyPath:jo.keyPath})})),e<5&&5<=r&&(o=o.next(()=>this.Rn(s))),e<6&&6<=r&&(o=o.next(()=>(t.createObjectStore(Fo.store),this.Pn(s)))),e<7&&7<=r&&(o=o.next(()=>this.bn(s))),e<8&&8<=r&&(o=o.next(()=>this.vn(t,s))),e<9&&9<=r&&(o=o.next(()=>{var e;(e=t).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges"),function(){const e=n.objectStore(Po.store);e.createIndex(Po.readTimeIndex,Po.readTimeIndexPath,{unique:!1}),e.createIndex(Po.collectionReadTimeIndex,Po.collectionReadTimeIndexPath,{unique:!1})}()})),e<10&&10<=r&&(o=o.next(()=>this.Vn(s))),e<11&&11<=r&&(o=o.next(()=>{t.createObjectStore(Ko.store,{keyPath:Ko.keyPath}),t.createObjectStore(Go.store,{keyPath:Go.keyPath})})),e<12&&12<=r&&(o=o.next(()=>{!function(){const e=t.createObjectStore(Ho.store,{keyPath:Ho.keyPath});e.createIndex(Ho.collectionPathOverlayIndex,Ho.collectionPathOverlayIndexPath,{unique:!1}),e.createIndex(Ho.collectionGroupOverlayIndex,Ho.collectionGroupOverlayIndexPath,{unique:!1})}()})),e<13&&13<=r&&(o=o.next(()=>{var e;(e=t).createObjectStore($o.store,{keyPath:$o.keyPath,autoIncrement:!0}).createIndex($o.collectionGroupIndex,$o.collectionGroupIndexPath,{unique:!1}),e.createObjectStore(Qo.store,{keyPath:Qo.keyPath}).createIndex(Qo.sequenceNumberIndex,Qo.sequenceNumberIndexPath,{unique:!1}),e.createObjectStore(zo.store,{keyPath:zo.keyPath}).createIndex(zo.documentKeyIndex,zo.documentKeyIndexPath,{unique:!1})})),o}Pn(t){let n=0;return t.store(Po.store).Qt((e,t)=>{n+=Za(t)}).next(()=>{var e=new Fo(n);return t.store(Fo.store).put(Fo.key,e)})}Rn(n){const e=n.store(ko.store),r=n.store(Oo.store);return e.qt().next(e=>ea.forEach(e,t=>{var e=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return r.qt(Oo.userMutationsIndex,e).next(e=>ea.forEach(e,e=>{pr(e.userId===t.userId);e=Ea(this.O,e);return Ja(n,t.userId,e).next(()=>{})}))}))}bn(e){const o=e.store(Uo.store),t=e.store(Po.store);return e.store(qo.store).get(qo.key).next(s=>{const i=[];return t.Qt((e,t)=>{const n=new Ur(e),r=[0,Ao(n)];i.push(o.get(r).next(e=>e?ea.resolve():(e=>o.put(new Uo(0,Ao(e),s.highestListenSequenceNumber)))(n)))}).next(()=>ea.waitFor(i))})}vn(e,t){e.createObjectStore(Bo.store,{keyPath:Bo.keyPath});const n=t.store(Bo.store),r=new Ga,s=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:Ao(r)})}};return t.store(Po.store).Qt({jt:!0},(e,t)=>{const n=new Ur(e);return s(n.popLast())}).next(()=>t.store(Ro.store).Qt({jt:!0},([,e],t)=>{const n=No(e);return s(n.popLast())}))}Vn(e){const n=e.store(Vo.store);return n.Qt((e,t)=>{t=Sa(t),t=_a(this.O,t);return n.put(t)})}}function _h(e){e.createObjectStore(Uo.store,{keyPath:Uo.keyPath}).createIndex(Uo.documentTargetsIndex,Uo.documentTargetsKeyPath,{unique:!0}),e.createObjectStore(Vo.store,{keyPath:Vo.keyPath}).createIndex(Vo.queryTargetsIndexName,Vo.queryTargetsKeyPath,{unique:!0}),e.createObjectStore(qo.store)}const Ah="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class xh{constructor(e,t,n,r,s,i,o,a,h,u,c=12){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Sn=s,this.window=i,this.document=o,this.Dn=h,this.Cn=u,this.schemaVersion=c,this.Nn=null,this.xn=!1,this.isPrimary=!1,this.networkEnabled=!0,this.kn=null,this.inForeground=!1,this.On=null,this.Mn=null,this.$n=Number.NEGATIVE_INFINITY,this.Fn=e=>Promise.resolve(),!xh.Vt())throw new wr(yr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new mh(this,r),this.Bn=t+"main",this.O=new pa(a),this.Ln=new na(this.Bn,this.schemaVersion,new Sh(this.O)),this.Un=new oh(this.referenceDelegate,this.O),this.qn=(a=this.O,new vh(a)),this.Kn=new Ca,this.window&&this.window.localStorage?this.Gn=this.window.localStorage:(this.Gn=null,!1===u&&dr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.jn().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new wr(yr.FAILED_PRECONDITION,Ah);return this.Qn(),this.Wn(),this.zn(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Un.getHighestSequenceNumber(e))}).then(e=>{this.Nn=new Nr(e,this.Dn)}).then(()=>{this.xn=!0}).catch(e=>(this.Ln&&this.Ln.close(),Promise.reject(e)))}Hn(t){return this.Fn=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.Ln.Mt(async e=>{null===e.newVersion&&await t()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Sn.enqueueAndForget(async()=>{this.started&&await this.jn()}))}jn(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>Ch(t).put(new jo(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next(()=>{if(this.isPrimary)return this.Jn(t).next(e=>{e||(this.isPrimary=!1,this.Sn.enqueueRetryable(()=>this.Fn(!1)))})}).next(()=>this.Yn(t)).next(e=>this.isPrimary&&!e?this.Xn(t).next(()=>!1):!!e&&this.Zn(t).next(()=>!0))).catch(e=>{if(ia(e))return lr("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return lr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Sn.enqueueRetryable(()=>this.Fn(e)),this.isPrimary=e})}Jn(e){return Nh(e).get(Do.key).next(e=>ea.resolve(this.ts(e)))}es(e){return Ch(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.ss(this.$n,18e5)){this.$n=Date.now();var e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{const r=la(e,jo.store);return r.qt().next(e=>{const t=this.rs(e,18e5),n=e.filter(e=>-1===t.indexOf(e));return ea.forEach(n,e=>r.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.Gn)for(const t of e)this.Gn.removeItem(this.os(t.clientId))}}zn(){this.Mn=this.Sn.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.jn().then(()=>this.ns()).then(()=>this.zn()))}ts(e){return!!e&&e.ownerId===this.clientId}Yn(t){return this.Cn?ea.resolve(!0):Nh(t).get(Do.key).next(e=>{if(null!==e&&this.ss(e.leaseTimestampMs,5e3)&&!this.cs(e.ownerId)){if(this.ts(e)&&this.networkEnabled)return!0;if(!this.ts(e)){if(!e.allowTabSynchronization)throw new wr(yr.FAILED_PRECONDITION,Ah);return!1}}return!(!this.networkEnabled||!this.inForeground)||Ch(t).qt().next(e=>void 0===this.rs(e,5e3).find(e=>{if(this.clientId!==e.clientId){var t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,e=this.networkEnabled===e.networkEnabled;if(t||n&&e)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&lr("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.xn=!1,this.us(),this.Mn&&(this.Mn.cancel(),this.Mn=null),this.hs(),this.ls(),await this.Ln.runTransaction("shutdown","readwrite",[Do.store,jo.store],e=>{const t=new ca(e,Nr.A);return this.Xn(t).next(()=>this.es(t))}),this.Ln.close(),this.fs()}rs(e,t){return e.filter(e=>this.ss(e.updateTimeMs,t)&&!this.cs(e.clientId))}ds(){return this.runTransaction("getActiveClients","readonly",e=>Ch(e).qt().next(e=>this.rs(e,18e5).map(e=>e.clientId)))}get started(){return this.xn}getMutationQueue(e,t){return eh.Jt(e,this.O,t,this.referenceDelegate)}getTargetCache(){return this.Un}getRemoteDocumentCache(){return this.qn}getIndexManager(e){return new $a(e)}getDocumentOverlayCache(e){return Oa.Jt(this.O,e)}getBundleCache(){return this.Kn}runTransaction(t,n,r){lr("IndexedDbPersistence","Starting transaction:",t);var e="readonly"===n?"readonly":"readwrite",s=13===(s=this.schemaVersion)?Xo:12===s?Yo:11===s?Wo:void mr();let i;return this.Ln.runTransaction(t,e,s,e=>(i=new ca(e,this.Nn?this.Nn.next():Nr.A),"readwrite-primary"===n?this.Jn(i).next(e=>!!e||this.Yn(i)).next(e=>{if(!e)throw dr(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Sn.enqueueRetryable(()=>this.Fn(!1)),new wr(yr.FAILED_PRECONDITION,Jo);return r(i)}).next(e=>this.Zn(i).next(()=>e)):this._s(i).next(()=>r(i)))).then(e=>(i.raiseOnCommittedEvent(),e))}_s(e){return Nh(e).get(Do.key).next(e=>{if(null!==e&&this.ss(e.leaseTimestampMs,5e3)&&!this.cs(e.ownerId)&&!this.ts(e)&&!(this.Cn||this.allowTabSynchronization&&e.allowTabSynchronization))throw new wr(yr.FAILED_PRECONDITION,Ah)})}Zn(e){var t=new Do(this.clientId,this.allowTabSynchronization,Date.now());return Nh(e).put(Do.key,t)}static Vt(){return na.Vt()}Xn(e){const t=Nh(e);return t.get(Do.key).next(e=>this.ts(e)?(lr("IndexedDbPersistence","Releasing primary lease."),t.delete(Do.key)):ea.resolve())}ss(e,t){var n=Date.now();return!(e<n-t||n<e&&(dr(`Detected an update time that is in the future: ${e} > ${n}`),1))}Qn(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.On=()=>{this.Sn.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.jn()))},this.document.addEventListener("visibilitychange",this.On),this.inForeground="visible"===this.document.visibilityState)}hs(){this.On&&(this.document.removeEventListener("visibilitychange",this.On),this.On=null)}Wn(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.kn=()=>{this.us(),!function(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return}}()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")&&navigator.appVersion.match(/Version\/1[45]/)&&this.Sn.enterRestrictedMode(!0),this.Sn.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.kn))}ls(){this.kn&&(this.window.removeEventListener("pagehide",this.kn),this.kn=null)}cs(e){var t;try{var n=null!==(null===(t=this.Gn)||void 0===t?void 0:t.getItem(this.os(e)));return lr("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return dr("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}us(){if(this.Gn)try{this.Gn.setItem(this.os(this.clientId),String(Date.now()))}catch(e){dr("Failed to set zombie client id.",e)}}fs(){if(this.Gn)try{this.Gn.removeItem(this.os(this.clientId))}catch(e){}}os(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Nh(e){return la(e,Do.store)}function Ch(e){return la(e,jo.store)}function Dh(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class kh{constructor(e,t){this.progress=e,this.ws=t}}class Oh{constructor(e,t,n){this.qn=e,this.gs=t,this.indexManager=n}ys(t,n){return this.gs.getAllMutationBatchesAffectingDocumentKey(t,n).next(e=>this.ps(t,n,e))}ps(e,t,n){return this.qn.getEntry(e,t).next(e=>{for(const t of n)t.applyToLocalView(e);return e})}Is(e,n){e.forEach((e,t)=>{for(const e of n)e.applyToLocalView(t)})}Es(t,e){return this.qn.getEntries(t,e).next(e=>this.Ts(t,e).next(()=>e))}Ts(e,t){return this.gs.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>this.Is(t,e))}As(e,t,n){return r=t,ts.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.Rs(e,t.path):zs(t)?this.Ps(e,t,n):this.bs(e,t,n);var r}Rs(e,t){return this.ys(e,new ts(t)).next(e=>{let t=Bi;return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}Ps(n,r,s){const i=r.collectionGroup;let o=Bi;return this.indexManager.getCollectionParents(n,i).next(e=>ea.forEach(e,e=>{var t=(t=r,e=e.child(i),new qs(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt));return this.bs(n,t,s).next(e=>{e.forEach((e,t)=>{o=o.insert(e,t)})})}).next(()=>o))}bs(t,n,e){let s;return this.qn.getAll(t,n.path,e).next(e=>(s=e,this.gs.getAllMutationBatchesAffectingQuery(t,n))).next(t=>{for(const r of t)for(const t of r.mutations){var n=t.key;let e=s.get(n);null==e&&(e=ys.newInvalidDocument(n),s=s.insert(n,e)),bi(t,e,r.localWriteTime),e.isFoundDocument()||(s=s.remove(n))}}).next(()=>(s.forEach((e,t)=>{ei(n,t)||(s=s.remove(e))}),s))}}class Rh{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.vs=n,this.Vs=r}static Ss(e,t){let n=Gi(),r=Gi();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new Rh(e,t.fromCache,n,r)}}class Lh{Ds(e){this.Cs=e}As(t,r,s,i){return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())||s.isEqual(Lr.min())?this.Ns(t,r):this.Cs.Es(t,i).next(e=>{const n=this.xs(r,e);return(Ks(r)||Gs(r))&&this.ks(r.limitType,n,i,s)?this.Ns(t,r):(cr()<=l.DEBUG&&lr("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Zs(r)),this.Cs.As(t,r,s).next(t=>(n.forEach(e=>{t=t.insert(e.key,e)}),t)))})}xs(n,e){let r=new Fi(ti(n));return e.forEach((e,t)=>{ei(n,t)&&(r=r.add(t))}),r}ks(e,t,n,r){if(n.size!==t.size)return!0;const s="F"===e?t.last():t.first();return!!s&&(s.hasPendingWrites||0<s.version.compareTo(r))}Ns(e,t){return cr()<=l.DEBUG&&lr("QueryEngine","Using full collection scan to execute query:",Zs(t)),this.Cs.As(e,t,Lr.min())}}class Mh{constructor(e,t,n,r){this.persistence=e,this.Os=t,this.O=r,this.Ms=new Li(Dr),this.$s=new yh(e=>Ss(e),_s),this.Fs=Lr.min(),this.Bs=e.getRemoteDocumentCache(),this.Un=e.getTargetCache(),this.Kn=e.getBundleCache(),this.Ls(n)}Ls(e){this.indexManager=this.persistence.getIndexManager(e),this.gs=this.persistence.getMutationQueue(e,this.indexManager),this.Us=new Oh(this.Bs,this.gs,this.indexManager),this.Bs.setIndexManager(this.indexManager),this.Os.Ds(this.Us)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Ms))}}function Ph(e,t,n,r){return new Mh(e,t,n,r)}async function Fh(e,t){const o=e;return o.persistence.runTransaction("Handle user change","readonly",s=>{let i;return o.gs.getAllMutationBatches(s).next(e=>(i=e,o.Ls(t),o.gs.getAllMutationBatches(s))).next(e=>{const t=[],n=[];let r=Gi();for(const s of i){t.push(s.batchId);for(const e of s.mutations)r=r.add(e.key)}for(const s of e){n.push(s.batchId);for(const e of s.mutations)r=r.add(e.key)}return o.Us.Es(s,r).next(e=>({qs:e,removedBatchIds:t,addedBatchIds:n}))})})}function Vh(e){const t=e;return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Un.getLastRemoteSnapshotVersion(e))}function Uh(e,i,t){let n=Gi();return t.forEach(e=>n=n.add(e)),i.getEntries(e,n).next(r=>{let s=qi;return t.forEach((e,t)=>{const n=r.get(e);t.isNoDocument()&&t.version.isEqual(Lr.min())?(i.removeEntry(e,t.readTime),s=s.insert(e,t)):!n.isValidDocument()||0<t.version.compareTo(n.version)||0===t.version.compareTo(n.version)&&n.hasPendingWrites?(i.addEntry(t),s=s.insert(e,t)):lr("LocalStore","Ignoring outdated watch update for ",e,". Current version:",n.version," Watch version:",t.version)}),s})}function qh(e,r){const s=e;return s.persistence.runTransaction("Allocate target","readwrite",t=>{let n;return s.Un.getTargetData(t,r).next(e=>e?(n=e,ea.resolve(n)):s.Un.allocateTargetId(t).next(e=>(n=new ma(r,e,0,t.currentSequenceNumber),s.Un.addTargetData(t,n).next(()=>n))))}).then(e=>{var t=s.Ms.get(e.targetId);return(null===t||0<e.snapshotVersion.compareTo(t.snapshotVersion))&&(s.Ms=s.Ms.insert(e.targetId,e),s.$s.set(r,e.targetId)),e})}async function Bh(e,t,n){const r=e,s=r.Ms.get(t),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,e=>r.persistence.referenceDelegate.removeTarget(e,s))}catch(e){if(!ia(e))throw e;lr("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.Ms=r.Ms.remove(t),r.$s.delete(s.target)}function jh(e,n,r){const s=e;let i=Lr.min(),o=Gi();return s.persistence.runTransaction("Execute query","readonly",t=>function(e,t,n){const r=e,s=r.$s.get(n);return void 0!==s?ea.resolve(r.Ms.get(s)):r.Un.getTargetData(t,n)}(s,t,Ws(n)).next(e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,s.Un.getMatchingKeysForTargetId(t,e.targetId).next(e=>{o=e})}).next(()=>s.Os.As(t,n,r?i:Lr.min(),r?o:Gi())).next(e=>({documents:e,Ks:o})))}function Kh(e,t){const n=e,r=n.Un,s=n.Ms.get(t);return s?Promise.resolve(s.target):n.persistence.runTransaction("Get target data","readonly",e=>r.Tt(e,t).next(e=>e?e.target:null))}function Gh(e){const n=e;return n.persistence.runTransaction("Get new document changes","readonly",e=>function(e,t,n){const r=e;let s=qi,i=va(n);const o=Th(t),a=IDBKeyRange.lowerBound(i,!0);return o.Qt({index:Po.readTimeIndex,range:a},(e,t)=>{var n=ya(r.O,t);s=s.insert(n.key,n),i=t.readTime}).next(()=>({ws:s,readTime:Ia(i)}))}(n.Bs,e,n.Fs)).then(({ws:e,readTime:t})=>(n.Fs=t,e))}class $h{constructor(e){this.O=e,this.Ws=new Map,this.zs=new Map}getBundleMetadata(e,t){return ea.resolve(this.Ws.get(t))}saveBundleMetadata(e,t){return this.Ws.set(t.id,{id:t.id,version:t.version,createTime:oo(t.createTime)}),ea.resolve()}getNamedQuery(e,t){return ea.resolve(this.zs.get(t))}saveNamedQuery(e,t){return this.zs.set(t.name,{name:t.name,query:Aa(t.bundledQuery),readTime:oo(t.readTime)}),ea.resolve()}}class Qh{constructor(){this.overlays=new Li(ts.comparator),this.Hs=new Map}getOverlay(e,t){return ea.resolve(this.overlays.get(t))}saveOverlays(t,n,e){return e.forEach(e=>{this.Yt(t,n,e)}),ea.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.Hs.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.Hs.delete(n)),ea.resolve()}getOverlaysForCollection(e,t,n){const r=new Map,s=t.length+1,i=new ts(t.child("")),o=this.overlays.getIteratorFrom(i);for(;o.hasNext();){const e=o.getNext().value,i=e.getKey();if(!t.isPrefixOf(i.path))break;i.path.length===s&&e.largestBatchId>n&&r.set(e.getKey(),e)}return ea.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let s=new Li((e,t)=>e-t);const i=this.overlays.getIterator();for(;i.hasNext();){const t=i.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=s.get(t.largestBatchId);null===e&&(e=new Map,s=s.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=new Map,a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((e,t)=>o.set(t,e)),!(o.size>=r)););return ea.resolve(o)}Yt(e,t,n){if(null!==n){var r=this.overlays.get(n.key);null!==r&&this.Hs.get(r.largestBatchId).delete(n.key),this.overlays=this.overlays.insert(n.key,new ga(t,n));let e=this.Hs.get(t);void 0===e&&(e=new Set,this.Hs.set(t,e)),e.add(n.key)}}}class zh{constructor(){this.Js=new Fi(Hh.Ys),this.Xs=new Fi(Hh.Zs)}isEmpty(){return this.Js.isEmpty()}addReference(e,t){t=new Hh(e,t);this.Js=this.Js.add(t),this.Xs=this.Xs.add(t)}ti(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.ei(new Hh(e,t))}ni(e,t){e.forEach(e=>this.removeReference(e,t))}si(e){const t=new ts(new Ur([])),n=new Hh(t,e),r=new Hh(t,e+1),s=[];return this.Xs.forEachInRange([n,r],e=>{this.ei(e),s.push(e.key)}),s}ii(){this.Js.forEach(e=>this.ei(e))}ei(e){this.Js=this.Js.delete(e),this.Xs=this.Xs.delete(e)}ri(e){var t=new ts(new Ur([])),n=new Hh(t,e),t=new Hh(t,e+1);let r=Gi();return this.Xs.forEachInRange([n,t],e=>{r=r.add(e.key)}),r}containsKey(e){var t=new Hh(e,0);return null!==(t=this.Js.firstAfterOrEqual(t))&&e.isEqual(t.key)}}class Hh{constructor(e,t){this.key=e,this.oi=t}static Ys(e,t){return ts.comparator(e.key,t.key)||Dr(e.oi,t.oi)}static Zs(e,t){return Dr(e.oi,t.oi)||ts.comparator(e.key,t.key)}}class Wh{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.gs=[],this.ci=1,this.ui=new Fi(Hh.Ys)}checkEmpty(e){return ea.resolve(0===this.gs.length)}addMutationBatch(e,t,n,r){var s=this.ci;this.ci++,0<this.gs.length&&this.gs[this.gs.length-1];n=new da(s,t,n,r);this.gs.push(n);for(const t of r)this.ui=this.ui.add(new Hh(t.key,s)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return ea.resolve(n)}lookupMutationBatch(e,t){return ea.resolve(this.ai(t))}getNextMutationBatchAfterBatchId(e,t){t=(t=this.hi(t+1))<0?0:t;return ea.resolve(this.gs.length>t?this.gs[t]:null)}getHighestUnacknowledgedBatchId(){return ea.resolve(0===this.gs.length?-1:this.ci-1)}getAllMutationBatches(e){return ea.resolve(this.gs.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Hh(t,0),r=new Hh(t,Number.POSITIVE_INFINITY),s=[];return this.ui.forEachInRange([n,r],e=>{e=this.ai(e.oi);s.push(e)}),ea.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Fi(Dr);return t.forEach(e=>{var t=new Hh(e,0),e=new Hh(e,Number.POSITIVE_INFINITY);this.ui.forEachInRange([t,e],e=>{n=n.add(e.oi)})}),ea.resolve(this.li(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let s=n;ts.isDocumentKey(s)||(s=s.child(""));t=new Hh(new ts(s),0);let i=new Fi(Dr);return this.ui.forEachWhile(e=>{var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(i=i.add(e.oi)),!0)},t),ea.resolve(this.li(i))}li(e){const t=[];return e.forEach(e=>{e=this.ai(e);null!==e&&t.push(e)}),t}removeMutationBatch(n,r){pr(0===this.fi(r.batchId,"removed")),this.gs.shift();let s=this.ui;return ea.forEach(r.mutations,e=>{var t=new Hh(e.key,r.batchId);return s=s.delete(t),this.referenceDelegate.markPotentiallyOrphaned(n,e.key)}).next(()=>{this.ui=s})}Qe(e){}containsKey(e,t){var n=new Hh(t,0),n=this.ui.firstAfterOrEqual(n);return ea.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.gs.length,ea.resolve()}fi(e,t){return this.hi(e)}hi(e){return 0===this.gs.length?0:e-this.gs[0].batchId}ai(e){e=this.hi(e);return e<0||e>=this.gs.length?null:this.gs[e]}}class Yh{constructor(e){this.di=e,this.docs=new Li(ts.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),s=r?r.size:0,i=this.di(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:i}),this.size+=i-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return ea.resolve(n?n.document.mutableCopy():ys.newInvalidDocument(t))}getEntries(e,t){let n=qi;return t.forEach(e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():ys.newInvalidDocument(e))}),ea.resolve(n)}getAll(e,t,n){let r=qi;const s=new ts(t.child("")),i=this.docs.getIteratorFrom(s);for(;i.hasNext();){const{key:e,value:{document:s}}=i.getNext();if(!t.isPrefixOf(e.path))break;e.path.length>t.length+1||s.readTime.compareTo(n)<=0||(r=r.insert(s.key,s.mutableCopy()))}return ea.resolve(r)}_i(e,t){return ea.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new Xh(this)}getSize(e){return ea.resolve(this.size)}}class Xh extends wh{constructor(e){super(),this.Tn=e}applyChanges(n){const r=[];return this.changes.forEach((e,t)=>{t.isValidDocument()?r.push(this.Tn.addEntry(n,t)):this.Tn.removeEntry(e)}),ea.waitFor(r)}getFromCache(e,t){return this.Tn.getEntry(e,t)}getAllFromCache(e,t){return this.Tn.getEntries(e,t)}}class Jh{constructor(e){this.persistence=e,this.wi=new yh(e=>Ss(e),_s),this.lastRemoteSnapshotVersion=Lr.min(),this.highestTargetId=0,this.mi=0,this.gi=new zh,this.targetCount=0,this.yi=ih.He()}forEachTarget(e,n){return this.wi.forEach((e,t)=>n(t)),ea.resolve()}getLastRemoteSnapshotVersion(e){return ea.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ea.resolve(this.mi)}allocateTargetId(e){return this.highestTargetId=this.yi.next(),ea.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.mi&&(this.mi=t),ea.resolve()}Ze(e){this.wi.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.yi=new ih(t),this.highestTargetId=t),e.sequenceNumber>this.mi&&(this.mi=e.sequenceNumber)}addTargetData(e,t){return this.Ze(t),this.targetCount+=1,ea.resolve()}updateTargetData(e,t){return this.Ze(t),ea.resolve()}removeTargetData(e,t){return this.wi.delete(t.target),this.gi.si(t.targetId),--this.targetCount,ea.resolve()}removeTargets(n,r,s){let i=0;const o=[];return this.wi.forEach((e,t)=>{t.sequenceNumber<=r&&null===s.get(t.targetId)&&(this.wi.delete(e),o.push(this.removeMatchingKeysForTargetId(n,t.targetId)),i++)}),ea.waitFor(o).next(()=>i)}getTargetCount(e){return ea.resolve(this.targetCount)}getTargetData(e,t){t=this.wi.get(t)||null;return ea.resolve(t)}addMatchingKeys(e,t,n){return this.gi.ti(t,n),ea.resolve()}removeMatchingKeys(t,e,n){this.gi.ni(e,n);const r=this.persistence.referenceDelegate,s=[];return r&&e.forEach(e=>{s.push(r.markPotentiallyOrphaned(t,e))}),ea.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.gi.si(t),ea.resolve()}getMatchingKeysForTargetId(e,t){t=this.gi.ri(t);return ea.resolve(t)}containsKey(e,t){return ea.resolve(this.gi.containsKey(t))}}class Zh{constructor(e,t){this.pi={},this.overlays={},this.Nn=new Nr(0),this.xn=!1,this.xn=!0,this.referenceDelegate=e(this),this.Un=new Jh(this),this.indexManager=new Ka,this.qn=(e=e=>this.referenceDelegate.Ii(e),new Yh(e)),this.O=new pa(t),this.Kn=new $h(this.O)}start(){return Promise.resolve()}shutdown(){return this.xn=!1,Promise.resolve()}get started(){return this.xn}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Qh,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.pi[e.toKey()];return n||(n=new Wh(t,this.referenceDelegate),this.pi[e.toKey()]=n),n}getTargetCache(){return this.Un}getRemoteDocumentCache(){return this.qn}getBundleCache(){return this.Kn}runTransaction(e,t,n){lr("MemoryPersistence","Starting transaction:",e);const r=new eu(this.Nn.next());return this.referenceDelegate.Ei(),n(r).next(e=>this.referenceDelegate.Ti(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ai(t,n){return ea.or(Object.values(this.pi).map(e=>()=>e.containsKey(t,n)))}}class eu extends Zo{constructor(e){super(),this.currentSequenceNumber=e}}class tu{constructor(e){this.persistence=e,this.Ri=new zh,this.Pi=null}static bi(e){return new tu(e)}get vi(){if(this.Pi)return this.Pi;throw mr()}addReference(e,t,n){return this.Ri.addReference(n,t),this.vi.delete(n.toString()),ea.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.vi.add(n.toString()),ea.resolve()}markPotentiallyOrphaned(e,t){return this.vi.add(t.toString()),ea.resolve()}removeTarget(e,t){this.Ri.si(t.targetId).forEach(e=>this.vi.add(e.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.vi.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ei(){this.Pi=new Set}Ti(n){const r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ea.forEach(this.vi,e=>{const t=ts.fromPath(e);return this.Vi(n,t).next(e=>{e||r.removeEntry(t,Lr.min())})}).next(()=>(this.Pi=null,r.apply(n)))}updateLimboDocument(e,t){return this.Vi(e,t).next(e=>{e?this.vi.delete(t.toString()):this.vi.add(t.toString())})}Ii(e){return 0}Vi(e,t){return ea.or([()=>ea.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}function nu(e,t){return`firestore_clients_${e}_${t}`}function ru(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function su(e,t){return`firestore_targets_${e}_${t}`}class iu{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static Si(e,t,n){var r=JSON.parse(n);let s,i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code,i&&(s=new wr(r.error.code,r.error.message))),i?new iu(e,t,r.state,s):(dr("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Di(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ou{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Si(e,t){var n=JSON.parse(t);let r,s="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code,s&&(r=new wr(n.error.code,n.error.message))),s?new ou(e,n.state,r):(dr("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Di(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class au{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Si(e,t){var n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,s=$i;for(let e=0;r&&e<n.activeTargetIds.length;++e)r=es(n.activeTargetIds[e]),s=s.add(n.activeTargetIds[e]);return r?new au(e,s):(dr("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class hu{constructor(e,t){this.clientId=e,this.onlineState=t}static Si(e){var t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new hu(t.clientId,t.onlineState):(dr("SharedClientState",`Failed to parse online state: ${e}`),null)}}class uu{constructor(){this.activeTargetIds=$i}Ci(e){this.activeTargetIds=this.activeTargetIds.add(e)}Ni(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Di(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class cu{constructor(e,t,n,r,s){this.window=e,this.Sn=t,this.persistenceKey=n,this.xi=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ki=this.Oi.bind(this),this.Mi=new Li(Dr),this.started=!1,this.$i=[];n=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Fi=nu(this.persistenceKey,this.xi),this.Bi=`firestore_sequence_number_${this.persistenceKey}`,this.Mi=this.Mi.insert(this.xi,new uu),this.Li=new RegExp(`^firestore_clients_${n}_([^_]*)$`),this.Ui=new RegExp(`^firestore_mutations_${n}_(\\d+)(?:_(.*))?$`),this.qi=new RegExp(`^firestore_targets_${n}_(\\d+)$`),this.Ki=`firestore_online_state_${this.persistenceKey}`,this.Gi=`firestore_bundle_loaded_${this.persistenceKey}`,this.window.addEventListener("storage",this.ki)}static Vt(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.ds();for(const n of e)if(n!==this.xi){const e=this.getItem(nu(this.persistenceKey,n));var t;!e||(t=au.Si(n,e))&&(this.Mi=this.Mi.insert(t.clientId,t))}this.ji();const n=this.storage.getItem(this.Ki);if(n){const e=this.Qi(n);e&&this.Wi(e)}for(const e of this.$i)this.Oi(e);this.$i=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.Bi,JSON.stringify(e))}getAllActiveQueryTargets(){return this.zi(this.Mi)}isActiveQueryTarget(n){let r=!1;return this.Mi.forEach((e,t)=>{t.activeTargetIds.has(n)&&(r=!0)}),r}addPendingMutation(e){this.Hi(e,"pending")}updateMutationState(e,t,n){this.Hi(e,t,n),this.Ji(e)}addLocalQueryTarget(e){let t="not-current";var n;return this.isActiveQueryTarget(e)&&(!(n=this.storage.getItem(su(this.persistenceKey,e)))||(n=ou.Si(e,n))&&(t=n.state)),this.Yi.Ci(e),this.ji(),t}removeLocalQueryTarget(e){this.Yi.Ni(e),this.ji()}isLocalQueryTarget(e){return this.Yi.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(su(this.persistenceKey,e))}updateQueryState(e,t,n){this.Xi(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.Ji(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.Zi(e)}notifyBundleLoaded(){this.tr()}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ki),this.removeItem(this.Fi),this.started=!1)}getItem(e){var t=this.storage.getItem(e);return lr("SharedClientState","READ",e,t),t}setItem(e,t){lr("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){lr("SharedClientState","REMOVE",e),this.storage.removeItem(e)}Oi(e){const r=e;r.storageArea===this.storage&&(lr("SharedClientState","EVENT",r.key,r.newValue),r.key!==this.Fi?this.Sn.enqueueRetryable(async()=>{if(this.started){if(null!==r.key)if(this.Li.test(r.key)){if(null==r.newValue){var e=this.er(r.key);return this.nr(e,null)}if(e=this.sr(r.key,r.newValue))return this.nr(e.clientId,e)}else if(this.Ui.test(r.key)){if(null!==r.newValue){var t=this.ir(r.key,r.newValue);if(t)return this.rr(t)}}else if(this.qi.test(r.key)){if(null!==r.newValue&&(t=this.cr(r.key,r.newValue)))return this.ur(t)}else if(r.key===this.Ki){if(null!==r.newValue){var n=this.Qi(r.newValue);if(n)return this.Wi(n)}}else if(r.key===this.Bi)(n=function(e){let t=Nr.A;if(null!=e)try{var n=JSON.parse(e);pr("number"==typeof n),t=n}catch(e){dr("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(r.newValue))!==Nr.A&&this.sequenceNumberHandler(n);else if(r.key===this.Gi)return this.syncEngine.ar()}else this.$i.push(r)}):dr("Received WebStorage notification for local change. Another client might have garbage-collected our state"))}get Yi(){return this.Mi.get(this.xi)}ji(){this.setItem(this.Fi,this.Yi.Di())}Hi(e,t,n){const r=new iu(this.currentUser,e,t,n),s=ru(this.persistenceKey,this.currentUser,e);this.setItem(s,r.Di())}Ji(e){e=ru(this.persistenceKey,this.currentUser,e);this.removeItem(e)}Zi(e){e={clientId:this.xi,onlineState:e};this.storage.setItem(this.Ki,JSON.stringify(e))}Xi(e,t,n){const r=su(this.persistenceKey,e),s=new ou(e,t,n);this.setItem(r,s.Di())}tr(){this.setItem(this.Gi,"value-not-used")}er(e){e=this.Li.exec(e);return e?e[1]:null}sr(e,t){e=this.er(e);return au.Si(e,t)}ir(e,t){var n=this.Ui.exec(e),e=Number(n[1]),n=void 0!==n[2]?n[2]:null;return iu.Si(new ar(n),e,t)}cr(e,t){e=this.qi.exec(e),e=Number(e[1]);return ou.Si(e,t)}Qi(e){return hu.Si(e)}async rr(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.hr(e.batchId,e.state,e.error);lr("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}ur(e){return this.syncEngine.lr(e.targetId,e.state,e.error)}nr(e,t){const n=t?this.Mi.insert(e,t):this.Mi.remove(e),r=this.zi(this.Mi),s=this.zi(n),i=[],o=[];return s.forEach(e=>{r.has(e)||i.push(e)}),r.forEach(e=>{s.has(e)||o.push(e)}),this.syncEngine.dr(i,o).then(()=>{this.Mi=n})}Wi(e){this.Mi.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}zi(e){let n=$i;return e.forEach((e,t)=>{n=n.unionWith(t.activeTargetIds)}),n}}class lu{constructor(){this._r=new uu,this.wr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this._r.Ci(e),this.wr[e]||"not-current"}updateQueryState(e,t,n){this.wr[e]=t}removeLocalQueryTarget(e){this._r.Ni(e)}isLocalQueryTarget(e){return this._r.activeTargetIds.has(e)}clearQueryState(e){delete this.wr[e]}getAllActiveQueryTargets(){return this._r.activeTargetIds}isActiveQueryTarget(e){return this._r.activeTargetIds.has(e)}start(){return this._r=new uu,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(){}}class du{mr(e){}shutdown(){}}class fu{constructor(){this.gr=()=>this.yr(),this.pr=()=>this.Ir(),this.Er=[],this.Tr()}mr(e){this.Er.push(e)}shutdown(){window.removeEventListener("online",this.gr),window.removeEventListener("offline",this.pr)}Tr(){window.addEventListener("online",this.gr),window.addEventListener("offline",this.pr)}yr(){lr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Er)e(0)}Ir(){lr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Er)e(1)}static Vt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const gu={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class mu{constructor(e){this.Ar=e.Ar,this.Rr=e.Rr}Pr(e){this.br=e}vr(e){this.Vr=e}onMessage(e){this.Sr=e}close(){this.Rr()}send(e){this.Ar(e)}Dr(){this.br()}Cr(e){this.Vr(e)}Nr(e){this.Sr(e)}}class pu extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;var t=e.ssl?"https":"http";this.kr=t+"://"+e.host,this.Or="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Mr(t,e,n,r,s){const i=this.$r(t,e);lr("RestConnection","Sending: ",i,n);e={};return this.Fr(e,r,s),this.Br(t,i,e,n).then(e=>(lr("RestConnection","Received: ",e),e),e=>{throw fr("RestConnection",`${t} failed with error: `,e,"url: ",i,"request:",n),e})}Lr(e,t,n,r,s){return this.Mr(e,t,n,r,s)}Fr(n,e,t){n["X-Goog-Api-Client"]="gl-js/ fire/"+hr,n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((e,t)=>n[t]=e),t&&t.headers.forEach((e,t)=>n[t]=e)}$r(e,t){e=gu[e];return`${this.kr}/v1/${t}:${e}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}Br(a,t,n,r){return new Promise((s,i)=>{const o=new or;o.listenOnce(nr.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case tr.NO_ERROR:var e=o.getResponseJson();lr("Connection","XHR received:",JSON.stringify(e)),s(e);break;case tr.TIMEOUT:lr("Connection",'RPC "'+a+'" timed out'),i(new wr(yr.DEADLINE_EXCEEDED,"Request time out"));break;case tr.HTTP_ERROR:var t,n=o.getStatus();if(lr("Connection",'RPC "'+a+'" failed with status:',n,"response text:",o.getResponseText()),0<n){const a=o.getResponseJson().error;a&&a.status&&a.message?(r=a.status.toLowerCase().replace(/_/g,"-"),t=0<=Object.values(yr).indexOf(r)?r:yr.UNKNOWN,i(new wr(t,a.message))):i(new wr(yr.UNKNOWN,"Server responded with status "+o.getStatus()))}else i(new wr(yr.UNAVAILABLE,"Connection failed."));break;default:mr()}}finally{lr("Connection",'RPC "'+a+'" completed.')}var r});var e=JSON.stringify(r);o.send(t,"POST",e,n,15)})}Ur(e,t,n){const r=[this.kr,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=new zn,i=er(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new sr({})),this.Fr(o.initMessageHeaders,t,n),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(f())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=f().indexOf("Electron/")||function(){const e=f();return 0<=e.indexOf("MSIE ")||0<=e.indexOf("Trident/")}()||0<=f().indexOf("MSAppHost/")||"object"==typeof(a="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==a.id||(o.httpHeadersOverwriteParam="$httpHeaders");var a=r.join("");lr("Connection","Creating WebChannel: "+a,o);const h=s.createWebChannel(a,o);let u=!1,c=!1;const l=new mu({Ar:e=>{c?lr("Connection","Not sending because WebChannel is closed:",e):(u||(lr("Connection","Opening WebChannel transport."),h.open(),u=!0),lr("Connection","WebChannel sending:",e),h.send(e))},Rr:()=>h.close()}),d=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return d(h,ir.EventType.OPEN,()=>{c||lr("Connection","WebChannel transport opened.")}),d(h,ir.EventType.CLOSE,()=>{c||(c=!0,lr("Connection","WebChannel transport closed"),l.Cr())}),d(h,ir.EventType.ERROR,e=>{c||(c=!0,fr("Connection","WebChannel transport errored:",e),l.Cr(new wr(yr.UNAVAILABLE,"The operation could not be completed")))}),d(h,ir.EventType.MESSAGE,e=>{if(!c){e=e.data[0];pr(!!e);var n=e.error||(null===(n=e[0])||void 0===n?void 0:n.error);if(n){lr("Connection","WebChannel received error:",n);const r=n.status;let e=function(e){e=Jn[e];if(void 0!==e)return Ri(e)}(r),t=n.message;void 0===e&&(e=yr.INTERNAL,t="Unknown error status: "+r+" with message "+n.message),c=!0,l.Cr(new wr(e,t)),h.close()}else lr("Connection","WebChannel received:",e),l.Nr(e)}}),d(i,rr.STAT_EVENT,e=>{10===e.stat?lr("Connection","Detected buffering proxy"):11===e.stat&&lr("Connection","Detected no buffering proxy")}),setTimeout(()=>{l.Dr()},0),l}}function yu(){return"undefined"!=typeof window?window:null}function wu(){return"undefined"!=typeof document?document:null}function vu(e){return new ro(e,!0)}class Iu{constructor(e,t,n=1e3,r=1.5,s=6e4){this.Sn=e,this.timerId=t,this.qr=n,this.Kr=r,this.Gr=s,this.jr=0,this.Qr=null,this.Wr=Date.now(),this.reset()}reset(){this.jr=0}zr(){this.jr=this.Gr}Hr(e){this.cancel();var t=Math.floor(this.jr+this.Jr()),n=Math.max(0,Date.now()-this.Wr),r=Math.max(0,t-n);0<r&&lr("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.jr} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Qr=this.Sn.enqueueAfterDelay(this.timerId,r,()=>(this.Wr=Date.now(),e())),this.jr*=this.Kr,this.jr<this.qr&&(this.jr=this.qr),this.jr>this.Gr&&(this.jr=this.Gr)}Yr(){null!==this.Qr&&(this.Qr.skipDelay(),this.Qr=null)}cancel(){null!==this.Qr&&(this.Qr.cancel(),this.Qr=null)}Jr(){return(Math.random()-.5)*this.jr}}class bu{constructor(e,t,n,r,s,i,o,a){this.Sn=e,this.Xr=n,this.Zr=r,this.eo=s,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.no=0,this.so=null,this.io=null,this.stream=null,this.ro=new Iu(e,t)}oo(){return 1===this.state||5===this.state||this.co()}co(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.uo()}async stop(){this.oo()&&await this.close(0)}ao(){this.state=0,this.ro.reset()}ho(){this.co()&&null===this.so&&(this.so=this.Sn.enqueueAfterDelay(this.Xr,6e4,()=>this.lo()))}fo(e){this._o(),this.stream.send(e)}async lo(){if(this.co())return this.close(0)}_o(){this.so&&(this.so.cancel(),this.so=null)}wo(){this.io&&(this.io.cancel(),this.io=null)}async close(e,t){this._o(),this.wo(),this.ro.cancel(),this.no++,4!==e?this.ro.reset():t&&t.code===yr.RESOURCE_EXHAUSTED?(dr(t.toString()),dr("Using maximum backoff delay to prevent overloading the backend."),this.ro.zr()):t&&t.code===yr.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.mo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.vr(t)}mo(){}auth(){this.state=1;const e=this.yo(this.no),n=this.no;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,t])=>{this.no===n&&this.po(e,t)},t=>{e(()=>{var e=new wr(yr.UNKNOWN,"Fetching auth token failed: "+t.message);return this.Io(e)})})}po(e,t){const n=this.yo(this.no);this.stream=this.Eo(e,t),this.stream.Pr(()=>{n(()=>(this.state=2,this.io=this.Sn.enqueueAfterDelay(this.Zr,1e4,()=>(this.co()&&(this.state=3),Promise.resolve())),this.listener.Pr()))}),this.stream.vr(e=>{n(()=>this.Io(e))}),this.stream.onMessage(e=>{n(()=>this.onMessage(e))})}uo(){this.state=5,this.ro.Hr(async()=>{this.state=0,this.start()})}Io(e){return lr("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}yo(t){return e=>{this.Sn.enqueueAndForget(()=>this.no===t?e():(lr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Tu extends bu{constructor(e,t,n,r,s,i){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,i),this.O=s}Eo(e,t){return this.eo.Ur("Listen",e,t)}onMessage(e){this.ro.reset();var t=function(e,t){let n;if("targetChange"in t){t.targetChange;var r="NO_CHANGE"===(f=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===f?1:"REMOVE"===f?2:"CURRENT"===f?3:"RESET"===f?4:mr(),s=t.targetChange.targetIds||[],i=(f=t.targetChange.resumeToken,e.N?(pr(void 0===f||"string"==typeof f),Kr.fromBase64String(f||"")):(pr(void 0===f||f instanceof Uint8Array),Kr.fromUint8Array(f||new Uint8Array))),o=t.targetChange.cause,a=o&&(a=void 0===(f=o).code?yr.UNKNOWN:Ri(f.code),new wr(a,f.message||""));n=new Yi(r,s,i,a||null)}else if("documentChange"in t){t.documentChange,(c=t.documentChange).document,c.document.name,c.document.updateTime;var a=co(e,c.document.name),h=oo(c.document.updateTime),u=new ps({mapValue:{fields:c.document.fields}}),h=ys.newFoundDocument(a,h,u),u=c.targetIds||[],c=c.removedTargetIds||[];n=new Hi(u,c,h.key,h)}else if("documentDelete"in t)t.documentDelete,(u=t.documentDelete).document,c=co(e,u.document),h=u.readTime?oo(u.readTime):Lr.min(),h=ys.newNoDocument(c,h),u=u.removedTargetIds||[],n=new Hi([],u,h.key,h);else if("documentRemove"in t){t.documentRemove,(d=t.documentRemove).document;var l=co(e,d.document),d=d.removedTargetIds||[];n=new Hi([],d,l,null)}else{if(!("filter"in t))return mr();{t.filter;const e=t.filter;e.targetId,d=e.count||0,l=new ki(d),d=e.targetId,n=new Wi(d,l)}}var f;return n}(this.O,e),e=function(e){if(!("targetChange"in e))return Lr.min();e=e.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?Lr.min():oo(e.readTime)}(e);return this.listener.To(t,e)}Ao(e){const t={};t.database=go(this.O),t.addTarget=function(e,t){let n;var r=t.target;return n=As(r)?{documents:Io(e,r)}:{query:bo(e,r)},n.targetId=t.targetId,0<t.resumeToken.approximateByteSize()?n.resumeToken=io(e,t.resumeToken):0<t.snapshotVersion.compareTo(Lr.min())&&(n.readTime=so(e,t.snapshotVersion.toTimestamp())),n}(this.O,e);var n,e=(this.O,n=e,null==(e=function(){switch(n.purpose){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return mr()}}())?null:{"goog-listen-tags":e});e&&(t.labels=e),this.fo(t)}Ro(e){const t={};t.database=go(this.O),t.removeTarget=e,this.fo(t)}}class Eu extends bu{constructor(e,t,n,r,s,i){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,i),this.O=s,this.Po=!1}get bo(){return this.Po}start(){this.Po=!1,this.lastStreamToken=void 0,super.start()}mo(){this.Po&&this.vo([])}Eo(e,t){return this.eo.Ur("Write",e,t)}onMessage(e){if(pr(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Po){this.ro.reset();var t=(n=e.writeResults,r=e.commitTime,n&&0<n.length?(pr(void 0!==r),n.map(e=>function(e,t){let n=e.updateTime?oo(e.updateTime):oo(t);return n.isEqual(Lr.min())&&(n=oo(t)),new pi(n,e.transformResults||[])}(e,r))):[]),n=oo(e.commitTime);return this.listener.Vo(n,t)}var n,r;return pr(!e.writeResults||0===e.writeResults.length),this.Po=!0,this.listener.So()}Do(){const e={};e.database=go(this.O),this.fo(e)}vo(e){e={streamToken:this.lastStreamToken,writes:e.map(e=>wo(this.O,e))};this.fo(e)}}class Su extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.eo=n,this.O=r,this.Co=!1}No(){if(this.Co)throw new wr(yr.FAILED_PRECONDITION,"The client has already been terminated.")}Mr(n,r,s){return this.No(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.eo.Mr(n,r,s,e,t)).catch(e=>{throw"FirebaseError"===e.name?(e.code===yr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new wr(yr.UNKNOWN,e.toString())})}Lr(n,r,s){return this.No(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([e,t])=>this.eo.Lr(n,r,s,e,t)).catch(e=>{throw"FirebaseError"===e.name?(e.code===yr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new wr(yr.UNKNOWN,e.toString())})}terminate(){this.Co=!0}}class _u{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.xo=0,this.ko=null,this.Oo=!0}Mo(){0===this.xo&&(this.$o("Unknown"),this.ko=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.ko=null,this.Fo("Backend didn't respond within 10 seconds."),this.$o("Offline"),Promise.resolve())))}Bo(e){"Online"===this.state?this.$o("Unknown"):(this.xo++,1<=this.xo&&(this.Lo(),this.Fo(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.$o("Offline")))}set(e){this.Lo(),this.xo=0,"Online"===e&&(this.Oo=!1),this.$o(e)}$o(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}Fo(e){e=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Oo?(dr(e),this.Oo=!1):lr("OnlineStateTracker",e)}Lo(){null!==this.ko&&(this.ko.cancel(),this.ko=null)}}class Au{constructor(e,t,n,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Uo=[],this.qo=new Map,this.Ko=new Set,this.Go=[],this.jo=s,this.jo.mr(e=>{n.enqueueAndForget(async()=>{Mu(this)&&(lr("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=e;t.Ko.add(4),await Nu(t),t.Qo.set("Unknown"),t.Ko.delete(4),await xu(t)}(this))})}),this.Qo=new _u(n,r)}}async function xu(e){if(Mu(e))for(const t of e.Go)await t(!0)}async function Nu(e){for(const t of e.Go)await t(!1)}function Cu(e,t){const n=e;n.qo.has(t.targetId)||(n.qo.set(t.targetId,t),Lu(n)?Ru(n):Gu(n).co()&&ku(n,t))}function Du(e,t){const n=e,r=Gu(n);n.qo.delete(t),r.co()&&Ou(n,t),0===n.qo.size&&(r.co()?r.ho():Mu(n)&&n.Qo.set("Unknown"))}function ku(e,t){e.Wo.Z(t.targetId),Gu(e).Ao(t)}function Ou(e,t){e.Wo.Z(t),Gu(e).Ro(t)}function Ru(t){t.Wo=new Ji({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),Tt:e=>t.qo.get(e)||null}),Gu(t).start(),t.Qo.Mo()}function Lu(e){return Mu(e)&&!Gu(e).oo()&&0<e.qo.size}function Mu(e){return 0===e.Ko.size}function Pu(e){e.Wo=void 0}async function Fu(e,t,n){if(!ia(t))throw t;e.Ko.add(1),await Nu(e),e.Qo.set("Offline"),n=n||(()=>Vh(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{lr("RemoteStore","Retrying IndexedDB access"),await n(),e.Ko.delete(1),await xu(e)})}function Vu(t,n){return n().catch(e=>Fu(t,e,n))}async function Uu(e){const t=e,n=$u(t);let r=0<t.Uo.length?t.Uo[t.Uo.length-1].batchId:-1;for(;Mu(s=t)&&s.Uo.length<10;)try{const e=await function(e,t){const n=e;return n.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),n.gs.getNextMutationBatchAfterBatchId(e,t)))}(t.localStore,r);if(null===e){0===t.Uo.length&&n.ho();break}r=e.batchId,function(e,t){e.Uo.push(t);const n=$u(e);n.co()&&n.bo&&n.vo(t.mutations)}(t,e)}catch(e){await Fu(t,e)}var s;qu(t)&&Bu(t)}function qu(e){return Mu(e)&&!$u(e).oo()&&0<e.Uo.length}function Bu(e){$u(e).start()}async function ju(e,t){const n=e;n.asyncQueue.verifyOperationInProgress(),lr("RemoteStore","RemoteStore received new credentials");e=Mu(n);n.Ko.add(3),await Nu(n),e&&n.Qo.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.Ko.delete(3),await xu(n)}async function Ku(e,t){const n=e;t?(n.Ko.delete(2),await xu(n)):(n.Ko.add(2),await Nu(n),n.Qo.set("Unknown"))}function Gu(t){return t.zo||(t.zo=function(e,t,n){const r=e;return r.No(),new Tu(t,r.eo,r.authCredentials,r.appCheckCredentials,r.O,n)}(t.datastore,t.asyncQueue,{Pr:async function(n){n.qo.forEach((e,t)=>{ku(n,e)})}.bind(null,t),vr:async function(e,t){Pu(e),Lu(e)?(e.Qo.Bo(t),Ru(e)):e.Qo.set("Unknown")}.bind(null,t),To:async function(e,r,t){if(e.Qo.set("Online"),r instanceof Yi&&2===r.state&&r.cause)try{await async function(e){var t=r.cause;for(const n of r.targetIds)e.qo.has(n)&&(await e.remoteSyncer.rejectListen(n,t),e.qo.delete(n),e.Wo.removeTarget(n))}(e)}catch(t){lr("RemoteStore","Failed to remove targets %s: %s ",r.targetIds.join(","),t),await Fu(e,t)}else if(r instanceof Hi?e.Wo.ct(r):r instanceof Wi?e.Wo._t(r):e.Wo.ht(r),!t.isEqual(Lr.min()))try{const r=await Vh(e.localStore);0<=t.compareTo(r)&&await function(r,s){const e=r.Wo.yt(s);return e.targetChanges.forEach((e,t)=>{if(0<e.resumeToken.approximateByteSize()){const n=r.qo.get(t);n&&r.qo.set(t,n.withResumeToken(e.resumeToken,s))}}),e.targetMismatches.forEach(e=>{const t=r.qo.get(e);t&&(r.qo.set(e,t.withResumeToken(Kr.EMPTY_BYTE_STRING,t.snapshotVersion)),Ou(r,e),e=new ma(t.target,e,1,t.sequenceNumber),ku(r,e))}),r.remoteSyncer.applyRemoteEvent(e)}(e,t)}catch(r){lr("RemoteStore","Failed to raise snapshot:",r),await Fu(e,r)}}.bind(null,t)}),t.Go.push(async e=>{e?(t.zo.ao(),Lu(t)?Ru(t):t.Qo.set("Unknown")):(await t.zo.stop(),Pu(t))})),t.zo}function $u(t){return t.Ho||(t.Ho=function(e,t,n){const r=e;return r.No(),new Eu(t,r.eo,r.authCredentials,r.appCheckCredentials,r.O,n)}(t.datastore,t.asyncQueue,{Pr:async function(e){$u(e).Do()}.bind(null,t),vr:async function(e,t){t&&$u(e).bo&&await async function(e,t){if(Oi(n=t.code)&&n!==yr.ABORTED){const n=e.Uo.shift();$u(e).ao(),await Vu(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await Uu(e)}var n}(e,t),qu(e)&&Bu(e)}.bind(null,t),So:async function(e){const t=$u(e);for(const n of e.Uo)t.vo(n.mutations)}.bind(null,t),Vo:async function(e,t,n){const r=e.Uo.shift(),s=fa.from(r,t,n);await Vu(e,()=>e.remoteSyncer.applySuccessfulWrite(s)),await Uu(e)}.bind(null,t)}),t.Go.push(async e=>{e?(t.Ho.ao(),await Uu(t)):(await t.Ho.stop(),0<t.Uo.length&&(lr("RemoteStore",`Stopping write stream with ${t.Uo.length} pending writes`),t.Uo=[]))})),t.Ho}class Qu{constructor(e,t,n,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new vr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}static createAndSchedule(e,t,n,r,s){const i=Date.now()+n,o=new Qu(e,t,i,r,s);return o.start(n),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new wr(yr.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function zu(e,t){if(dr("AsyncQueue",`${t}: ${e}`),ia(e))return new wr(yr.UNAVAILABLE,`${t}: ${e}`);throw e}class Hu{constructor(n){this.comparator=n?(e,t)=>n(e,t)||ts.comparator(e.key,t.key):(e,t)=>ts.comparator(e.key,t.key),this.keyedMap=Bi,this.sortedSet=new Li(this.comparator)}static emptySet(e){return new Hu(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){e=this.keyedMap.get(e);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(n){this.sortedSet.inorderTraversal((e,t)=>(n(e),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Hu))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(e,t){const n=new Hu;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Wu{constructor(){this.Jo=new Li(ts.comparator)}track(e){var t=e.doc.key,n=this.Jo.get(t);!n||0!==e.type&&3===n.type?this.Jo=this.Jo.insert(t,e):3===e.type&&1!==n.type?this.Jo=this.Jo.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Jo=this.Jo.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Jo=this.Jo.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Jo=this.Jo.remove(t):1===e.type&&2===n.type?this.Jo=this.Jo.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Jo=this.Jo.insert(t,{type:2,doc:e.doc}):mr()}Yo(){const n=[];return this.Jo.inorderTraversal((e,t)=>{n.push(t)}),n}}class Yu{constructor(e,t,n,r,s,i,o,a){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(e,t,n,r){const s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new Yu(e,t,Hu.emptySet(t),s,n,r,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Xs(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class Xu{constructor(){this.Xo=void 0,this.listeners=[]}}class Ju{constructor(){this.queries=new yh(e=>Js(e),Xs),this.onlineState="Unknown",this.Zo=new Set}}async function Zu(e,t){const n=e,r=t.query;let s=!1,i=n.queries.get(r);if(i||(s=!0,i=new Xu),s)try{i.Xo=await n.onListen(r)}catch(e){const n=zu(e,`Initialization of query '${Zs(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,i),i.listeners.push(t),t.tc(n.onlineState),!i.Xo||t.ec(i.Xo)&&tc(n)}async function ec(e,t){const n=e,r=t.query;let s=!1;const i=n.queries.get(r);if(i){const e=i.listeners.indexOf(t);0<=e&&(i.listeners.splice(e,1),s=0===i.listeners.length)}if(s)return n.queries.delete(r),n.onUnlisten(r)}function tc(e){e.Zo.forEach(e=>{e.next()})}class nc{constructor(e,t,n){this.query=e,this.nc=t,this.sc=!1,this.ic=null,this.onlineState="Unknown",this.options=n||{}}ec(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Yu(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.sc?this.rc(e)&&(this.nc.next(e),t=!0):this.oc(e,this.onlineState)&&(this.cc(e),t=!0),this.ic=e,t}onError(e){this.nc.error(e)}tc(e){this.onlineState=e;let t=!1;return this.ic&&!this.sc&&this.oc(this.ic,e)&&(this.cc(this.ic),t=!0),t}oc(e,t){return!e.fromCache||!(this.options.uc&&"Offline"!==t||e.docs.isEmpty()&&"Offline"!==t)}rc(e){if(0<e.docChanges.length)return!0;var t=this.ic&&this.ic.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}cc(e){e=Yu.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.sc=!0,this.nc.next(e)}}class rc{constructor(e,t){this.payload=e,this.byteLength=t}ac(){return"metadata"in this.payload}}class sc{constructor(e){this.O=e}Gs(e){return co(this.O,e)}js(e){return e.metadata.exists?yo(this.O,e.document,!1):ys.newNoDocument(this.Gs(e.metadata.name),this.Qs(e.metadata.readTime))}Qs(e){return oo(e)}}class ic{constructor(e,t,n){this.hc=e,this.localStore=t,this.O=n,this.queries=[],this.documents=[],this.progress=oc(e)}lc(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;return e.payload.namedQuery?this.queries.push(e.payload.namedQuery):e.payload.documentMetadata?(this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t):e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t),t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}fc(e){const t=new Map,n=new sc(this.O);for(const s of e)if(s.metadata.queries){const e=n.Gs(s.metadata.name);for(const n of s.metadata.queries){var r=(t.get(n)||Gi()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const s=e;let i=Gi(),o=qi;for(const e of n){const n=t.Gs(e.metadata.name);e.document&&(i=i.add(n));const u=t.js(e);u.setReadTime(t.Qs(e.metadata.readTime)),o=o.insert(n,u)}const a=s.Bs.newChangeBuffer({trackRemovals:!0}),h=await qh(s,Ws(js(Ur.fromString(`__bundle__/docs/${r}`))));return s.persistence.runTransaction("Apply bundle documents","readwrite",t=>Uh(t,a,o).next(e=>(a.apply(t),e)).next(e=>s.Un.removeMatchingKeysForTargetId(t,h.targetId).next(()=>s.Un.addMatchingKeys(t,i,h.targetId)).next(()=>s.Us.Ts(t,e)).next(()=>e)))}(this.localStore,new sc(this.O),this.documents,this.hc.id),t=this.fc(this.documents);for(const e of this.queries)await async function(e,n,r=Gi()){const s=await qh(e,Ws(Aa(n.bundledQuery))),i=e;return i.persistence.runTransaction("Save named query","readwrite",e=>{var t=oo(n.readTime);return 0<=s.snapshotVersion.compareTo(t)?i.Kn.saveNamedQuery(e,n):(t=s.withResumeToken(Kr.EMPTY_BYTE_STRING,t),i.Ms=i.Ms.insert(t.targetId,t),i.Un.updateTargetData(e,t).next(()=>i.Un.removeMatchingKeysForTargetId(e,s.targetId)).next(()=>i.Un.addMatchingKeys(e,r,s.targetId)).next(()=>i.Kn.saveNamedQuery(e,n)))})}(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",new kh(Object.assign({},this.progress),e)}}function oc(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class ac{constructor(e){this.key=e}}class hc{constructor(e){this.key=e}}class uc{constructor(e,t){this.query=e,this.dc=t,this._c=null,this.current=!1,this.wc=Gi(),this.mutatedKeys=Gi(),this.mc=ti(e),this.gc=new Hu(this.mc)}get yc(){return this.dc}Ic(e,t){const a=t?t.Ec:new Wu,h=(t||this).gc;let u=(t||this).mutatedKeys,c=h,l=!1;const d=Ks(this.query)&&h.size===this.query.limit?h.last():null,f=Gs(this.query)&&h.size===this.query.limit?h.first():null;if(e.inorderTraversal((e,t)=>{const n=h.get(e),r=ei(this.query,t)?t:null,s=!!n&&this.mutatedKeys.has(n.key),i=!!r&&(r.hasLocalMutations||this.mutatedKeys.has(r.key)&&r.hasCommittedMutations);let o=!1;n&&r?n.data.isEqual(r.data)?s!==i&&(a.track({type:3,doc:r}),o=!0):this.Tc(n,r)||(a.track({type:2,doc:r}),o=!0,(d&&0<this.mc(r,d)||f&&this.mc(r,f)<0)&&(l=!0)):!n&&r?(a.track({type:0,doc:r}),o=!0):n&&!r&&(a.track({type:1,doc:n}),o=!0,(d||f)&&(l=!0)),o&&(u=r?(c=c.add(r),i?u.add(e):u.delete(e)):(c=c.delete(e),u.delete(e)))}),Ks(this.query)||Gs(this.query))for(;c.size>this.query.limit;){const e=Ks(this.query)?c.last():c.first();c=c.delete(e.key),u=u.delete(e.key),a.track({type:1,doc:e})}return{gc:c,Ec:a,ks:l,mutatedKeys:u}}Tc(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){var r=this.gc;this.gc=e.gc,this.mutatedKeys=e.mutatedKeys;const s=e.Ec.Yo();s.sort((e,t)=>function(e,t){var n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return mr()}};return n(e)-n(t)}(e.type,t.type)||this.mc(e.doc,t.doc)),this.Ac(n);var i=t?this.Rc():[],n=0===this.wc.size&&this.current?1:0,t=n!==this._c;return this._c=n,0!==s.length||t?{snapshot:new Yu(this.query,e.gc,r,s,e.mutatedKeys,0==n,t,!1),Pc:i}:{Pc:i}}tc(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({gc:this.gc,Ec:new Wu,mutatedKeys:this.mutatedKeys,ks:!1},!1)):{Pc:[]}}bc(e){return!this.dc.has(e)&&!!this.gc.has(e)&&!this.gc.get(e).hasLocalMutations}Ac(e){e&&(e.addedDocuments.forEach(e=>this.dc=this.dc.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.dc=this.dc.delete(e)),this.current=e.current)}Rc(){if(!this.current)return[];const t=this.wc;this.wc=Gi(),this.gc.forEach(e=>{this.bc(e.key)&&(this.wc=this.wc.add(e.key))});const n=[];return t.forEach(e=>{this.wc.has(e)||n.push(new hc(e))}),this.wc.forEach(e=>{t.has(e)||n.push(new ac(e))}),n}vc(e){this.dc=e.Ks,this.wc=Gi();e=this.Ic(e.documents);return this.applyChanges(e,!0)}Vc(){return Yu.fromInitialDocuments(this.query,this.gc,this.mutatedKeys,0===this._c)}}class cc{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class lc{constructor(e){this.key=e,this.Sc=!1}}class dc{constructor(e,t,n,r,s,i){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.Dc={},this.Cc=new yh(e=>Js(e),Xs),this.Nc=new Map,this.xc=new Set,this.kc=new Li(ts.comparator),this.Oc=new Map,this.Mc=new zh,this.$c={},this.Fc=new Map,this.Bc=ih.Je(),this.onlineState="Unknown",this.Lc=void 0}get isPrimaryClient(){return!0===this.Lc}}async function fc(n,e,t,r){n.Uc=(e,s,t)=>async function(e,t,n){let r=t.view.Ic(s);r.ks&&(r=await jh(e.localStore,t.query,!1).then(({documents:e})=>t.view.Ic(e,r)));n=n&&n.targetChanges.get(t.targetId),n=t.view.applyChanges(r,e.isPrimaryClient,n);return bc(e,t.targetId,n.Pc),n.snapshot}(n,e,t);const s=await jh(n.localStore,e,!0),i=new uc(e,s.Ks),o=i.Ic(s.documents),a=zi.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState),h=i.applyChanges(o,n.isPrimaryClient,a);bc(n,t,h.Pc);r=new cc(e,t,i);return n.Cc.set(e,r),n.Nc.has(t)?n.Nc.get(t).push(e):n.Nc.set(t,[e]),h.snapshot}async function gc(e,t,n){const r=Nc(e);try{const e=await function(e,r){const s=e,i=Rr.now(),t=r.reduce((e,t)=>e.add(t.key),Gi());let o;return s.persistence.runTransaction("Locally write mutations","readwrite",n=>s.Us.Es(n,t).next(e=>{o=e;const t=[];for(const n of r){const r=function(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),s=oi(r.transform,e||null);null!=s&&(null==n&&(n=ps.empty()),n.set(r.field,s))}return n||null}(n,o.get(n.key));null!=r&&t.push(new _i(n.key,r,function r(e){const s=[];return Pr(e.fields,(e,t)=>{const n=new Br([e]);if(gs(t)){const e=r(t.mapValue).fields;if(0===e.length)s.push(n);else for(const t of e)s.push(n.child(t))}else s.push(n)}),new jr(s)}(r.value.mapValue),yi.exists(!0)))}return s.gs.addMutationBatch(n,i,t,r)})).then(e=>(e.applyToLocalDocumentSet(o),{batchId:e.batchId,changes:o}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.$c[e.currentUser.toKey()];r=r||new Li(Dr),r=r.insert(t,n),e.$c[e.currentUser.toKey()]=r}(r,e.batchId,n),await Ec(r,e.changes),await Uu(r.remoteStore)}catch(e){const t=zu(e,"Failed to persist write");n.reject(t)}}async function mc(e,t){const r=e;try{const e=await function(e,u){const c=e,l=u.snapshotVersion;let d=c.Ms;return c.persistence.runTransaction("Apply remote event","readwrite-primary",a=>{const e=c.Bs.newChangeBuffer({trackRemovals:!0});d=c.Ms;const h=[];u.targetChanges.forEach((t,n)=>{const r=d.get(n);if(r){h.push(c.Un.removeMatchingKeys(a,t.removedDocuments,n).next(()=>c.Un.addMatchingKeys(a,t.addedDocuments,n)));let e=r.withSequenceNumber(a.currentSequenceNumber);var s,i,o;u.targetMismatches.has(n)?e=e.withResumeToken(Kr.EMPTY_BYTE_STRING,Lr.min()).withLastLimboFreeSnapshotVersion(Lr.min()):0<t.resumeToken.approximateByteSize()&&(e=e.withResumeToken(t.resumeToken,l)),d=d.insert(n,e),s=r,i=e,o=t,0!==s.resumeToken.approximateByteSize()&&!(3e8<=i.snapshotVersion.toMicroseconds()-s.snapshotVersion.toMicroseconds()||0<o.addedDocuments.size+o.modifiedDocuments.size+o.removedDocuments.size)||h.push(c.Un.updateTargetData(a,e))}});let t=qi;if(u.documentUpdates.forEach(e=>{u.resolvedLimboDocuments.has(e)&&h.push(c.persistence.referenceDelegate.updateLimboDocument(a,e))}),h.push(Uh(a,e,u.documentUpdates).next(e=>{t=e})),!l.isEqual(Lr.min())){const u=c.Un.getLastRemoteSnapshotVersion(a).next(e=>c.Un.setTargetsMetadata(a,a.currentSequenceNumber,l));h.push(u)}return ea.waitFor(h).next(()=>e.apply(a)).next(()=>c.Us.Ts(a,t)).next(()=>t)}).then(e=>(c.Ms=d,e))}(r.localStore,t);t.targetChanges.forEach((e,t)=>{const n=r.Oc.get(t);n&&(pr(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),0<e.addedDocuments.size?n.Sc=!0:0<e.modifiedDocuments.size?pr(n.Sc):0<e.removedDocuments.size&&(pr(n.Sc),n.Sc=!1))}),await Ec(r,e,t)}catch(e){await ch(e)}}function pc(n,r,e){const t=n;if(t.isPrimaryClient&&0===e||!t.isPrimaryClient&&1===e){const n=[];t.Cc.forEach((e,t)=>{t=t.view.tc(r);t.snapshot&&n.push(t.snapshot)}),function(e,n){const t=e;t.onlineState=n;let r=!1;t.queries.forEach((e,t)=>{for(const e of t.listeners)e.tc(n)&&(r=!0)}),r&&tc(t)}(t.eventManager,r),n.length&&t.Dc.To(n),t.onlineState=r,t.isPrimaryClient&&t.sharedClientState.setOnlineState(r)}}function yc(e,t){(e.Fc.get(t)||[]).forEach(e=>{e.resolve()}),e.Fc.delete(t)}function wc(e,t,n){const r=e;let s=r.$c[r.currentUser.toKey()];if(s){const e=s.get(t);e&&(n?e.reject(n):e.resolve(),s=s.remove(t)),r.$c[r.currentUser.toKey()]=s}}function vc(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Nc.get(e))t.Cc.delete(r),n&&t.Dc.qc(r,n);t.Nc.delete(e),t.isPrimaryClient&&t.Mc.si(e).forEach(e=>{t.Mc.containsKey(e)||Ic(t,e)})}function Ic(e,t){e.xc.delete(t.path.canonicalString());var n=e.kc.get(t);null!==n&&(Du(e.remoteStore,n),e.kc=e.kc.remove(t),e.Oc.delete(n),Tc(e))}function bc(e,t,n){for(const r of n)r instanceof ac?(e.Mc.addReference(r.key,t),function(e){const t=r.key,n=t.path.canonicalString();e.kc.get(t)||e.xc.has(n)||(lr("SyncEngine","New document in limbo: "+t),e.xc.add(n),Tc(e))}(e)):r instanceof hc?(lr("SyncEngine","Document no longer in limbo: "+r.key),e.Mc.removeReference(r.key,t),e.Mc.containsKey(r.key)||Ic(e,r.key)):mr()}function Tc(e){for(;0<e.xc.size&&e.kc.size<e.maxConcurrentLimboResolutions;){var t=e.xc.values().next().value;e.xc.delete(t);var n=new ts(Ur.fromString(t)),t=e.Bc.next();e.Oc.set(t,new lc(n)),e.kc=e.kc.insert(n,t),Cu(e.remoteStore,new ma(Ws(js(n.path)),t,2,Nr.A))}}async function Ec(e,n,r){const s=e,i=[],o=[],a=[];s.Cc.isEmpty()||(s.Cc.forEach((e,t)=>{a.push(s.Uc(t,n,r).then(e=>{e&&(s.isPrimaryClient&&s.sharedClientState.updateQueryState(t.targetId,e.fromCache?"not-current":"current"),i.push(e),e=Rh.Ss(t.targetId,e),o.push(e))}))}),await Promise.all(a),s.Dc.To(i),await async function(e,t){const r=e;try{await r.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>ea.forEach(t,t=>ea.forEach(t.vs,e=>r.persistence.referenceDelegate.addReference(n,t.targetId,e)).next(()=>ea.forEach(t.Vs,e=>r.persistence.referenceDelegate.removeReference(n,t.targetId,e)))))}catch(e){if(!ia(e))throw e;lr("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=r.Ms.get(t),n=e.snapshotVersion,s=e.withLastLimboFreeSnapshotVersion(n);r.Ms=r.Ms.insert(t,s)}}}(s.localStore,o))}async function Sc(r,e){const s=r;if(xc(s),Nc(s),!0===e&&!0!==s.Lc){const r=s.sharedClientState.getAllActiveQueryTargets(),e=await _c(s,r.toArray());s.Lc=!0,await Ku(s.remoteStore,!0);for(const r of e)Cu(s.remoteStore,r)}else if(!1===e&&!1!==s.Lc){const r=[];let n=Promise.resolve();s.Nc.forEach((e,t)=>{s.sharedClientState.isLocalQueryTarget(t)?r.push(t):n=n.then(()=>(vc(s,t),Bh(s.localStore,t,!0))),Du(s.remoteStore,t)}),await n,await _c(s,r),function(){const n=s;n.Oc.forEach((e,t)=>{Du(n.remoteStore,t)}),n.Mc.ii(),n.Oc=new Map,n.kc=new Li(ts.comparator)}(),s.Lc=!1,await Ku(s.remoteStore,!1)}}async function _c(t,n){const r=t,s=[],i=[];for(const t of n){let e;var o=r.Nc.get(t);if(o&&0!==o.length){e=await qh(r.localStore,Ws(o[0]));for(const t of o){const n=r.Cc.get(t),c=(a=n,0,u=await jh((h=r).localStore,a.query,!0),u=a.view.vc(u),h.isPrimaryClient&&bc(h,a.targetId,u.Pc),await u);c.snapshot&&i.push(c.snapshot)}}else{o=await Kh(r.localStore,t);e=await qh(r.localStore,o),await fc(r,Ac(o),t,!1)}s.push(e)}var a,h,u;return r.Dc.To(i),s}function Ac(e){return Bs(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function xc(e){const t=e;return t.remoteStore.remoteSyncer.applyRemoteEvent=mc.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=function(e,t){const n=e,r=n.Oc.get(t);if(r&&r.Sc)return Gi().add(r.key);{let e=Gi();const r=n.Nc.get(t);if(!r)return e;for(const t of r){const r=n.Cc.get(t);e=e.unionWith(r.view.yc)}return e}}.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=async function(e,t,n){const r=e;r.sharedClientState.updateQueryState(t,"rejected",n);const s=r.Oc.get(t),i=s&&s.key;if(i){let e=new Li(ts.comparator);e=e.insert(i,ys.newNoDocument(i,Lr.min()));const n=Gi().add(i),s=new Qi(Lr.min(),new Map,new Fi(Dr),e,n);await mc(r,s),r.kc=r.kc.remove(i),r.Oc.delete(t),Tc(r)}else await Bh(r.localStore,t,!1).then(()=>vc(r,t,n)).catch(ch)}.bind(null,t),t.Dc.To=function(e,t){const n=e;let r=!1;for(const e of t){const t=e.query,s=n.queries.get(t);if(s){for(const t of s.listeners)t.ec(e)&&(r=!0);s.Xo=e}}r&&tc(n)}.bind(null,t.eventManager),t.Dc.qc=function(e,t,n){const r=e,s=r.queries.get(t);if(s)for(const e of s.listeners)e.onError(n);r.queries.delete(t)}.bind(null,t.eventManager),t}function Nc(e){const t=e;return t.remoteStore.remoteSyncer.applySuccessfulWrite=async function(e,t){const n=e,r=t.batch.batchId;try{const e=await function(e,r){const s=e;return s.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const t=r.batch.keys(),n=s.Bs.newChangeBuffer({trackRemovals:!0});return function(e,t,r,s){const i=r.batch,n=i.keys();let o=ea.resolve();return n.forEach(n=>{o=o.next(()=>s.getEntry(t,n)).next(e=>{var t=r.docVersions.get(n);pr(null!==t),e.version.compareTo(t)<0&&(i.applyToRemoteDocument(e,r),e.isValidDocument()&&(e.setReadTime(r.commitVersion),s.addEntry(e)))})}),o.next(()=>e.gs.removeMutationBatch(t,i))}(s,e,r,n).next(()=>n.apply(e)).next(()=>s.gs.performConsistencyCheck(e)).next(()=>s.Us.Es(e,t))})}(n.localStore,t);wc(n,r,null),yc(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Ec(n,e)}catch(e){await ch(e)}}.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=async function(e,t,n){const r=e;try{const e=await function(e,r){const s=e;return s.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let n;return s.gs.lookupMutationBatch(t,r).next(e=>(pr(null!==e),n=e.keys(),s.gs.removeMutationBatch(t,e))).next(()=>s.gs.performConsistencyCheck(t)).next(()=>s.Us.Es(t,n))})}(r.localStore,t);wc(r,t,n),yc(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await Ec(r,e)}catch(n){await ch(n)}}.bind(null,t),t}class Cc{constructor(){this.synchronizeTabs=!1}async initialize(e){this.O=vu(e.databaseInfo.databaseId),this.sharedClientState=this.Gc(e),this.persistence=this.jc(e),await this.persistence.start(),this.gcScheduler=this.Qc(e),this.localStore=this.Wc(e)}Qc(e){return null}Wc(e){return Ph(this.persistence,new Lh,e.initialUser,this.O)}jc(e){return new Zh(tu.bi,this.O)}Gc(e){return new lu}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Dc extends Cc{constructor(e,t,n){super(),this.zc=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await async function(e){const t=e;return t.persistence.runTransaction("Synchronize last document change read time","readonly",t=>function(){const e=Th(t);let r=Lr.min();return e.Qt({index:Po.readTimeIndex,reverse:!0},(e,t,n)=>{t.readTime&&(r=Ia(t.readTime)),n.done()}).next(()=>r)}()).then(e=>{t.Fs=e})}(this.localStore),await this.zc.initialize(this,e),await Nc(this.zc.syncEngine),await Uu(this.zc.remoteStore),await this.persistence.Hn(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(this.localStore),Promise.resolve()))}Wc(e){return Ph(this.persistence,new Lh,e.initialUser,this.O)}Qc(e){var t=this.persistence.referenceDelegate.garbageCollector;return new fh(t,e.asyncQueue)}jc(e){var t=Dh(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Xa.withCacheSize(this.cacheSizeBytes):Xa.DEFAULT;return new xh(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,yu(),wu(),this.O,this.sharedClientState,!!this.forceOwnership)}Gc(e){return new lu}}class kc extends Dc{constructor(e,t){super(e,t,!1),this.zc=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);e=this.zc.syncEngine;this.sharedClientState instanceof cu&&(this.sharedClientState.syncEngine={hr:async function(e,t,n,r){var s=e,e=await function(e,n){const r=e,s=r.gs;return r.persistence.runTransaction("Lookup mutation documents","readonly",t=>s.Ge(t,n).next(e=>e?r.Us.Es(t,e):ea.resolve(null)))}(s.localStore,t);null!==e?("pending"===n?await Uu(s.remoteStore):"acknowledged"===n||"rejected"===n?(wc(s,t,r||null),yc(s,t),s.localStore.gs.Qe(t)):mr(),await Ec(s,e)):lr("SyncEngine","Cannot apply mutation batch with id: "+t)}.bind(null,e),lr:async function(e,t,n,r){const s=e;if(s.Lc)lr("SyncEngine","Ignoring unexpected query state notification.");else if(s.Nc.has(t))switch(n){case"current":case"not-current":{const e=await Gh(s.localStore),r=Qi.createSynthesizedRemoteEventForCurrentChange(t,"current"===n);await Ec(s,e,r);break}case"rejected":await Bh(s.localStore,t,!0),vc(s,t,r);break;default:mr()}}.bind(null,e),dr:async function(e,t,n){const r=xc(e);if(r.Lc){for(const e of t)if(r.Nc.has(e))lr("SyncEngine","Adding an already active target "+e);else{const t=await Kh(r.localStore,e),n=await qh(r.localStore,t);await fc(r,Ac(t),n.targetId,!1),Cu(r.remoteStore,n)}for(const e of n)r.Nc.has(e)&&await Bh(r.localStore,e,!1).then(()=>{Du(r.remoteStore,e),vc(r,e)}).catch(ch)}}.bind(null,e),ds:function(e){return e.localStore.persistence.ds()}.bind(null,e),ar:async function(e){const t=e;return Gh(t.localStore).then(e=>Ec(t,e))}.bind(null,e)},await this.sharedClientState.start()),await this.persistence.Hn(async e=>{await Sc(this.zc.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):e||this.gcScheduler.stop())})}Gc(e){var t=yu();if(!cu.Vt(t))throw new wr(yr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Dh(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new cu(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class Oc{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>pc(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=async function(e,t){const n=e;var r;n.currentUser.isEqual(t)||(lr("SyncEngine","User change. New user:",t.toKey()),r=await Fh(n.localStore,t),n.currentUser=t,(e=n).Fc.forEach(e=>{e.forEach(e=>{e.reject(new wr(yr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.Fc.clear(),n.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await Ec(n,r.qs))}.bind(null,this.syncEngine),await Ku(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Ju}createDatastore(e){var t=vu(e.databaseInfo.databaseId),n=(n=e.databaseInfo,new pu(n)),r=e.authCredentials,s=e.appCheckCredentials,n=n;return e=t,new Su(r,s,n,e)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,s=e=>pc(this.syncEngine,e,0),e=new(fu.Vt()?fu:du),new Au(t,n,r,s,e);var t,n,r,s}createSyncEngine(e,t){return function(e,t,n,r,s,i,o){const a=new dc(e,t,n,r,s,i);return o&&(a.Lc=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=e;lr("RemoteStore","RemoteStore shutting down."),t.Ko.add(5),await Nu(t),t.jo.shutdown(),t.Qo.set("Unknown")}(this.remoteStore)}}function Rc(t,n=10240){let r=0;return{async read(){if(r<t.byteLength){var e={value:t.slice(r,r+n),done:!1};return r+=n,e}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class Lc{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Hc(this.observer.next,e)}error(e){this.observer.error?this.Hc(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}Jc(){this.muted=!0}Hc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class Mc{constructor(e,t){this.Yc=e,this.O=t,this.metadata=new vr,this.buffer=new Uint8Array,this.Xc=new TextDecoder("utf-8"),this.Zc().then(e=>{e&&e.ac()?this.metadata.resolve(e.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.payload)}`))},e=>this.metadata.reject(e))}close(){return this.Yc.cancel()}async getMetadata(){return this.metadata.promise}async Kc(){return await this.getMetadata(),this.Zc()}async Zc(){var e=await this.tu();if(null===e)return null;var t=this.Xc.decode(e),n=Number(t);return isNaN(n)&&this.eu(`length string (${t}) is not valid number`),t=await this.nu(n),new rc(JSON.parse(t),e.length+n)}su(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async tu(){for(;this.su()<0&&!await this.iu(););if(0===this.buffer.length)return null;var e=this.su();e<0&&this.eu("Reached the end of bundle when a length string is expected.");var t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async nu(e){for(;this.buffer.length<e;)await this.iu()&&this.eu("Reached the end of bundle when more is expected.");var t=this.Xc.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}eu(e){throw this.Yc.cancel(),new Error(`Invalid bundle format: ${e}`)}async iu(){var e=await this.Yc.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class Pc{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),0<this.mutations.length)throw new wr(yr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const r=e,n=go(r.O)+"/documents",s={documents:t.map(e=>uo(r.O,e))},i=await r.Lr("BatchGetDocuments",n,s),o=new Map;i.forEach(e=>{const t=(n=r.O,"found"in e?function(e,t){pr(!!t.found),t.found.name,t.found.updateTime;var n=co(e,t.found.name),e=oo(t.found.updateTime),t=new ps({mapValue:{fields:t.found.fields}});return ys.newFoundDocument(n,e,t)}(n,e):"missing"in e?function(e,t){pr(!!t.missing),pr(!!t.readTime);e=co(e,t.missing),t=oo(t.readTime);return ys.newNoDocument(e,t)}(n,e):mr());var n;o.set(t.key.toString(),t)});const a=[];return t.forEach(e=>{e=o.get(e.toString());pr(!!e),a.push(e)}),a}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new Ci(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,t)=>{t=ts.fromPath(t);this.mutations.push(new Di(t,this.precondition(t)))}),await async function(e,t){const n=e,r=go(n.O)+"/documents",s={writes:t.map(e=>wo(n.O,e))};await n.Mr("Commit",r,s)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw mr();t=Lr.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new wr(yr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){var t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?yi.updateTime(t):yi.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return yi.exists(!0);if(t.isEqual(Lr.min()))throw new wr(yr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return yi.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class Fc{constructor(e,t,n,r){this.asyncQueue=e,this.datastore=t,this.updateFunction=n,this.deferred=r,this.ru=5,this.ro=new Iu(this.asyncQueue,"transaction_retry")}run(){--this.ru,this.ou()}ou(){this.ro.Hr(async()=>{const t=new Pc(this.datastore),e=this.cu(t);e&&e.then(e=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(e)}).catch(e=>{this.uu(e)}))}).catch(e=>{this.uu(e)})})}cu(e){try{var t=this.updateFunction(e);return!Jr(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}uu(e){0<this.ru&&this.au(e)?(--this.ru,this.asyncQueue.enqueueAndForget(()=>(this.ou(),Promise.resolve()))):this.deferred.reject(e)}au(e){if("FirebaseError"!==e.name)return!1;e=e.code;return"aborted"===e||"failed-precondition"===e||!Oi(e)}}class Vc{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=ar.UNAUTHENTICATED,this.clientId=Cr.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,async e=>{lr("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(lr("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new wr(yr.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const n=new vr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),n.resolve()}catch(e){var t=zu(e,"Failed to shutdown persistence");n.reject(t)}}),n.promise}}async function Uc(e,t){e.asyncQueue.verifyOperationInProgress(),lr("FirestoreClient","Initializing OfflineComponentProvider");var n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await Fh(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e.offlineComponents=t}async function qc(e,n){e.asyncQueue.verifyOperationInProgress();var t=await Bc(e);lr("FirestoreClient","Initializing OnlineComponentProvider");var r=await e.getConfiguration();await n.initialize(t,r),e.setCredentialChangeListener(e=>ju(n.remoteStore,e)),e.setAppCheckTokenChangeListener((e,t)=>ju(n.remoteStore,t)),e.onlineComponents=n}async function Bc(e){return e.offlineComponents||(lr("FirestoreClient","Using default OfflineComponentProvider"),await Uc(e,new Cc)),e.offlineComponents}async function jc(e){return e.onlineComponents||(lr("FirestoreClient","Using default OnlineComponentProvider"),await qc(e,new Oc)),e.onlineComponents}function Kc(e){return Bc(e).then(e=>e.persistence)}function Gc(e){return Bc(e).then(e=>e.localStore)}function $c(e){return jc(e).then(e=>e.remoteStore)}function Qc(e){return jc(e).then(e=>e.syncEngine)}async function zc(e){const t=await jc(e),n=t.eventManager;return n.onListen=async function(e,t){const n=xc(e);let r,s;const i=n.Cc.get(t);if(i)r=i.targetId,n.sharedClientState.addLocalQueryTarget(r),s=i.view.Vc();else{const e=await qh(n.localStore,Ws(t));n.isPrimaryClient&&Cu(n.remoteStore,e);const i=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,s=await fc(n,t,r,"current"===i)}return s}.bind(null,t.syncEngine),n.onUnlisten=async function(e,t){const n=e,r=n.Cc.get(t),s=n.Nc.get(r.targetId);if(1<s.length)return n.Nc.set(r.targetId,s.filter(e=>!Xs(e,t))),void n.Cc.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await Bh(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),Du(n.remoteStore,r.targetId),vc(n,r.targetId)}).catch(ch)):(vc(n,r.targetId),await Bh(n.localStore,r.targetId,!0))}.bind(null,t.syncEngine),n}function Hc(e,t,n={}){const r=new vr;return e.asyncQueue.enqueueAndForget(async()=>function(n,r,s,i,o){const e=new Lc({next:e=>{r.enqueueAndForget(()=>ec(n,a));var t=e.docs.has(s);!t&&e.fromCache?o.reject(new wr(yr.UNAVAILABLE,"Failed to get document because the client is offline.")):t&&e.fromCache&&i&&"server"===i.source?o.reject(new wr(yr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):o.resolve(e)},error:e=>o.reject(e)}),a=new nc(js(s.path),e,{includeMetadataChanges:!0,uc:!0});return Zu(n,a)}(await zc(e),e.asyncQueue,t,n,r)),r.promise}function Wc(e,t,n={}){const r=new vr;return e.asyncQueue.enqueueAndForget(async()=>function(t,n,e,r,s){const i=new Lc({next:e=>{n.enqueueAndForget(()=>ec(t,o)),e.fromCache&&"server"===r.source?s.reject(new wr(yr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(e)},error:e=>s.reject(e)}),o=new nc(e,i,{includeMetadataChanges:!0,uc:!0});return Zu(t,o)}(await zc(e),e.asyncQueue,t,n,r)),r.promise}function Yc(e,t,n,r){const s=(t=vu(t),n=function(e){if(e instanceof Uint8Array)return Rc(e,void 0);if(e instanceof ArrayBuffer)return Rc(new Uint8Array(e),void 0);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof n?(new TextEncoder).encode(n):n),new Mc(n,t));e.asyncQueue.enqueueAndForget(async()=>{!function(e,t){const n=e;!async function(t,n,r){try{var s=await n.getMetadata();if(await function(e,t){const n=e,r=oo(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",e=>n.Kn.getBundleMetadata(e,t.id)).then(e=>!!e&&0<=e.createTime.compareTo(r))}(t.localStore,s))return await n.close(),void r._completeWith({taskState:"Success",documentsLoaded:s.totalDocuments,bytesLoaded:s.totalBytes,totalDocuments:s.totalDocuments,totalBytes:s.totalBytes});r._updateProgress(oc(s));const o=new ic(s,t.localStore,n.O);let e=await n.Kc();for(;e;){const t=await o.lc(e);t&&r._updateProgress(t),e=await n.Kc()}var i=await o.complete();await Ec(t,i.ws,void 0),await function(e,t){const n=e;return n.persistence.runTransaction("Save bundle","readwrite",e=>n.Kn.saveBundleMetadata(e,t))}(t.localStore,s),r._completeWith(i.progress)}catch(t){fr("SyncEngine",`Loading bundle failed with ${t}`),r._failWith(t)}}(n,t,r).then(()=>{n.sharedClientState.notifyBundleLoaded()})}(await Qc(e),s)})}const Xc=new Map;function Jc(e,t,n){if(!n)throw new wr(yr.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Zc(e,t,n,r){if(!0===t&&!0===r)throw new wr(yr.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function el(e){if(!ts.isDocumentKey(e))throw new wr(yr.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function tl(e){if(ts.isDocumentKey(e))throw new wr(yr.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function nl(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":mr();if(e instanceof Array)return"an array";e=e.constructor?e.constructor.name:null;return e?`a custom ${e} object`:"an object"}function rl(e,t){if((e="_delegate"in e?e._delegate:e)instanceof t)return e;if(t.name===e.constructor.name)throw new wr(yr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");e=nl(e);throw new wr(yr.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}function sl(e,t){if(t<=0)throw new wr(yr.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class il{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new wr(yr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new wr(yr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,Zc("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class ol{constructor(e,t,n){this._authCredentials=t,this._appCheckCredentials=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new il({}),this._settingsFrozen=!1,e instanceof Xr?this._databaseId=e:(this._app=e,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new wr(yr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Xr(e.options.projectId)}(e))}get app(){if(!this._app)throw new wr(yr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new wr(yr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new il(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new br;switch(e.type){case"gapi":var t=e.client;return pr(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new _r(t,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new wr(yr.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Xc.get(e);t&&(lr("ComponentProvider","Removing Datastore"),Xc.delete(e),t.terminate())}(this),Promise.resolve()}}class al{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ul(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new al(this.firestore,e,this._key)}}class hl{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new hl(this.firestore,e,this._query)}}class ul extends hl{constructor(e,t,n){super(e,t,js(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new al(this.firestore,null,new ts(e))}withConverter(e){return new ul(this.firestore,e,this._path)}}function cl(e,t,...n){if(e=d(e),Jc("collection","path",t),e instanceof ol){var r=Ur.fromString(t,...n);return tl(r),new ul(e,null,r)}if(!(e instanceof al||e instanceof ul))throw new wr(yr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return tl(r=e._path.child(Ur.fromString(t,...n))),new ul(e.firestore,null,r)}function ll(e,t,...n){if(e=d(e),Jc("doc","path",t=1===arguments.length?Cr.R():t),e instanceof ol){var r=Ur.fromString(t,...n);return el(r),new al(e,null,new ts(r))}if(!(e instanceof al||e instanceof ul))throw new wr(yr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return el(r=e._path.child(Ur.fromString(t,...n))),new al(e.firestore,e instanceof ul?e.converter:null,new ts(r))}function dl(e,t){return e=d(e),t=d(t),(e instanceof al||e instanceof ul)&&(t instanceof al||t instanceof ul)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function fl(e,t){return e=d(e),t=d(t),e instanceof hl&&t instanceof hl&&e.firestore===t.firestore&&Xs(e._query,t._query)&&e.converter===t.converter}class gl{constructor(){this.hu=Promise.resolve(),this.lu=[],this.fu=!1,this.du=[],this._u=null,this.wu=!1,this.mu=!1,this.gu=[],this.ro=new Iu(this,"async_queue_retry"),this.yu=()=>{var e=wu();e&&lr("AsyncQueue","Visibility state changed to "+e.visibilityState),this.ro.Yr()};const e=wu();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.yu)}get isShuttingDown(){return this.fu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.pu(),this.Iu(e)}enterRestrictedMode(e){if(!this.fu){this.fu=!0,this.mu=e||!1;const t=wu();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.yu)}}enqueue(e){if(this.pu(),this.fu)return new Promise(()=>{});const t=new vr;return this.Iu(()=>this.fu&&this.mu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.lu.push(e),this.Eu()))}async Eu(){if(0!==this.lu.length){try{await this.lu[0](),this.lu.shift(),this.ro.reset()}catch(e){if(!ia(e))throw e;lr("AsyncQueue","Operation failed with retryable error: "+e)}0<this.lu.length&&this.ro.Hr(()=>this.Eu())}}Iu(e){var t=this.hu.then(()=>(this.wu=!0,e().catch(e=>{throw this._u=e,this.wu=!1,dr("INTERNAL UNHANDLED ERROR: ",function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e)),e}).then(e=>(this.wu=!1,e))));return this.hu=t}enqueueAfterDelay(e,t,n){this.pu(),-1<this.gu.indexOf(e)&&(t=0);n=Qu.createAndSchedule(this,e,t,n,e=>this.Tu(e));return this.du.push(n),n}pu(){this._u&&mr()}verifyOperationInProgress(){}async Au(){for(var e;await(e=this.hu),e!==this.hu;);}Ru(e){for(const t of this.du)if(t.timerId===e)return!0;return!1}Pu(t){return this.Au().then(()=>{this.du.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const e of this.du)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Au()})}bu(e){this.gu.push(e)}Tu(e){e=this.du.indexOf(e);this.du.splice(e,1)}}function ml(e){return function(e){if("object"==typeof e&&null!==e){var t=e;for(const e of["next","error","complete"])if(e in t&&"function"==typeof t[e])return 1}}(e)}class pl{constructor(){this._progressObserver={},this._taskCompletionResolver=new vr,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class yl extends ol{constructor(e,t,n){super(e,t,n),this.type="firestore",this._queue=new gl,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||vl(this),this._firestoreClient.terminate()}}function wl(e){return e._firestoreClient||vl(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function vl(e){var t,n,r,s,i=e._freezeSettings(),i=(t=e._databaseId,n=(null===(s=e._app)||void 0===s?void 0:s.options.appId)||"",r=e._persistenceKey,s=i,new Yr(t,n,r,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,s.useFetchStreams));e._firestoreClient=new Vc(e._authCredentials,e._appCheckCredentials,e._queue,i)}function Il(e,n,r){const s=new vr;return e.asyncQueue.enqueue(async()=>{try{await Uc(e,r),await qc(e,n),s.resolve()}catch(e){if(!("FirebaseError"===(t=e).name?t.code===yr.FAILED_PRECONDITION||t.code===yr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw e;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+e),s.reject(e)}var t}).then(()=>s.promise)}function bl(e){if(e._initialized||e._terminated)throw new wr(yr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Tl{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new wr(yr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Br(t)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class El{constructor(e){this._byteString=e}static fromBase64String(e){try{return new El(Kr.fromBase64String(e))}catch(e){throw new wr(yr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new El(Kr.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Sl{constructor(e){this._methodName=e}}class _l{constructor(e,t){if(!isFinite(e)||e<-90||90<e)throw new wr(yr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||180<t)throw new wr(yr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Dr(this._lat,e._lat)||Dr(this._long,e._long)}}const Al=/^__.*__$/;class xl{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new _i(e,this.data,this.fieldMask,t,this.fieldTransforms):new Si(e,this.data,t,this.fieldTransforms)}}class Nl{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new _i(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Cl(e){switch(e){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw mr()}}class Dl{constructor(e,t,n,r,s,i){this.settings=e,this.databaseId=t,this.O=n,this.ignoreUndefinedProperties=r,void 0===s&&this.vu(),this.fieldTransforms=s||[],this.fieldMask=i||[]}get path(){return this.settings.path}get Vu(){return this.settings.Vu}Su(e){return new Dl(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.O,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Du(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Su({path:n,Cu:!1});return r.Nu(e),r}xu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.Su({path:n,Cu:!1});return r.vu(),r}ku(e){return this.Su({path:void 0,Cu:!0})}Ou(e){return Yl(e,this.settings.methodName,this.settings.Mu||!1,this.path,this.settings.$u)}contains(t){return void 0!==this.fieldMask.find(e=>t.isPrefixOf(e))||void 0!==this.fieldTransforms.find(e=>t.isPrefixOf(e.field))}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Nu(this.path.get(e))}Nu(e){if(0===e.length)throw this.Ou("Document fields must not be empty");if(Cl(this.Vu)&&Al.test(e))throw this.Ou('Document fields cannot begin and end with "__"')}}class kl{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.O=n||vu(e)}Fu(e,t,n,r=!1){return new Dl({Vu:e,methodName:t,$u:n,path:Br.emptyPath(),Cu:!1,Mu:r},this.databaseId,this.O,this.ignoreUndefinedProperties)}}function Ol(e){var t=e._freezeSettings(),n=vu(e._databaseId);return new kl(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Rl(e,t,n,r,s,i={}){const o=e.Fu(i.merge||i.mergeFields?2:0,t,n,s);Ql("Data must be an object, but it was:",o,r);r=Gl(r,o);let a,h;if(i.merge)a=new jr(o.fieldMask),h=o.fieldTransforms;else if(i.mergeFields){const e=[];for(const u of i.mergeFields){const s=zl(t,u,n);if(!o.contains(s))throw new wr(yr.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);Xl(e,s)||e.push(s)}a=new jr(e),h=o.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,h=o.fieldTransforms;return new xl(new ps(r),a,h)}class Ll extends Sl{_toFieldTransform(e){if(2!==e.Vu)throw 1===e.Vu?e.Ou(`${this._methodName}() can only appear at the top level of your update data`):e.Ou(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Ll}}function Ml(e,t,n){return new Dl({Vu:3,$u:t.settings.$u,methodName:e._methodName,Cu:n},t.databaseId,t.O,t.ignoreUndefinedProperties)}class Pl extends Sl{_toFieldTransform(e){return new mi(e.path,new ai)}isEqual(e){return e instanceof Pl}}class Fl extends Sl{constructor(e,t){super(e),this.Bu=t}_toFieldTransform(e){const t=Ml(this,e,!0),n=this.Bu.map(e=>Kl(e,t)),r=new hi(n);return new mi(e.path,r)}isEqual(e){return this===e}}class Vl extends Sl{constructor(e,t){super(e),this.Bu=t}_toFieldTransform(e){const t=Ml(this,e,!0),n=this.Bu.map(e=>Kl(e,t)),r=new ci(n);return new mi(e.path,r)}isEqual(e){return this===e}}class Ul extends Sl{constructor(e,t){super(e),this.Lu=t}_toFieldTransform(e){var t=new di(e.O,si(e.O,this.Lu));return new mi(e.path,t)}isEqual(e){return this===e}}function ql(e,s,i,t){const o=e.Fu(1,s,i);Ql("Data must be an object, but it was:",o,t);const a=[],h=ps.empty();Pr(t,(e,t)=>{var n=Wl(s,e,i);t=d(t);e=o.xu(n);if(t instanceof Ll)a.push(n);else{const r=Kl(t,e);null!=r&&(a.push(n),h.set(n,r))}});t=new jr(a);return new Nl(h,t,o.fieldTransforms)}function Bl(t,n,e,r,s,i){const o=t.Fu(1,n,e),a=[zl(n,r,e)],h=[s];if(i.length%2!=0)throw new wr(yr.INVALID_ARGUMENT,`Function ${n}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<i.length;e+=2)a.push(zl(n,i[e])),h.push(i[e+1]);const u=[],c=ps.empty();for(let e=a.length-1;0<=e;--e)if(!Xl(u,a[e])){const n=a[e];var l=d(h[e]);const r=o.xu(n);if(l instanceof Ll)u.push(n);else{const t=Kl(l,r);null!=t&&(u.push(n),c.set(n,t))}}s=new jr(u);return new Nl(c,s,o.fieldTransforms)}function jl(e,t,n,r=!1){return Kl(n,e.Fu(r?4:3,t))}function Kl(i,e){if($l(i=d(i)))return Ql("Unsupported field value:",e,i),Gl(i,e);if(i instanceof Sl)return function(e,t){if(!Cl(t.Vu))throw t.Ou(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Ou(`${e._methodName}() is not currently supported inside arrays`);e=e._toFieldTransform(t);e&&t.fieldTransforms.push(e)}(i,e),null;if(void 0===i&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),i instanceof Array){if(e.settings.Cu&&4!==e.Vu)throw e.Ou("Nested arrays are not supported");return function(t){const n=[];let r=0;for(const s of i){let e=Kl(s,t.ku(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e)}return function(e,t){if(null===(e=d(i)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return si(t.O,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=Rr.fromDate(e);return{timestampValue:so(t.O,n)}}if(e instanceof Rr)return n=new Rr(e.seconds,1e3*Math.floor(e.nanoseconds/1e3)),{timestampValue:so(t.O,n)};if(e instanceof _l)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof El)return{bytesValue:io(t.O,e._byteString)};if(e instanceof al){const r=t.databaseId,s=e.firestore._databaseId;if(!s.isEqual(r))throw t.Ou(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:ao(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.Ou(`Unsupported field value: ${nl(e)}`)}(0,e)}function Gl(e,n){const r={};return Fr(e)?n.path&&0<n.path.length&&n.fieldMask.push(n.path):Pr(e,(e,t)=>{t=Kl(t,n.Du(e));null!=t&&(r[e]=t)}),{mapValue:{fields:r}}}function $l(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Rr||e instanceof _l||e instanceof El||e instanceof al||e instanceof Sl)}function Ql(e,t,n){if(!$l(n)||"object"!=typeof(r=n)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r)){n=nl(n);throw"an object"===n?t.Ou(e+" a custom object"):t.Ou(e+" "+n)}var r}function zl(e,t,n){if((t=d(t))instanceof Tl)return t._internalPath;if("string"==typeof t)return Wl(e,t);throw Yl("Field path arguments must be of type string or ",e,!1,void 0,n)}const Hl=new RegExp("[~\\*/\\[\\]]");function Wl(t,n,r){if(0<=n.search(Hl))throw Yl(`Invalid field path (${n}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,r);try{return new Tl(...n.split("."))._internalPath}catch(e){throw Yl(`Invalid field path (${n}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,r)}}function Yl(e,t,n,r,s){var i=r&&!r.isEmpty(),o=void 0!==s;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let h="";return(i||o)&&(h+=" (found",i&&(h+=` in field ${r}`),o&&(h+=` in document ${s}`),h+=")"),new wr(yr.INVALID_ARGUMENT,a+e+h)}function Xl(e,t){return e.some(e=>e.isEqual(t))}class Jl{constructor(e,t,n,r,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new al(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){var e=new Zl(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){e=this._document.data.field(ed("DocumentSnapshot.get",e));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Zl extends Jl{data(){return super.data()}}function ed(e,t){return"string"==typeof t?Wl(e,t):(t instanceof Tl?t:t._delegate)._internalPath}class td{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class nd extends Jl{constructor(e,t,n,r,s,i){super(e,t,n,r,i),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){var t=new rd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){e=this._document.data.field(ed("DocumentSnapshot.get",e));if(null!==e)return this._userDataWriter.convertValue(e,t.serverTimestamps)}}}class rd extends nd{data(e={}){return super.data(e)}}class sd{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new td(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,n){this._snapshot.docs.forEach(e=>{t.call(n,new rd(this._firestore,this._userDataWriter,e.key,e,new td(this._snapshot.mutatedKeys.has(e.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){e=!!e.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new wr(yr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,t){if(i._snapshot.oldDocs.isEmpty()){let t=0;return i._snapshot.docChanges.map(e=>({type:"added",doc:new rd(i._firestore,i._userDataWriter,e.doc.key,e.doc,new td(i._snapshot.mutatedKeys.has(e.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:t++}))}{let s=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(e=>t||3!==e.type).map(e=>{var t=new rd(i._firestore,i._userDataWriter,e.doc.key,e.doc,new td(i._snapshot.mutatedKeys.has(e.doc.key),i._snapshot.fromCache),i.query.converter);let n=-1,r=-1;return 0!==e.type&&(n=s.indexOf(e.doc.key),s=s.delete(e.doc.key)),1!==e.type&&(s=s.add(e.doc),r=s.indexOf(e.doc.key)),{type:function(){switch(e.type){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return mr()}}(),doc:t,oldIndex:n,newIndex:r}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function id(e,t){return e instanceof nd&&t instanceof nd?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof sd&&t instanceof sd&&e._firestore===t._firestore&&fl(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function od(e){if(Gs(e)&&0===e.explicitOrderBy.length)throw new wr(yr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class ad{}function hd(e,...t){for(const n of t)e=n._apply(e);return e}class ud extends ad{constructor(e,t,n){super(),this.Uu=e,this.qu=t,this.Ku=n,this.type="where"}_apply(e){var t=Ol(e.firestore),t=function(e,t,n,r,s,i,o){let a;if(s.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new wr(yr.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on documentId().`);if("in"===i||"not-in"===i){pd(o,i);const t=[];for(const n of o)t.push(md(r,e,n));a={arrayValue:{values:t}}}else a=md(r,e,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||pd(o,i),a=jl(n,t,o,"in"===i||"not-in"===i);i=xs.create(s,i,a);return function(e,t){if(t.S()){const r=Qs(e);if(null!==r&&!r.isEqual(t.field))throw new wr(yr.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${r.toString()}' and '${t.field.toString()}'`);var n=$s(e);null!==n&&yd(0,t.field,n)}const r=function(e,t){for(const n of e.filters)if(0<=t.indexOf(n.op))return n.op;return null}(e,function(){switch(t.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==r)throw r===t.op?new wr(yr.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new wr(yr.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}(e,i),i}(e._query,"where",t,e.firestore._databaseId,this.Uu,this.qu,this.Ku);return new hl(e.firestore,e.converter,(t=(e=e._query).filters.concat([t]),new qs(e.path,e.collectionGroup,e.explicitOrderBy.slice(),t,e.limit,e.limitType,e.startAt,e.endAt)))}}class cd extends ad{constructor(e,t){super(),this.Uu=e,this.Gu=t,this.type="orderBy"}_apply(e){var t=function(e,t,n){if(null!==e.startAt)throw new wr(yr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new wr(yr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");t=new Fs(t,n);return n=t,null!==$s(e)||null!==(e=Qs(e))&&yd(0,e,n.field),t}(e._query,this.Uu,this.Gu);return new hl(e.firestore,e.converter,(t=(e=e._query).explicitOrderBy.concat([t]),new qs(e.path,e.collectionGroup,t,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)))}}class ld extends ad{constructor(e,t,n){super(),this.type=e,this.ju=t,this.Qu=n}_apply(e){return new hl(e.firestore,e.converter,Ys(e._query,this.ju,this.Qu))}}class dd extends ad{constructor(e,t,n){super(),this.type=e,this.Wu=t,this.zu=n}_apply(e){var t,n=gd(e,this.type,this.Wu,this.zu);return new hl(e.firestore,e.converter,(t=e._query,e=n,new qs(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)))}}class fd extends ad{constructor(e,t,n){super(),this.type=e,this.Wu=t,this.zu=n}_apply(e){var t,n=gd(e,this.type,this.Wu,this.zu);return new hl(e.firestore,e.converter,(t=e._query,e=n,new qs(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)))}}function gd(e,t,n,r){if(n[0]=d(n[0]),n[0]instanceof Jl)return function(e,t,n,r,s){if(!r)throw new wr(yr.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const i=[];for(const n of Hs(e))if(n.field.isKeyField())i.push(us(t,r.key));else{const e=r.data.field(n.field);if(Hr(e))throw new wr(yr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new wr(yr.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}i.push(e)}return new Ps(i,s)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var s=Ol(e.firestore);return function(t,n,r,s,i,e){const o=t.explicitOrderBy;if(i.length>o.length)throw new wr(yr.INVALID_ARGUMENT,`Too many arguments provided to ${s}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let e=0;e<i.length;e++){const h=i[e];if(o[e].field.isKeyField()){if("string"!=typeof h)throw new wr(yr.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${s}(), but got a ${typeof h}`);if(!zs(t)&&-1!==h.indexOf("/"))throw new wr(yr.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${s}() must be a plain document ID, but '${h}' contains a slash.`);const r=t.path.child(Ur.fromString(h));if(!ts.isDocumentKey(r))throw new wr(yr.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${s}() must result in a valid document path, but '${r}' is not because it contains an odd number of segments.`);const i=new ts(r);a.push(us(n,i))}else{const t=jl(r,s,h);a.push(t)}}return new Ps(a,e)}(e._query,e.firestore._databaseId,s,t,n,r)}function md(e,t,n){if("string"==typeof(n=d(n))){if(""===n)throw new wr(yr.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!zs(t)&&-1!==n.indexOf("/"))throw new wr(yr.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);t=t.path.child(Ur.fromString(n));if(!ts.isDocumentKey(t))throw new wr(yr.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${t}' is not because it has an odd number of segments (${t.length}).`);return us(e,new ts(t))}if(n instanceof al)return us(e,n._key);throw new wr(yr.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${nl(n)}.`)}function pd(e,t){if(!Array.isArray(e)||0===e.length)throw new wr(yr.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(10<e.length)throw new wr(yr.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}function yd(e,t,n){if(!n.isEqual(t))throw new wr(yr.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class wd{convertValue(e,t="none"){switch(rs(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Qr(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(zr(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw mr()}}convertObject(e,n){const r={};return Pr(e.fields,(e,t)=>{r[e]=this.convertValue(t,n)}),r}convertGeoPoint(e){return new _l(Qr(e.latitude),Qr(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":var n=function e(t){t=t.mapValue.fields.__previous_value__;return Hr(t)?e(t):t}(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Wr(e));default:return null}}convertTimestamp(e){e=$r(e);return new Rr(e.seconds,e.nanos)}convertDocumentKey(e,t){const n=Ur.fromString(e);pr(_o(n));const r=new Xr(n.get(1),n.get(3)),s=new ts(n.popFirst(5));return r.isEqual(t)||dr(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function vd(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class Id extends wd{constructor(e){super(),this.firestore=e}convertBytes(e){return new El(e)}convertReference(e){e=this.convertDocumentKey(e,this.firestore._databaseId);return new al(this.firestore,null,e)}}class bd{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Ol(e)}set(e,t,n){this._verifyNotCommitted();const r=Td(e,this._firestore),s=vd(r.converter,t,n),i=Rl(this._dataReader,"WriteBatch.set",r._key,s,null!==r.converter,n);return this._mutations.push(i.toMutation(r._key,yi.none())),this}update(e,t,n,...r){this._verifyNotCommitted();e=Td(e,this._firestore);let s;return s="string"==typeof(t=d(t))||t instanceof Tl?Bl(this._dataReader,"WriteBatch.update",e._key,t,n,r):ql(this._dataReader,"WriteBatch.update",e._key,t),this._mutations.push(s.toMutation(e._key,yi.exists(!0))),this}delete(e){this._verifyNotCommitted();e=Td(e,this._firestore);return this._mutations=this._mutations.concat(new Ci(e._key,yi.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,0<this._mutations.length?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new wr(yr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Td(e,t){if((e=d(e)).firestore!==t)throw new wr(yr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class Ed extends wd{constructor(e){super(),this.firestore=e}convertBytes(e){return new El(e)}convertReference(e){e=this.convertDocumentKey(e,this.firestore._databaseId);return new al(this.firestore,null,e)}}function Sd(e,t,n){e=rl(e,al);var r=rl(e.firestore,yl),t=vd(e.converter,t,n);return xd(r,[Rl(Ol(r),"setDoc",e._key,t,null!==e.converter,n).toMutation(e._key,yi.none())])}function _d(e,t,n,...r){e=rl(e,al);var s=rl(e.firestore,yl),i=Ol(s);let o;return o="string"==typeof(t=d(t))||t instanceof Tl?Bl(i,"updateDoc",e._key,t,n,r):ql(i,"updateDoc",e._key,t),xd(s,[o.toMutation(e._key,yi.exists(!0))])}function Ad(t,...n){var e;t=d(t);let r={includeMetadataChanges:!1},s=0;"object"!=typeof n[s]||ml(n[s])||(r=n[s],s++);var i={includeMetadataChanges:r.includeMetadataChanges};if(ml(n[s])){const t=n[s];n[s]=null===(e=t.next)||void 0===e?void 0:e.bind(t),n[s+1]=null===(e=t.error)||void 0===e?void 0:e.bind(t),n[s+2]=null===(e=t.complete)||void 0===e?void 0:e.bind(t)}let o,a,h;if(t instanceof al)a=rl(t.firestore,yl),h=js(t._key.path),o={next:e=>{n[s]&&n[s](Nd(a,t,e))},error:n[s+1],complete:n[s+2]};else{const u=rl(t,hl);a=rl(u.firestore,yl),h=u._query;const c=new Ed(a);o={next:e=>{n[s]&&n[s](new sd(a,c,u,e))},error:n[s+1],complete:n[s+2]},od(t._query)}return function(e,t,n,r){const s=new Lc(r),i=new nc(t,s,n);return e.asyncQueue.enqueueAndForget(async()=>Zu(await zc(e),i)),()=>{s.Jc(),e.asyncQueue.enqueueAndForget(async()=>ec(await zc(e),i))}}(wl(a),h,i,o)}function xd(e,t){return function(e,t){const n=new vr;return e.asyncQueue.enqueueAndForget(async()=>gc(await Qc(e),t,n)),n.promise}(wl(e),t)}function Nd(e,t,n){var r=n.docs.get(t._key),s=new Ed(e);return new nd(e,s,t._key,r,new td(n.hasPendingWrites,n.fromCache),t.converter)}class Cd extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Ol(e)}get(e){const n=Td(e,this._firestore),r=new Id(this._firestore);return this._transaction.lookup([n._key]).then(e=>{if(!e||1!==e.length)return mr();const t=e[0];if(t.isFoundDocument())return new Jl(this._firestore,r,t.key,t,n.converter);if(t.isNoDocument())return new Jl(this._firestore,r,n._key,null,n.converter);throw mr()})}set(e,t,n){e=Td(e,this._firestore),t=vd(e.converter,t,n),t=Rl(this._dataReader,"Transaction.set",e._key,t,null!==e.converter,n);return this._transaction.set(e._key,t),this}update(e,t,n,...r){e=Td(e,this._firestore),t="string"==typeof(t=d(t))||t instanceof Tl?Bl(this._dataReader,"Transaction.update",e._key,t,n,r):ql(this._dataReader,"Transaction.update",e._key,t);return this._transaction.update(e._key,t),this}delete(e){e=Td(e,this._firestore);return this._transaction.delete(e._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Td(e,this._firestore),n=new Ed(this._firestore);return super.get(e).then(e=>new nd(this._firestore,n,t._key,e._document,new td(!1,!1),t.converter))}}function Dd(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new wr("invalid-argument",`Invalid options passed to function ${e}(): You cannot `+'specify both "merge" and "mergeFields".');return t}function kd(){if("undefined"==typeof Uint8Array)throw new wr("unimplemented","Uint8Arrays are not available in this environment.")}function Od(){if("undefined"==typeof atob)throw new wr("unimplemented","Blobs are unavailable in Firestore in this environment.")}Zn=nf.SDK_VERSION,hr=Zn,nf._registerComponent(new h("firestore",(e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=new yl(n,new Er(e.getProvider("auth-internal")),new xr(e.getProvider("app-check-internal")));return t=Object.assign({useFetchStreams:!0},t),r._setSettings(t),r},"PUBLIC")),nf.registerVersion(J,"3.4.5",void 0),nf.registerVersion(J,"3.4.5","esm2017");class Rd{constructor(e){this._delegate=e}static fromBase64String(e){return Od(),new Rd(El.fromBase64String(e))}static fromUint8Array(e){return kd(),new Rd(El.fromUint8Array(e))}toBase64(){return Od(),this._delegate.toBase64()}toUint8Array(){return kd(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Ld(e){return function(e){if("object"==typeof e&&null!==e){var t=e;for(const n of["next","error","complete"])if(n in t&&"function"==typeof t[n])return 1}}(e)}class Md{enableIndexedDbPersistence(e,t){return function(e,t){bl(e=rl(e,yl));var n=wl(e),r=e._freezeSettings(),e=new Oc;return Il(n,e,new Dc(e,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(e){bl(e=rl(e,yl));var t=wl(e),n=e._freezeSettings(),e=new Oc;return Il(t,e,new kc(e,n.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function(e){if(e._initialized&&!e._terminated)throw new wr(yr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new vr;return e._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(e){if(!na.Vt())return Promise.resolve();e+="main";await na.delete(e)}(Dh(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}}),t.promise}(e._delegate)}}class Pd{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof Xr||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){var t=this._delegate._getSettings();e.merge||t.host===e.host||fr("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){!function(n,e,r,s={}){const i=(n=rl(n,ol))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&fr("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},i),{host:`${e}:${r}`,ssl:!1})),s.mockUserToken){let e,t;if("string"==typeof s.mockUserToken)e=s.mockUserToken,t=ar.MOCK_USER;else{e=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=t||"demo-project",r=e.iat||0,t=e.sub||e.user_id;if(!t)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");return t=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:t,user_id:t,firebase:{sign_in_provider:"custom",identities:{}}},e),[o(JSON.stringify({alg:"none",type:"JWT"})),o(JSON.stringify(t)),""].join(".")}(s.mockUserToken,null===(r=n._app)||void 0===r?void 0:r.options.projectId);const i=s.mockUserToken.sub||s.mockUserToken.user_id;if(!i)throw new wr(yr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t=new ar(i)}n._authCredentials=new Tr(new Ir(e,t))}}(this._delegate,e,t,n)}enableNetwork(){return e=this._delegate,(n=wl(e=rl(e,yl))).asyncQueue.enqueue(async()=>{const e=await Kc(n),t=await $c(n);return e.setNetworkEnabled(!0),function(){const e=t;return e.Ko.delete(0),xu(e)}()});var e,n}disableNetwork(){return e=this._delegate,(n=wl(e=rl(e,yl))).asyncQueue.enqueue(async()=>{const e=await Kc(n),t=await $c(n);return e.setNetworkEnabled(!1),async function(){const e=t;e.Ko.add(0),await Nu(e),e.Qo.set("Offline")}()});var e,n}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,Zc("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function(e){const t=new vr;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t){const n=e;Mu(n.remoteStore)||lr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(){const t=n.localStore;return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.gs.getHighestUnacknowledgedBatchId(e))}();if(-1===e)return void t.resolve();const r=n.Fc.get(e)||[];r.push(t),n.Fc.set(e,r)}catch(e){const n=zu(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await Qc(e),t)),t.promise}(wl(rl(this._delegate,yl)))}onSnapshotsInSync(e){return t=this._delegate,e=e,function(e,t){const n=new Lc(t);return e.asyncQueue.enqueueAndForget(async()=>function(e,t){e.Zo.add(t),t.next()}(await zc(e),n)),()=>{n.Jc(),e.asyncQueue.enqueueAndForget(async()=>function(e,t){e.Zo.delete(t)}(await zc(e),n))}}(wl(t=rl(t,yl)),ml(e)?e:{next:e});var t}get app(){if(!this._appCompat)throw new wr("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Yd(this,cl(this._delegate,e))}catch(e){throw jd(e,"collection()","Firestore.collection()")}}doc(e){try{return new Bd(this,ll(this._delegate,e))}catch(e){throw jd(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new zd(this,function(e,t){if(e=rl(e,ol),Jc("collectionGroup","collection id",t),0<=t.indexOf("/"))throw new wr(yr.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new hl(e,null,new qs(Ur.emptyPath(),t))}(this._delegate,e))}catch(e){throw jd(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(t){return n=this._delegate,r=e=>t(new Vd(this,e)),function(t,n){const r=new vr;return t.asyncQueue.enqueueAndForget(async()=>{var e=await jc(t).then(e=>e.datastore);new Fc(t.asyncQueue,e,n,r).run()}),r.promise}(wl(n=rl(n,yl)),e=>r(new Cd(n,e)));var n,r}batch(){return wl(this._delegate),new Ud(new bd(this._delegate,e=>xd(this._delegate,e)))}loadBundle(e){return n=wl(t=rl(this._delegate,yl)),r=new pl,Yc(n,t._databaseId,e,r),r;var t,n,r}namedQuery(e){return t=this._delegate,e=e,n=wl(t=rl(t,yl)),r=e,n.asyncQueue.enqueue(async()=>function(e,t){const n=e;return n.persistence.runTransaction("Get named query","readonly",e=>n.Kn.getNamedQuery(e,t))}(await Gc(n),r)).then(e=>e?new hl(t,null,e.query):null).then(e=>e?new zd(this,e):null);var t,n,r}}class Fd extends wd{constructor(e){super(),this.firestore=e}convertBytes(e){return new Rd(new El(e))}convertReference(e){e=this.convertDocumentKey(e,this.firestore._databaseId);return Bd.forKey(e,this.firestore,null)}}class Vd{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Fd(e)}get(e){const t=Xd(e);return this._delegate.get(t).then(e=>new $d(this._firestore,new nd(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter)))}set(e,t,n){e=Xd(e);return n?(Dd("Transaction.set",n),this._delegate.set(e,t,n)):this._delegate.set(e,t),this}update(e,t,n,...r){e=Xd(e);return 2===arguments.length?this._delegate.update(e,t):this._delegate.update(e,t,n,...r),this}delete(e){e=Xd(e);return this._delegate.delete(e),this}}class Ud{constructor(e){this._delegate=e}set(e,t,n){e=Xd(e);return n?(Dd("WriteBatch.set",n),this._delegate.set(e,t,n)):this._delegate.set(e,t),this}update(e,t,n,...r){e=Xd(e);return 2===arguments.length?this._delegate.update(e,t):this._delegate.update(e,t,n,...r),this}delete(e){e=Xd(e);return this._delegate.delete(e),this}commit(){return this._delegate.commit()}}class qd{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){e=new rd(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Qd(this._firestore,e),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=qd.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let s=r.get(t);return s||(s=new qd(e,new Fd(e),t),r.set(t,s)),s}}qd.INSTANCES=new WeakMap;class Bd{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Fd(e)}static forPath(e,t,n){if(e.length%2!=0)throw new wr("invalid-argument","Invalid document reference. Document references must have an even number of segments, but "+`${e.canonicalString()} has ${e.length}`);return new Bd(t,new al(t._delegate,n,new ts(e)))}static forKey(e,t,n){return new Bd(t,new al(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new Yd(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Yd(this.firestore,cl(this._delegate,e))}catch(e){throw jd(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=d(e))instanceof al&&dl(this._delegate,e)}set(e,t){t=Dd("DocumentReference.set",t);try{return t?Sd(this._delegate,e,t):Sd(this._delegate,e)}catch(e){throw jd(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?_d(this._delegate,e):_d(this._delegate,e,t,...n)}catch(e){throw jd(e,"updateDoc()","DocumentReference.update()")}}delete(){return xd(rl((e=this._delegate).firestore,yl),[new Ci(e._key,yi.none())]);var e}onSnapshot(...e){var t=Kd(e),e=Gd(e,e=>new $d(this.firestore,new nd(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)));return Ad(this._delegate,t,e)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?function(t){t=rl(t,al);const n=rl(t.firestore,yl),e=wl(n),r=new Ed(n);return function(e,t){const n=new vr;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const r=await function(t){const n=e;return n.persistence.runTransaction("read document","readonly",e=>n.Us.ys(e,t))}(t);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new wr(yr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){t=zu(e,`Failed to get document '${t} from cache`);n.reject(t)}}(await Gc(e),t,n)),n.promise}(e,t._key).then(e=>new nd(n,r,t._key,e,new td(null!==e&&e.hasLocalMutations,!0),t.converter))}:"server"===(null==e?void 0:e.source)?function(t){t=rl(t,al);const n=rl(t.firestore,yl);return Hc(wl(n),t._key,{source:"server"}).then(e=>Nd(n,t,e))}:function(t){t=rl(t,al);const n=rl(t.firestore,yl);return Hc(wl(n),t._key).then(e=>Nd(n,t,e))})(this._delegate),t.then(e=>new $d(this.firestore,new nd(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter)))}withConverter(e){return new Bd(this.firestore,e?this._delegate.withConverter(qd.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function jd(e,t,n){return e.message=e.message.replace(t,n),e}function Kd(e){for(const t of e)if("object"==typeof t&&!Ld(t))return t;return{}}function Gd(e,t){let n;return n=Ld(e[0])?e[0]:Ld(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{n.next&&n.next(t(e))},error:null===(e=n.error)||void 0===e?void 0:e.bind(n),complete:null===(e=n.complete)||void 0===e?void 0:e.bind(n)}}class $d{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Bd(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return id(this._delegate,e._delegate)}}class Qd extends $d{data(e){e=this._delegate.data(e);return void 0!==e||mr(),e}}class zd{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Fd(e)}where(e,t,n){try{return new zd(this.firestore,hd(this._delegate,(r=n,s=t,i=ed("where",e),new ud(i,s,r))))}catch(e){throw jd(e,/(orderBy|where)\(\)/,"Query.$1()")}var r,s,i}orderBy(e,t){try{return new zd(this.firestore,hd(this._delegate,([n,r="asc"]=[e,t],s=r,i=ed("orderBy",n),new cd(i,s))))}catch(e){throw jd(e,/(orderBy|where)\(\)/,"Query.$1()")}var n,r,s,i}limit(e){try{return new zd(this.firestore,hd(this._delegate,(sl("limit",t=e),new ld("limit",t,"F"))))}catch(e){throw jd(e,"limit()","Query.limit()")}var t}limitToLast(e){try{return new zd(this.firestore,hd(this._delegate,(sl("limitToLast",t=e),new ld("limitToLast",t,"L"))))}catch(e){throw jd(e,"limitToLast()","Query.limitToLast()")}var t}startAt(...e){try{return new zd(this.firestore,hd(this._delegate,function(...e){return new dd("startAt",e,!0)}(...e)))}catch(e){throw jd(e,"startAt()","Query.startAt()")}}startAfter(...e){try{return new zd(this.firestore,hd(this._delegate,function(...e){return new dd("startAfter",e,!1)}(...e)))}catch(e){throw jd(e,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new zd(this.firestore,hd(this._delegate,function(...e){return new fd("endBefore",e,!1)}(...e)))}catch(e){throw jd(e,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new zd(this.firestore,hd(this._delegate,function(...e){return new fd("endAt",e,!0)}(...e)))}catch(e){throw jd(e,"endAt()","Query.endAt()")}}isEqual(e){return fl(this._delegate,e._delegate)}get(e){let t;return t=("cache"===(null==e?void 0:e.source)?function(t){t=rl(t,hl);const n=rl(t.firestore,yl),e=wl(n),r=new Ed(n);return function(e,t){const n=new vr;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,n){try{const r=await jh(e,t,!0),s=new uc(t,r.Ks),i=s.Ic(r.documents),o=s.applyChanges(i,!1);n.resolve(o.snapshot)}catch(e){t=zu(e,`Failed to execute query '${t} against cache`);n.reject(t)}}(await Gc(e),t,n)),n.promise}(e,t._query).then(e=>new sd(n,r,t,e))}:"server"===(null==e?void 0:e.source)?function(t){t=rl(t,hl);const n=rl(t.firestore,yl),e=wl(n),r=new Ed(n);return Wc(e,t._query,{source:"server"}).then(e=>new sd(n,r,t,e))}:function(t){t=rl(t,hl);const n=rl(t.firestore,yl),e=wl(n),r=new Ed(n);return od(t._query),Wc(e,t._query).then(e=>new sd(n,r,t,e))})(this._delegate),t.then(e=>new Wd(this.firestore,new sd(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)))}onSnapshot(...e){var t=Kd(e),e=Gd(e,e=>new Wd(this.firestore,new sd(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot)));return Ad(this._delegate,t,e)}withConverter(e){return new zd(this.firestore,e?this._delegate.withConverter(qd.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class Hd{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Qd(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Wd{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new zd(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Qd(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(e=>new Hd(this._firestore,e))}forEach(t,n){this._delegate.forEach(e=>{t.call(n,new Qd(this._firestore,e))})}isEqual(e){return id(this._delegate,e._delegate)}}class Yd extends zd{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){var e=this._delegate.parent;return e?new Bd(this.firestore,e):null}doc(e){try{return void 0===e?new Bd(this.firestore,ll(this._delegate)):new Bd(this.firestore,ll(this._delegate,e))}catch(e){throw jd(e,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=rl(e.firestore,yl),r=ll(e),s=vd(e.converter,t);return xd(n,[Rl(Ol(e.firestore),"addDoc",r._key,s,null!==e.converter,{}).toMutation(r._key,yi.exists(!1))]).then(()=>r)}(this._delegate,e).then(e=>new Bd(this.firestore,e))}isEqual(e){return dl(this._delegate,e._delegate)}withConverter(e){return new Yd(this.firestore,e?this._delegate.withConverter(qd.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function Xd(e){return rl(e,al)}var J={Firestore:Pd,GeoPoint:_l,Timestamp:Rr,Blob:Rd,Transaction:Vd,WriteBatch:Ud,DocumentReference:Bd,DocumentSnapshot:$d,Query:zd,QueryDocumentSnapshot:Qd,QuerySnapshot:Wd,CollectionReference:Yd,FieldPath:class Zd{constructor(...e){this._delegate=new Tl(...e)}static documentId(){return new Zd(Br.keyField().canonicalString())}isEqual(e){return(e=d(e))instanceof Tl&&this._delegate._internalPath.isEqual(e._internalPath)}},FieldValue:class ef{constructor(e){this._delegate=e}static serverTimestamp(){const e=new Pl("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new ef(e)}static delete(){const e=new Ll("deleteField");return e._methodName="FieldValue.delete",new ef(e)}static arrayUnion(...e){const t=function(...e){return new Fl("arrayUnion",e)}(...e);return t._methodName="FieldValue.arrayUnion",new ef(t)}static arrayRemove(...e){const t=function(...e){return new Vl("arrayRemove",e)}(...e);return t._methodName="FieldValue.arrayRemove",new ef(t)}static increment(e){const t=new Ul("increment",e);return t._methodName="FieldValue.increment",new ef(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}},setLogLevel:function(e){ur.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1},t=t.default,Jd=(e,t)=>new Pd(e,t,new Md);t.INTERNAL.registerComponent(new h("firestore-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),e=e.getProvider("firestore").getImmediate();return Jd(t,e)},"PUBLIC").setServiceProps(Object.assign({},J))),t.registerVersion("@firebase/firestore-compat","0.1.14")}.apply(this,arguments)}catch(e){throw console.error(e),new Error("Cannot instantiate firebase-firestore-compat.js - be sure to load firebase-app.js first.")}});